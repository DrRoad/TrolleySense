!function($){"use strict";var Typeahead=function(element,options){this.$element=$(element);this.options=$.extend({},$.fn.typeahead.defaults,options);this.matcher=this.options.matcher||this.matcher;this.sorter=this.options.sorter||this.sorter;this.highlighter=this.options.highlighter||this.highlighter;this.updater=this.options.updater||this.updater;this.source=this.options.source;this.$menu=$(this.options.menu);this.shown=false;this.listen()};Typeahead.prototype={constructor:Typeahead,select:function(){var val=this.$menu.find(".active").attr("data-value");this.$element.val(this.updater(val)).change();return this.hide()},updater:function(item){return item},show:function(){var pos=$.extend({},this.$element.position(),{height:this.$element[0].offsetHeight});this.$menu.insertAfter(this.$element).css({top:pos.top+pos.height,left:pos.left}).show();this.shown=true;return this},hide:function(){this.$menu.hide();this.shown=false;return this},lookup:function(event){var items;this.query=this.$element.val();if(!this.query||this.query.length<this.options.minLength){return this.shown?this.hide():this}items=$.isFunction(this.source)?this.source(this.query,$.proxy(this.process,this)):this.source;return items?this.process(items):this},process:function(items){var that=this;items=$.grep(items,function(item){return that.matcher(item)});items=this.sorter(items);if(!items.length){return this.shown?this.hide():this}return this.render(items.slice(0,this.options.items)).show()},matcher:function(item){return~item.toLowerCase().indexOf(this.query.toLowerCase())},sorter:function(items){var beginswith=[],caseSensitive=[],caseInsensitive=[],item;while(item=items.shift()){if(!item.toLowerCase().indexOf(this.query.toLowerCase()))beginswith.push(item);else if(~item.indexOf(this.query))caseSensitive.push(item);else caseInsensitive.push(item)}return beginswith.concat(caseSensitive,caseInsensitive)},highlighter:function(item){var query=this.query.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");return item.replace(new RegExp("("+query+")","ig"),function($1,match){return"<strong>"+match+"</strong>"})},render:function(items){var that=this;items=$(items).map(function(i,item){i=$(that.options.item).attr("data-value",item);i.find("a").html(that.highlighter(item));return i[0]});items.first().addClass("active");this.$menu.html(items);return this},next:function(event){var active=this.$menu.find(".active").removeClass("active"),next=active.next();if(!next.length){next=$(this.$menu.find("li")[0])}next.addClass("active")},prev:function(event){var active=this.$menu.find(".active").removeClass("active"),prev=active.prev();if(!prev.length){prev=this.$menu.find("li").last()}prev.addClass("active")},listen:function(){this.$element.on("focus",$.proxy(this.focus,this)).on("blur",$.proxy(this.blur,this)).on("keypress",$.proxy(this.keypress,this)).on("keyup",$.proxy(this.keyup,this));if(this.eventSupported("keydown")){this.$element.on("keydown",$.proxy(this.keydown,this))}this.$menu.on("click",$.proxy(this.click,this)).on("mouseenter","li",$.proxy(this.mouseenter,this)).on("mouseleave","li",$.proxy(this.mouseleave,this))},eventSupported:function(eventName){var isSupported=eventName in this.$element;if(!isSupported){this.$element.setAttribute(eventName,"return;");isSupported=typeof this.$element[eventName]==="function"}return isSupported},move:function(e){if(!this.shown)return;switch(e.keyCode){case 9:case 13:case 27:e.preventDefault();break;case 38:e.preventDefault();this.prev();break;case 40:e.preventDefault();this.next();break}e.stopPropagation()},keydown:function(e){this.suppressKeyPressRepeat=~$.inArray(e.keyCode,[40,38,9,13,27]);this.move(e)},keypress:function(e){if(this.suppressKeyPressRepeat)return;this.move(e)},keyup:function(e){switch(e.keyCode){case 40:case 38:case 16:case 17:case 18:break;case 9:case 13:if(!this.shown)return;this.select();break;case 27:if(!this.shown)return;this.hide();break;default:this.lookup()}e.stopPropagation();e.preventDefault()},focus:function(e){this.focused=true},blur:function(e){this.focused=false;if(!this.mousedover&&this.shown)this.hide()},click:function(e){e.stopPropagation();e.preventDefault();this.select();this.$element.focus()},mouseenter:function(e){this.mousedover=true;this.$menu.find(".active").removeClass("active");$(e.currentTarget).addClass("active")},mouseleave:function(e){this.mousedover=false;if(!this.focused&&this.shown)this.hide()}};var old=$.fn.typeahead;$.fn.typeahead=function(option){return this.each(function(){var $this=$(this),data=$this.data("typeahead"),options=typeof option=="object"&&option;if(!data)$this.data("typeahead",data=new Typeahead(this,options));if(typeof option=="string")data[option]()})};$.fn.typeahead.defaults={source:[],items:8,menu:'<ul class="typeahead dropdown-menu"></ul>',item:'<li><a href="#"></a></li>',minLength:1};$.fn.typeahead.Constructor=Typeahead;$.fn.typeahead.noConflict=function(){$.fn.typeahead=old;return this};$(document).on("focus.typeahead.data-api",'[data-provide="typeahead"]',function(e){var $this=$(this);if($this.data("typeahead"))return;$this.typeahead($this.data())})}(window.jQuery);

!function($){"use strict";var Tooltip=function(element,options){this.init("tooltip",element,options)};Tooltip.prototype={constructor:Tooltip,init:function(type,element,options){var eventIn,eventOut,triggers,trigger,i;this.type=type;this.$element=$(element);this.options=this.getOptions(options);this.enabled=true;triggers=this.options.trigger.split(" ");for(i=triggers.length;i--;){trigger=triggers[i];if(trigger=="click"){this.$element.on("click."+this.type,this.options.selector,$.proxy(this.toggle,this))}else if(trigger!="manual"){eventIn=trigger=="hover"?"mouseenter":"focus";eventOut=trigger=="hover"?"mouseleave":"blur";this.$element.on(eventIn+"."+this.type,this.options.selector,$.proxy(this.enter,this));this.$element.on(eventOut+"."+this.type,this.options.selector,$.proxy(this.leave,this))}}this.options.selector?this._options=$.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},getOptions:function(options){options=$.extend({},$.fn[this.type].defaults,this.$element.data(),options);if(options.delay&&typeof options.delay=="number"){options.delay={show:options.delay,hide:options.delay}}return options},enter:function(e){var defaults=$.fn[this.type].defaults,options={},self;this._options&&$.each(this._options,function(key,value){if(defaults[key]!=value)options[key]=value},this);self=$(e.currentTarget)[this.type](options).data(this.type);if(!self.options.delay||!self.options.delay.show)return self.show();clearTimeout(this.timeout);self.hoverState="in";this.timeout=setTimeout(function(){if(self.hoverState=="in")self.show()},self.options.delay.show)},leave:function(e){var self=$(e.currentTarget)[this.type](this._options).data(this.type);if(this.timeout)clearTimeout(this.timeout);if(!self.options.delay||!self.options.delay.hide)return self.hide();self.hoverState="out";this.timeout=setTimeout(function(){if(self.hoverState=="out")self.hide()},self.options.delay.hide)},show:function(){var $tip,pos,actualWidth,actualHeight,placement,tp,e=$.Event("show");if(this.hasContent()&&this.enabled){this.$element.trigger(e);if(e.isDefaultPrevented())return;$tip=this.tip();this.setContent();if(this.options.animation){$tip.addClass("fade")}placement=typeof this.options.placement=="function"?this.options.placement.call(this,$tip[0],this.$element[0]):this.options.placement;$tip.detach().css({top:0,left:0,display:"block"});this.options.container?$tip.appendTo(this.options.container):$tip.insertAfter(this.$element);pos=this.getPosition();actualWidth=$tip[0].offsetWidth;actualHeight=$tip[0].offsetHeight;switch(placement){case"bottom":tp={top:pos.top+pos.height,left:pos.left+pos.width/2-actualWidth/2};break;case"top":tp={top:pos.top-actualHeight,left:pos.left+pos.width/2-actualWidth/2};break;case"left":tp={top:pos.top+pos.height/2-actualHeight/2,left:pos.left-actualWidth};break;case"right":tp={top:pos.top+pos.height/2-actualHeight/2,left:pos.left+pos.width};break}this.applyPlacement(tp,placement);this.$element.trigger("shown")}},applyPlacement:function(offset,placement){var $tip=this.tip(),width=$tip[0].offsetWidth,height=$tip[0].offsetHeight,actualWidth,actualHeight,delta,replace;$tip.offset(offset).addClass(placement).addClass("in");actualWidth=$tip[0].offsetWidth;actualHeight=$tip[0].offsetHeight;if(placement=="top"&&actualHeight!=height){offset.top=offset.top+height-actualHeight;replace=true}if(placement=="bottom"||placement=="top"){delta=0;if(offset.left<0){delta=offset.left*-2;offset.left=0;$tip.offset(offset);actualWidth=$tip[0].offsetWidth;actualHeight=$tip[0].offsetHeight}this.replaceArrow(delta-width+actualWidth,actualWidth,"left")}else{this.replaceArrow(actualHeight-height,actualHeight,"top")}if(replace)$tip.offset(offset)},replaceArrow:function(delta,dimension,position){this.arrow().css(position,delta?50*(1-delta/dimension)+"%":"")},setContent:function(){var $tip=this.tip(),title=this.getTitle();$tip.find(".tooltip-inner")[this.options.html?"html":"text"](title);$tip.removeClass("fade in top bottom left right")},hide:function(){var that=this,$tip=this.tip(),e=$.Event("hide");this.$element.trigger(e);if(e.isDefaultPrevented())return;$tip.removeClass("in");function removeWithAnimation(){var timeout=setTimeout(function(){$tip.off($.support.transition.end).detach()},500);$tip.one($.support.transition.end,function(){clearTimeout(timeout);$tip.detach()})}$.support.transition&&this.$tip.hasClass("fade")?removeWithAnimation():$tip.detach();this.$element.trigger("hidden");return this},fixTitle:function(){var $e=this.$element;if($e.attr("title")||typeof $e.attr("data-original-title")!="string"){$e.attr("data-original-title",$e.attr("title")||"").attr("title","")}},hasContent:function(){return this.getTitle()},getPosition:function(){var el=this.$element[0];return $.extend({},typeof el.getBoundingClientRect=="function"?el.getBoundingClientRect():{width:el.offsetWidth,height:el.offsetHeight},this.$element.offset())},getTitle:function(){var title,$e=this.$element,o=this.options;title=$e.attr("data-original-title")||(typeof o.title=="function"?o.title.call($e[0]):o.title);return title},tip:function(){return this.$tip=this.$tip||$(this.options.template)},arrow:function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},validate:function(){if(!this.$element[0].parentNode){this.hide();this.$element=null;this.options=null}},enable:function(){this.enabled=true},disable:function(){this.enabled=false},toggleEnabled:function(){this.enabled=!this.enabled},toggle:function(e){var self=e?$(e.currentTarget)[this.type](this._options).data(this.type):this;self.tip().hasClass("in")?self.hide():self.show()},destroy:function(){this.hide().$element.off("."+this.type).removeData(this.type)}};var old=$.fn.tooltip;$.fn.tooltip=function(option){return this.each(function(){var $this=$(this),data=$this.data("tooltip"),options=typeof option=="object"&&option;if(!data)$this.data("tooltip",data=new Tooltip(this,options));if(typeof option=="string")data[option]()})};$.fn.tooltip.Constructor=Tooltip;$.fn.tooltip.defaults={animation:true,placement:"top",selector:false,template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:false,container:false};$.fn.tooltip.noConflict=function(){$.fn.tooltip=old;return this}}(window.jQuery);

!function($){"use strict";var Popover=function(element,options){this.init("popover",element,options)};Popover.prototype=$.extend({},$.fn.tooltip.Constructor.prototype,{constructor:Popover,setContent:function(){var $tip=this.tip(),title=this.getTitle(),content=this.getContent();$tip.find(".popover-title")[this.options.html?"html":"text"](title);$tip.find(".popover-content")[this.options.html?"html":"text"](content);$tip.removeClass("fade top bottom left right in")},hasContent:function(){return this.getTitle()||this.getContent()},getContent:function(){var content,$e=this.$element,o=this.options;content=(typeof o.content=="function"?o.content.call($e[0]):o.content)||$e.attr("data-content");return content},tip:function(){if(!this.$tip){this.$tip=$(this.options.template)}return this.$tip},destroy:function(){this.hide().$element.off("."+this.type).removeData(this.type)}});var old=$.fn.popover;$.fn.popover=function(option){return this.each(function(){var $this=$(this),data=$this.data("popover"),options=typeof option=="object"&&option;if(!data)$this.data("popover",data=new Popover(this,options));if(typeof option=="string")data[option]()})};$.fn.popover.Constructor=Popover;$.fn.popover.defaults=$.extend({},$.fn.tooltip.defaults,{placement:"right",trigger:"click",content:"",template:'<div class="popover"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'});$.fn.popover.noConflict=function(){$.fn.popover=old;return this}}(window.jQuery);

(function(){"use strict";var currentElement;var flashState={bridge:null,version:"0.0.0",disabled:null,outdated:null,ready:null};var _clipData={};var clientIdCounter=0;var _clientMeta={};var elementIdCounter=0;var _elementMeta={};var _amdModuleId=null;var _cjsModuleId=null;var _swfPath=function(){var i,jsDir,tmpJsPath,jsPath,swfPath="ZeroClipboard.swf";if(document.currentScript&&(jsPath=document.currentScript.src)){}else{var scripts=document.getElementsByTagName("script");if("readyState"in scripts[0]){for(i=scripts.length;i--;){if(scripts[i].readyState==="interactive"&&(jsPath=scripts[i].src)){break}}}else if(document.readyState==="loading"){jsPath=scripts[scripts.length-1].src}else{for(i=scripts.length;i--;){tmpJsPath=scripts[i].src;if(!tmpJsPath){jsDir=null;break}tmpJsPath=tmpJsPath.split("#")[0].split("?")[0];tmpJsPath=tmpJsPath.slice(0,tmpJsPath.lastIndexOf("/")+1);if(jsDir==null){jsDir=tmpJsPath}else if(jsDir!==tmpJsPath){jsDir=null;break}}if(jsDir!==null){jsPath=jsDir}}}if(jsPath){jsPath=jsPath.split("#")[0].split("?")[0];swfPath=jsPath.slice(0,jsPath.lastIndexOf("/")+1)+swfPath}return swfPath}();var _camelizeCssPropName=function(){var matcherRegex=/\-([a-z])/g,replacerFn=function(match,group){return group.toUpperCase()};return function(prop){return prop.replace(matcherRegex,replacerFn)}}();var _getStyle=function(el,prop){var value,camelProp,tagName,possiblePointers,i,len;if(window.getComputedStyle){value=window.getComputedStyle(el,null).getPropertyValue(prop)}else{camelProp=_camelizeCssPropName(prop);if(el.currentStyle){value=el.currentStyle[camelProp]}else{value=el.style[camelProp]}}if(prop==="cursor"){if(!value||value==="auto"){tagName=el.tagName.toLowerCase();if(tagName==="a"){return"pointer"}}}return value};var _elementMouseOver=function(event){if(!event){event=window.event}var target;if(this!==window){target=this}else if(event.target){target=event.target}else if(event.srcElement){target=event.srcElement}ZeroClipboard.activate(target)};var _addEventHandler=function(element,method,func){if(!element||element.nodeType!==1){return}if(element.addEventListener){element.addEventListener(method,func,false)}else if(element.attachEvent){element.attachEvent("on"+method,func)}};var _removeEventHandler=function(element,method,func){if(!element||element.nodeType!==1){return}if(element.removeEventListener){element.removeEventListener(method,func,false)}else if(element.detachEvent){element.detachEvent("on"+method,func)}};var _addClass=function(element,value){if(!element||element.nodeType!==1){return element}if(element.classList){if(!element.classList.contains(value)){element.classList.add(value)}return element}if(value&&typeof value==="string"){var classNames=(value||"").split(/\s+/);if(element.nodeType===1){if(!element.className){element.className=value}else{var className=" "+element.className+" ",setClass=element.className;for(var c=0,cl=classNames.length;c<cl;c++){if(className.indexOf(" "+classNames[c]+" ")<0){setClass+=" "+classNames[c]}}element.className=setClass.replace(/^\s+|\s+$/g,"")}}}return element};var _removeClass=function(element,value){if(!element||element.nodeType!==1){return element}if(element.classList){if(element.classList.contains(value)){element.classList.remove(value)}return element}if(value&&typeof value==="string"||value===undefined){var classNames=(value||"").split(/\s+/);if(element.nodeType===1&&element.className){if(value){var className=(" "+element.className+" ").replace(/[\n\t]/g," ");for(var c=0,cl=classNames.length;c<cl;c++){className=className.replace(" "+classNames[c]+" "," ")}element.className=className.replace(/^\s+|\s+$/g,"")}else{element.className=""}}}return element};var _getZoomFactor=function(){var rect,physicalWidth,logicalWidth,zoomFactor=1;if(typeof document.body.getBoundingClientRect==="function"){rect=document.body.getBoundingClientRect();physicalWidth=rect.right-rect.left;logicalWidth=document.body.offsetWidth;zoomFactor=Math.round(physicalWidth/logicalWidth*100)/100}return zoomFactor};var _getDOMObjectPosition=function(obj,defaultZIndex){var info={left:0,top:0,width:0,height:0,zIndex:_getSafeZIndex(defaultZIndex)-1};if(obj.getBoundingClientRect){var rect=obj.getBoundingClientRect();var pageXOffset,pageYOffset,zoomFactor;if("pageXOffset"in window&&"pageYOffset"in window){pageXOffset=window.pageXOffset;pageYOffset=window.pageYOffset}else{zoomFactor=_getZoomFactor();pageXOffset=Math.round(document.documentElement.scrollLeft/zoomFactor);pageYOffset=Math.round(document.documentElement.scrollTop/zoomFactor)}var leftBorderWidth=document.documentElement.clientLeft||0;var topBorderWidth=document.documentElement.clientTop||0;info.left=rect.left+pageXOffset-leftBorderWidth;info.top=rect.top+pageYOffset-topBorderWidth;info.width="width"in rect?rect.width:rect.right-rect.left;info.height="height"in rect?rect.height:rect.bottom-rect.top}return info};var _cacheBust=function(path,options){var cacheBust=options==null||options&&options.cacheBust===true&&options.useNoCache===true;if(cacheBust){return(path.indexOf("?")===-1?"?":"&")+"noCache="+(new Date).getTime()}else{return""}};var _vars=function(options){var i,len,domain,str=[],domains=[],trustedOriginsExpanded=[];if(options.trustedOrigins){if(typeof options.trustedOrigins==="string"){domains.push(options.trustedOrigins)}else if(typeof options.trustedOrigins==="object"&&"length"in options.trustedOrigins){domains=domains.concat(options.trustedOrigins)}}if(options.trustedDomains){if(typeof options.trustedDomains==="string"){domains.push(options.trustedDomains)}else if(typeof options.trustedDomains==="object"&&"length"in options.trustedDomains){domains=domains.concat(options.trustedDomains)}}if(domains.length){for(i=0,len=domains.length;i<len;i++){if(domains.hasOwnProperty(i)&&domains[i]&&typeof domains[i]==="string"){domain=_extractDomain(domains[i]);if(!domain){continue}if(domain==="*"){trustedOriginsExpanded=[domain];break}trustedOriginsExpanded.push.apply(trustedOriginsExpanded,[domain,"//"+domain,window.location.protocol+"//"+domain])}}}if(trustedOriginsExpanded.length){str.push("trustedOrigins="+encodeURIComponent(trustedOriginsExpanded.join(",")))}if(typeof options.jsModuleId==="string"&&options.jsModuleId){str.push("jsModuleId="+encodeURIComponent(options.jsModuleId))}return str.join("&")};var _inArray=function(elem,array,fromIndex){if(typeof array.indexOf==="function"){return array.indexOf(elem,fromIndex)}var i,len=array.length;if(typeof fromIndex==="undefined"){fromIndex=0}else if(fromIndex<0){fromIndex=len+fromIndex}for(i=fromIndex;i<len;i++){if(array.hasOwnProperty(i)&&array[i]===elem){return i}}return-1};var _prepClip=function(elements){if(typeof elements==="string")throw new TypeError("ZeroClipboard doesn't accept query strings.");if(!elements.length)return[elements];return elements};var _dispatchCallback=function(func,context,args,async){if(async){window.setTimeout(function(){func.apply(context,args)},0)}else{func.apply(context,args)}};var _getSafeZIndex=function(val){var zIndex,tmp;if(val){if(typeof val==="number"&&val>0){zIndex=val}else if(typeof val==="string"&&(tmp=parseInt(val,10))&&!isNaN(tmp)&&tmp>0){zIndex=tmp}}if(!zIndex){if(typeof _globalConfig.zIndex==="number"&&_globalConfig.zIndex>0){zIndex=_globalConfig.zIndex}else if(typeof _globalConfig.zIndex==="string"&&(tmp=parseInt(_globalConfig.zIndex,10))&&!isNaN(tmp)&&tmp>0){zIndex=tmp}}return zIndex||0};var _deprecationWarning=function(deprecatedApiName,debugEnabled){if(deprecatedApiName&&debugEnabled!==false&&typeof console!=="undefined"&&console&&(console.warn||console.log)){var deprecationWarning="`"+deprecatedApiName+"` is deprecated. See docs for more info:\n"+"    https://github.com/zeroclipboard/zeroclipboard/blob/master/docs/instructions.md#deprecations";if(console.warn){console.warn(deprecationWarning)}else{console.log(deprecationWarning)}}};var _extend=function(){var i,len,arg,prop,src,copy,target=arguments[0]||{};for(i=1,len=arguments.length;i<len;i++){if((arg=arguments[i])!=null){for(prop in arg){if(arg.hasOwnProperty(prop)){src=target[prop];copy=arg[prop];if(target===copy){continue}if(copy!==undefined){target[prop]=copy}}}}}return target};var _extractDomain=function(originOrUrl){if(originOrUrl==null||originOrUrl===""){return null}originOrUrl=originOrUrl.replace(/^\s+|\s+$/g,"");if(originOrUrl===""){return null}var protocolIndex=originOrUrl.indexOf("//");originOrUrl=protocolIndex===-1?originOrUrl:originOrUrl.slice(protocolIndex+2);var pathIndex=originOrUrl.indexOf("/");originOrUrl=pathIndex===-1?originOrUrl:protocolIndex===-1||pathIndex===0?null:originOrUrl.slice(0,pathIndex);if(originOrUrl&&originOrUrl.slice(-4).toLowerCase()===".swf"){return null}return originOrUrl||null};var _determineScriptAccess=function(){var _extractAllDomains=function(origins,resultsArray){var i,len,tmp;if(origins!=null&&resultsArray[0]!=="*"){if(typeof origins==="string"){origins=[origins]}if(typeof origins==="object"&&"length"in origins){for(i=0,len=origins.length;i<len;i++){if(origins.hasOwnProperty(i)){tmp=_extractDomain(origins[i]);if(tmp){if(tmp==="*"){resultsArray.length=0;resultsArray.push("*");break}if(_inArray(tmp,resultsArray)===-1){resultsArray.push(tmp)}}}}}}};var _accessLevelLookup={always:"always",samedomain:"sameDomain",never:"never"};return function(currentDomain,configOptions){var asaLower,allowScriptAccess=configOptions.allowScriptAccess;if(typeof allowScriptAccess==="string"&&(asaLower=allowScriptAccess.toLowerCase())&&/^always|samedomain|never$/.test(asaLower)){return _accessLevelLookup[asaLower]}var swfDomain=_extractDomain(configOptions.moviePath);if(swfDomain===null){swfDomain=currentDomain}var trustedDomains=[];_extractAllDomains(configOptions.trustedOrigins,trustedDomains);_extractAllDomains(configOptions.trustedDomains,trustedDomains);var len=trustedDomains.length;if(len>0){if(len===1&&trustedDomains[0]==="*"){return"always"}if(_inArray(currentDomain,trustedDomains)!==-1){if(len===1&&currentDomain===swfDomain){return"sameDomain"}return"always"}}return"never"}}();var _objectKeys=function(obj){if(obj==null){return[]}if(Object.keys){return Object.keys(obj)}var keys=[];for(var prop in obj){if(obj.hasOwnProperty(prop)){keys.push(prop)}}return keys};var _deleteOwnProperties=function(obj){if(obj){for(var prop in obj){if(obj.hasOwnProperty(prop)){delete obj[prop]}}}return obj};var _detectFlashSupport=function(){var hasFlash=false;if(typeof flashState.disabled==="boolean"){hasFlash=flashState.disabled===false}else{if(typeof ActiveXObject==="function"){try{if(new ActiveXObject("ShockwaveFlash.ShockwaveFlash")){hasFlash=true}}catch(error){}}if(!hasFlash&&navigator.mimeTypes["application/x-shockwave-flash"]){hasFlash=true}}return hasFlash};function _parseFlashVersion(flashVersion){return flashVersion.replace(/,/g,".").replace(/[^0-9\.]/g,"")}function _isFlashVersionSupported(flashVersion){return parseFloat(_parseFlashVersion(flashVersion))>=10}var ZeroClipboard=function(elements,options){if(!(this instanceof ZeroClipboard)){return new ZeroClipboard(elements,options)}this.id=""+clientIdCounter++;_clientMeta[this.id]={instance:this,elements:[],handlers:{}};if(elements){this.clip(elements)}if(typeof options!=="undefined"){_deprecationWarning("new ZeroClipboard(elements, options)",_globalConfig.debug);ZeroClipboard.config(options)}this.options=ZeroClipboard.config();if(typeof flashState.disabled!=="boolean"){flashState.disabled=!_detectFlashSupport()}if(flashState.disabled===false&&flashState.outdated!==true){if(flashState.bridge===null){flashState.outdated=false;flashState.ready=false;_bridge()}}};ZeroClipboard.prototype.setText=function(newText){if(newText&&newText!==""){_clipData["text/plain"]=newText;if(flashState.ready===true&&flashState.bridge){flashState.bridge.setText(newText)}else{}}return this};ZeroClipboard.prototype.setSize=function(width,height){if(flashState.ready===true&&flashState.bridge){flashState.bridge.setSize(width,height)}else{}return this};var _setHandCursor=function(enabled){if(flashState.ready===true&&flashState.bridge){flashState.bridge.setHandCursor(enabled)}else{}};ZeroClipboard.prototype.destroy=function(){this.unclip();this.off();delete _clientMeta[this.id]};var _getAllClients=function(){var i,len,client,clients=[],clientIds=_objectKeys(_clientMeta);for(i=0,len=clientIds.length;i<len;i++){client=_clientMeta[clientIds[i]].instance;if(client&&client instanceof ZeroClipboard){clients.push(client)}}return clients};ZeroClipboard.version="1.3.2";var _globalConfig={swfPath:_swfPath,trustedDomains:window.location.host?[window.location.host]:[],cacheBust:true,forceHandCursor:false,zIndex:999999999,debug:true,title:null,autoActivate:true};ZeroClipboard.config=function(options){if(typeof options==="object"&&options!==null){_extend(_globalConfig,options)}if(typeof options==="string"&&options){if(_globalConfig.hasOwnProperty(options)){return _globalConfig[options]}return}var copy={};for(var prop in _globalConfig){if(_globalConfig.hasOwnProperty(prop)){if(typeof _globalConfig[prop]==="object"&&_globalConfig[prop]!==null){if("length"in _globalConfig[prop]){copy[prop]=_globalConfig[prop].slice(0)}else{copy[prop]=_extend({},_globalConfig[prop])}}else{copy[prop]=_globalConfig[prop]}}}return copy};ZeroClipboard.destroy=function(){ZeroClipboard.deactivate();for(var clientId in _clientMeta){if(_clientMeta.hasOwnProperty(clientId)&&_clientMeta[clientId]){var client=_clientMeta[clientId].instance;if(client&&typeof client.destroy==="function"){client.destroy()}}}var htmlBridge=_getHtmlBridge(flashState.bridge);if(htmlBridge&&htmlBridge.parentNode){htmlBridge.parentNode.removeChild(htmlBridge);flashState.ready=null;flashState.bridge=null}};ZeroClipboard.activate=function(element){if(currentElement){_removeClass(currentElement,_globalConfig.hoverClass);_removeClass(currentElement,_globalConfig.activeClass)}currentElement=element;_addClass(element,_globalConfig.hoverClass);_reposition();var newTitle=_globalConfig.title||element.getAttribute("title");if(newTitle){var htmlBridge=_getHtmlBridge(flashState.bridge);if(htmlBridge){htmlBridge.setAttribute("title",newTitle)}}var useHandCursor=_globalConfig.forceHandCursor===true||_getStyle(element,"cursor")==="pointer";_setHandCursor(useHandCursor)};ZeroClipboard.deactivate=function(){var htmlBridge=_getHtmlBridge(flashState.bridge);if(htmlBridge){htmlBridge.style.left="0px";htmlBridge.style.top="-9999px";htmlBridge.removeAttribute("title")}if(currentElement){_removeClass(currentElement,_globalConfig.hoverClass);_removeClass(currentElement,_globalConfig.activeClass);currentElement=null}};var _bridge=function(){var flashBridge,len;var container=document.getElementById("global-zeroclipboard-html-bridge");if(!container){var opts=ZeroClipboard.config();opts.jsModuleId=typeof _amdModuleId==="string"&&_amdModuleId||typeof _cjsModuleId==="string"&&_cjsModuleId||null;var allowScriptAccess=_determineScriptAccess(window.location.host,_globalConfig);var flashvars=_vars(opts);var swfUrl=_globalConfig.moviePath+_cacheBust(_globalConfig.moviePath,_globalConfig);var html='      <object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" id="global-zeroclipboard-flash-bridge" width="100%" height="100%">         <param name="movie" value="'+swfUrl+'"/>         <param name="allowScriptAccess" value="'+allowScriptAccess+'"/>         <param name="scale" value="exactfit"/>         <param name="loop" value="false"/>         <param name="menu" value="false"/>         <param name="quality" value="best" />         <param name="bgcolor" value="#ffffff"/>         <param name="wmode" value="transparent"/>         <param name="flashvars" value="'+flashvars+'"/>         <embed src="'+swfUrl+'"           loop="false" menu="false"           quality="best" bgcolor="#ffffff"           width="100%" height="100%"           name="global-zeroclipboard-flash-bridge"           allowScriptAccess="'+allowScriptAccess+'"           allowFullScreen="false"           type="application/x-shockwave-flash"           wmode="transparent"           pluginspage="http://www.macromedia.com/go/getflashplayer"           flashvars="'+flashvars+'"           scale="exactfit">         </embed>       </object>';container=document.createElement("div");container.id="global-zeroclipboard-html-bridge";container.setAttribute("class","global-zeroclipboard-container");container.style.position="absolute";container.style.left="0px";container.style.top="-9999px";container.style.width="15px";container.style.height="15px";container.style.zIndex=""+_getSafeZIndex(_globalConfig.zIndex);document.body.appendChild(container);container.innerHTML=html}flashBridge=document["global-zeroclipboard-flash-bridge"];if(flashBridge&&(len=flashBridge.length)){flashBridge=flashBridge[len-1]}flashState.bridge=flashBridge||container.children[0].lastElementChild};var _getHtmlBridge=function(flashBridge){var isFlashElement=/^OBJECT|EMBED$/;var htmlBridge=flashBridge&&flashBridge.parentNode;while(htmlBridge&&isFlashElement.test(htmlBridge.nodeName)&&htmlBridge.parentNode){htmlBridge=htmlBridge.parentNode}return htmlBridge||null};var _reposition=function(){if(currentElement){var pos=_getDOMObjectPosition(currentElement,_globalConfig.zIndex);var htmlBridge=_getHtmlBridge(flashState.bridge);if(htmlBridge){htmlBridge.style.top=pos.top+"px";htmlBridge.style.left=pos.left+"px";htmlBridge.style.width=pos.width+"px";htmlBridge.style.height=pos.height+"px";htmlBridge.style.zIndex=pos.zIndex+1}if(flashState.ready===true&&flashState.bridge){flashState.bridge.setSize(pos.width,pos.height)}}return this};ZeroClipboard.prototype.on=function(eventName,func){var i,len,events,added={},handlers=_clientMeta[this.id]&&_clientMeta[this.id].handlers;if(typeof eventName==="string"&&eventName){events=eventName.toLowerCase().split(/\s+/)}else if(typeof eventName==="object"&&eventName&&typeof func==="undefined"){for(i in eventName){if(eventName.hasOwnProperty(i)&&typeof i==="string"&&i&&typeof eventName[i]==="function"){this.on(i,eventName[i])}}}if(events&&events.length){for(i=0,len=events.length;i<len;i++){eventName=events[i].replace(/^on/,"");added[eventName]=true;if(!handlers[eventName]){handlers[eventName]=[]}handlers[eventName].push(func)}if(added.noflash&&flashState.disabled){_receiveEvent.call(this,"noflash",{})}if(added.wrongflash&&flashState.outdated){_receiveEvent.call(this,"wrongflash",{flashVersion:flashState.version})}if(added.load&&flashState.ready){_receiveEvent.call(this,"load",{flashVersion:flashState.version})}}return this};ZeroClipboard.prototype.off=function(eventName,func){var i,len,foundIndex,events,perEventHandlers,handlers=_clientMeta[this.id]&&_clientMeta[this.id].handlers;if(arguments.length===0){events=_objectKeys(handlers)}else if(typeof eventName==="string"&&eventName){events=eventName.split(/\s+/)}else if(typeof eventName==="object"&&eventName&&typeof func==="undefined"){for(i in eventName){if(eventName.hasOwnProperty(i)&&typeof i==="string"&&i&&typeof eventName[i]==="function"){this.off(i,eventName[i])}}}if(events&&events.length){for(i=0,len=events.length;i<len;i++){eventName=events[i].toLowerCase().replace(/^on/,"");perEventHandlers=handlers[eventName];if(perEventHandlers&&perEventHandlers.length){if(func){foundIndex=_inArray(func,perEventHandlers);while(foundIndex!==-1){perEventHandlers.splice(foundIndex,1);foundIndex=_inArray(func,perEventHandlers,foundIndex)}}else{handlers[eventName].length=0}}}}return this};ZeroClipboard.prototype.handlers=function(eventName){var prop,copy=null,handlers=_clientMeta[this.id]&&_clientMeta[this.id].handlers;if(handlers){if(typeof eventName==="string"&&eventName){return handlers[eventName]?handlers[eventName].slice(0):null}copy={};for(prop in handlers){if(handlers.hasOwnProperty(prop)&&handlers[prop]){copy[prop]=handlers[prop].slice(0)}}}return copy};var _dispatchClientCallbacks=function(eventName,context,args,async){var handlers=_clientMeta[this.id]&&_clientMeta[this.id].handlers[eventName];if(handlers&&handlers.length){var i,len,func,originalContext=context||this;for(i=0,len=handlers.length;i<len;i++){func=handlers[i];context=originalContext;if(typeof func==="string"&&typeof window[func]==="function"){func=window[func]}if(typeof func==="object"&&func&&typeof func.handleEvent==="function"){context=func;func=func.handleEvent}if(typeof func==="function"){_dispatchCallback(func,context,args,async)}}}return this};ZeroClipboard.prototype.clip=function(elements){elements=_prepClip(elements);for(var i=0;i<elements.length;i++){if(elements.hasOwnProperty(i)&&elements[i]&&elements[i].nodeType===1){if(!elements[i].zcClippingId){elements[i].zcClippingId="zcClippingId_"+elementIdCounter++;_elementMeta[elements[i].zcClippingId]=[this.id];if(_globalConfig.autoActivate===true){_addEventHandler(elements[i],"mouseover",_elementMouseOver)}}else if(_inArray(this.id,_elementMeta[elements[i].zcClippingId])===-1){_elementMeta[elements[i].zcClippingId].push(this.id)}var clippedElements=_clientMeta[this.id].elements;if(_inArray(elements[i],clippedElements)===-1){clippedElements.push(elements[i])}}}return this};ZeroClipboard.prototype.unclip=function(elements){var meta=_clientMeta[this.id];if(meta){var clippedElements=meta.elements;var arrayIndex;if(typeof elements==="undefined"){elements=clippedElements.slice(0)}else{elements=_prepClip(elements)}for(var i=elements.length;i--;){if(elements.hasOwnProperty(i)&&elements[i]&&elements[i].nodeType===1){arrayIndex=0;while((arrayIndex=_inArray(elements[i],clippedElements,arrayIndex))!==-1){clippedElements.splice(arrayIndex,1)}var clientIds=_elementMeta[elements[i].zcClippingId];if(clientIds){arrayIndex=0;while((arrayIndex=_inArray(this.id,clientIds,arrayIndex))!==-1){clientIds.splice(arrayIndex,1)}if(clientIds.length===0){if(_globalConfig.autoActivate===true){_removeEventHandler(elements[i],"mouseover",_elementMouseOver)}delete elements[i].zcClippingId}}}}}return this};ZeroClipboard.prototype.elements=function(){var meta=_clientMeta[this.id];return meta&&meta.elements?meta.elements.slice(0):[]};var _getAllClientsClippedToElement=function(element){var elementMetaId,clientIds,i,len,client,clients=[];if(element&&element.nodeType===1&&(elementMetaId=element.zcClippingId)&&_elementMeta.hasOwnProperty(elementMetaId)){clientIds=_elementMeta[elementMetaId];if(clientIds&&clientIds.length){for(i=0,len=clientIds.length;i<len;i++){client=_clientMeta[clientIds[i]].instance;if(client&&client instanceof ZeroClipboard){clients.push(client)}}}}return clients};_globalConfig.hoverClass="zeroclipboard-is-hover";_globalConfig.activeClass="zeroclipboard-is-active";_globalConfig.trustedOrigins=null;_globalConfig.allowScriptAccess=null;_globalConfig.useNoCache=true;_globalConfig.moviePath="ZeroClipboard.swf";ZeroClipboard.detectFlashSupport=function(){_deprecationWarning("ZeroClipboard.detectFlashSupport",_globalConfig.debug);return _detectFlashSupport()};ZeroClipboard.dispatch=function(eventName,args){if(typeof eventName==="string"&&eventName){var cleanEventName=eventName.toLowerCase().replace(/^on/,"");if(cleanEventName){var clients=currentElement?_getAllClientsClippedToElement(currentElement):_getAllClients();for(var i=0,len=clients.length;i<len;i++){_receiveEvent.call(clients[i],cleanEventName,args)}}}};ZeroClipboard.prototype.setHandCursor=function(enabled){_deprecationWarning("ZeroClipboard.prototype.setHandCursor",_globalConfig.debug);enabled=typeof enabled==="boolean"?enabled:!!enabled;_setHandCursor(enabled);_globalConfig.forceHandCursor=enabled;return this};ZeroClipboard.prototype.reposition=function(){_deprecationWarning("ZeroClipboard.prototype.reposition",_globalConfig.debug);return _reposition()};ZeroClipboard.prototype.receiveEvent=function(eventName,args){_deprecationWarning("ZeroClipboard.prototype.receiveEvent",_globalConfig.debug);if(typeof eventName==="string"&&eventName){var cleanEventName=eventName.toLowerCase().replace(/^on/,"");if(cleanEventName){_receiveEvent.call(this,cleanEventName,args)}}};ZeroClipboard.prototype.setCurrent=function(element){_deprecationWarning("ZeroClipboard.prototype.setCurrent",_globalConfig.debug);ZeroClipboard.activate(element);return this};ZeroClipboard.prototype.resetBridge=function(){_deprecationWarning("ZeroClipboard.prototype.resetBridge",_globalConfig.debug);ZeroClipboard.deactivate();return this};ZeroClipboard.prototype.setTitle=function(newTitle){_deprecationWarning("ZeroClipboard.prototype.setTitle",_globalConfig.debug);newTitle=newTitle||_globalConfig.title||currentElement&&currentElement.getAttribute("title");if(newTitle){var htmlBridge=_getHtmlBridge(flashState.bridge);if(htmlBridge){htmlBridge.setAttribute("title",newTitle)}}return this};ZeroClipboard.setDefaults=function(options){_deprecationWarning("ZeroClipboard.setDefaults",_globalConfig.debug);ZeroClipboard.config(options)};ZeroClipboard.prototype.addEventListener=function(eventName,func){_deprecationWarning("ZeroClipboard.prototype.addEventListener",_globalConfig.debug);return this.on(eventName,func)};ZeroClipboard.prototype.removeEventListener=function(eventName,func){_deprecationWarning("ZeroClipboard.prototype.removeEventListener",_globalConfig.debug);return this.off(eventName,func)};ZeroClipboard.prototype.ready=function(){_deprecationWarning("ZeroClipboard.prototype.ready",_globalConfig.debug);return flashState.ready===true};var _receiveEvent=function(eventName,args){eventName=eventName.toLowerCase().replace(/^on/,"");var cleanVersion=args&&args.flashVersion&&_parseFlashVersion(args.flashVersion)||null;var element=currentElement;var performCallbackAsync=true;switch(eventName){case"load":if(cleanVersion){if(!_isFlashVersionSupported(cleanVersion)){_receiveEvent.call(this,"onWrongFlash",{flashVersion:cleanVersion});return}flashState.outdated=false;flashState.ready=true;flashState.version=cleanVersion}break;case"wrongflash":if(cleanVersion&&!_isFlashVersionSupported(cleanVersion)){flashState.outdated=true;flashState.ready=false;flashState.version=cleanVersion}break;case"mouseover":_addClass(element,_globalConfig.hoverClass);break;case"mouseout":if(_globalConfig.autoActivate===true){ZeroClipboard.deactivate()}break;case"mousedown":_addClass(element,_globalConfig.activeClass);break;case"mouseup":_removeClass(element,_globalConfig.activeClass);break;case"datarequested":var targetId=element.getAttribute("data-clipboard-target"),targetEl=!targetId?null:document.getElementById(targetId);if(targetEl){var textContent=targetEl.value||targetEl.textContent||targetEl.innerText;if(textContent){this.setText(textContent)}}else{var defaultText=element.getAttribute("data-clipboard-text");if(defaultText){this.setText(defaultText)}}performCallbackAsync=false;break;case"complete":_deleteOwnProperties(_clipData);break}var context=element;var eventArgs=[this,args];return _dispatchClientCallbacks.call(this,eventName,context,eventArgs,performCallbackAsync)};if(typeof define==="function"&&define.amd){define(["require","exports","module"],function(require,exports,module){_amdModuleId=module&&module.id||null;return ZeroClipboard})}else if(typeof module==="object"&&module&&typeof module.exports==="object"&&module.exports){_cjsModuleId=module.id||null;module.exports=ZeroClipboard}else{window.ZeroClipboard=ZeroClipboard}})();

(function($){var clipboard={},clip=null;$.fn.copy_button=function(input_to_copy,clip_to_reuse){var $element=this,original_text=$element[0].text,$input_to_copy=$(input_to_copy);if(clip_to_reuse){clip=clip_to_reuse;delete clip.handlers;clip.handlers={}}else{if(clipboard[this]){delete clipboard[this]}clip=new ZeroClipboard($element,{trustedDomains:["*"],allowScriptAccess:"always",cacheBust:false,moviePath:Site.STATIC_URL.replace("https:","")+"common/lib/clipboard/ZeroClipboard-1.3.2.swf"});clip.setHandCursor(true);$(window).bind("resize",function(){clip.reposition()})}clip.on("dataRequested",function(client,args){client.setText($input_to_copy.val())});clip.on("load",function(client){client.on("complete",function(client,args){var $element=$(this);$element.text(gettext("Copied!"));window.setTimeout(function(){$element.text(original_text)},1200);var input_contents=$input_to_copy.data("contents");if(typeof Prezi!="undefined"&&"data"in Prezi){if(input_contents===undefined){if($input_to_copy.attr("id")=="inp_view_together_url"){input_contents="view_together_url"}}if(input_contents===undefined){$.log((Prezi.data.permissions["public"]?"public":"private")+" share copy_url WARNING "+input_contents+" button"+" [id:"+$input_to_copy.attr("id")+" , tagname:"+$input_to_copy.get(0).tagName+"] "+navigator.userAgent)}else{$.log((Prezi.data.permissions["public"]?"public":"private")+" share copy_url "+input_contents+" button")}}})});if(clip_to_reuse){clip.reposition($element)}};$(function(){$(".copy").each(function(){var $button=$(this);var copy=$button.data("copy");if(copy){var input_to_copy=$("#"+copy);$button.copy_button(input_to_copy)}});$(".shareable-data-container").each(function(){var $field=$(this);var contents=$field.data("contents");$field.bind({copy:function(){$.log((Prezi.data.permissions["public"]?"public":"private")+" share copy_url "+contents+" wo_button")}})});$("body").delegate("#ln_send_view_email","click",function(){var recipients=$("#form_share_view_recipient").val().split(" ").join("");var personal_note=$("#note").val().length;$.log((Prezi.data.permissions["public"]?"public":"private")+" share email view_url button "+recipients+" "+personal_note)});$("body").delegate("#ln_send_edit_email","click",function(){var recipients=$("#form_share_edit_recipient").val().split(" ").join("");var personal_note=$("#note").val().length;$.log((Prezi.data.permissions["public"]?"public":"private")+" share email edit_url button "+recipients+" "+personal_note)});$("body").delegate("#btn_share_view_group","click",function(){var personal_note=$("#note").val().length;$.log((Prezi.data.permissions["public"]?"public":"private")+" share group view_url button "+personal_note)});$("body").delegate("#btn_share_edit_group","click",function(){var personal_note=$("#note").val().length;$.log((Prezi.data.permissions["public"]?"public":"private")+" share group edit_url button "+personal_note)});$("body").delegate("#ln_share_view_facebook","click",function(){$.log((Prezi.data.permissions["public"]?"public":"private")+" share facebook view_url button")});$("body").delegate("#ln_share_view_twitter","click",function(){$.log((Prezi.data.permissions["public"]?"public":"private")+" share twitter view_url button")});$("body").delegate("#ln_reset_links","click",function(){$.log((Prezi.data.permissions["public"]?"public":"private")+" share reset_share_links_pressed")})})})(jQuery);

$(function(){Mustache.tags=["<%=","%>"];if(!Site.disablePermissionsApp){if(!Share.Models.presentation){var among_viewers=false,is_js_prezi=Prezi.data.is_js_prezi!=undefined&&Prezi.data.is_js_prezi,is_coedit_enabled=is_js_prezi&&Prezi.data.is_coedit_enabled!=undefined&&Prezi.data.is_coedit_enabled;if(Prezi.data.permissions){for(var i=0;i<Prezi.data.permissions.viewers.length;i++){if(Prezi.data.permissions.viewers[i].id==Prezi.data.userid){among_viewers=true}}}Share.Models.presentation=new Share.Models.Presentation({oid:Prezi.data.oid,privacy:Prezi.data.permissions.privacy,permissions:Prezi.data.permissions,copyright:parseInt(Prezi.data.reusable),is_collaborator:false,can_set_private:Prezi.data.permissions.can_set_private,user_id:Prezi.data.userid,owner_id:Prezi.data.owner_id,license:Prezi.data.license,viewerstate:Prezi.data.viewerstate,canonical_landing_url_short:Prezi.data.canonical_landing_url_short+"?utm_campaign=share&utm_medium=copy&rc=ex0share",use_basic_sharing_panel:Prezi.data.userid=="None"||!(among_viewers||Prezi.data.permissions.can_edit||Prezi.data.permissions.is_owner),current_user_is_owner:Prezi.data.permissions.is_owner,location:"landing",title:Prezi.data.prezi_title,is_js_prezi:is_js_prezi,is_coedit_enabled:is_coedit_enabled})}Share.Views.privacyButton=new Share.Views.PrivacyButton({model:Share.Models.presentation});Share.Views.modalView=new Share.Views.ModalView({model:Share.Models.presentation});if(window.location.hash&&window.location.hash=="#share"){Share.Views.modalView.$el.trigger("click")}}});

Share.Models.UserPermissionModel=Backbone.Model.extend({coedit_base_url:"/coeditshare",api_url_setpermission:"/api/presentations/setpermission/",api_url_revoke:"/api/presentations/share/unsubscribe/",server_call_timeout:5e3,initialize:function(attrs,options){this.view=new Share.Views.UserPermissionView({presentation_model:Share.Models.presentation});this.description=options.description;this.userListView=options.userListView},render:function(){return this.view.render(this)},change:function(){var url=this.api_url_setpermission;if(this.get("use_coedit")){url=this.coedit_base_url+this.api_url_setpermission}var post_data={id:this.get("oid"),target_user_email:this.get("email")};if(this.get("viewer")===false&&this.get("editor")===true){post_data["list"]="1"}else{post_data["list"]="2"}$.ajax({url:url,context:this,type:"POST",async:true,cache:false,timeout:this.server_call_timeout,data:post_data,beforeSend:function(request){request.setRequestHeader("X-CSRFToken",Share.helpers.getCsrfToken()||"")},error:function(xhr,status){Share.broker.trigger("notification:permission:error",gettext("Error changing collaborator's permission"));$.log("simple_sharing ajax error "+status+" ("+xhr.status+") when adding collaborator "+this.post_data.target_user_id)},success:function(response){if(!response.success){Share.broker.trigger("notification:permission:error",gettext("Error changing collaborator's permission"));$.log("simple_sharing backend error when changing collaborator permission "+this.post_data.target_user_id)}else{this.userListView.modifyCollaboratorFinished(this.get("id"))}}})},destroyHandler:function(){var url=this.api_url_revoke;if(this.get("use_coedit")){url=this.coedit_base_url+this.api_url_revoke}$.ajax({url:url,context:this,type:"POST",async:true,cache:false,timeout:this.server_call_timeout,data:{id:this.get("oid"),user:this.get("id")},beforeSend:function(request){request.setRequestHeader("X-CSRFToken",Share.helpers.getCsrfToken()||"")},error:function(){Share.broker.trigger("notification:permission:error",gettext("Error removing collaborator"))},success:function(response){this.userListView.removeCollaborator(this.get("id"))}})}});Share.Collections.UserList=Backbone.Collection.extend({model:Share.Models.UserPermissionModel,sort_key:"name_lowercase"});

Share.Views.UserPermissionView=Backbone.View.extend({template:$("#user_entry")[0].innerHTML,render:function(userPermissionModel){var permissions=this.options.presentation_model.get("permissions");var current_user_id=null;if(Site.user_id){current_user_id=Site.user_id}else{if(Prezi&&Prezi.data){current_user_id=Prezi.data.userid}}var is_current_viewer=permissions.can_view&&userPermissionModel.get("id")==current_user_id;var new_element=Mustache.render(this.template,{id:userPermissionModel.get("id"),name:userPermissionModel.get("name"),obfuscated_email:Share.helpers.obfuscateEmail(userPermissionModel.get("email")),editor:userPermissionModel.get("editor")&&!userPermissionModel.get("owner"),viewer:userPermissionModel.get("viewer"),owner:userPermissionModel.get("owner"),can_edit:permissions.can_edit||userPermissionModel.get("owner"),show_dropdown_with_remove:(permissions.is_owner||permissions.can_edit||is_current_viewer)&&!userPermissionModel.get("owner"),current_user_can_change:permissions.can_edit,show_dropdown:(permissions.can_edit||permissions.is_owner||is_current_viewer)&&userPermissionModel.get("id")!=permissions.owner_id,avatar:userPermissionModel.get("avatar")});this.$el=$(new_element);$(".user-list-entry",this.$el).mouseenter(function(e){$($(this).find(".contact-permission-detail")[0]).show(0);$($(this).find("small.contact-email")[0]).show(0);$($(this).find(".modify-permission-toggle")[0]).show(0);$(this).addClass("highlight");if($(this).hasClass("can_change")){$(this).css("cursor","pointer")}});$(".user-list-entry",this.$el).mouseleave(function(e){$($(this).find(".contact-permission-detail")[0]).stop(false,true).hide();$($(this).find("small.contact-email")[0]).stop(false,true).hide();$($(this).find(".modify-permission-toggle")[0]).stop(false,true).hide(0);$(this).removeClass("highlight");$(this).css("cursor","auto")});$(".user-list-entry",this.$el).click(function(e){if(!($(e.target).hasClass("modify-permission-toggle")||$(e.target).hasClass("modify-permission-element"))){$($(this).find(".modify-permission-toggle")[0]).click();e.stopPropagation()}});$("a.modify-permission-element, a.remove-contact",this.$el).hover(function(){var icon=$(this).find("i");if(!icon.hasClass("icon-white")){icon.addClass("icon-white")}},function(){$(this).find("i").removeClass("icon-white")});return this.$el}});

Share.Views.UserListView=Backbone.View.extend({el:"#collablist",events:{"click .remove-contact":"removeUser","click .modify-permission-element":"modifyCollaborator","click button.modify-permission-toggle":"dropDownClicked"},initialize:function(){this.description=this.options.description;this.collaborators=new Share.Collections.UserList},addCollaborator:function(user_data){var user=new Share.Models.UserPermissionModel(user_data,{description:this.description,userListView:this});this.collaborators.add(user);$(user.render()).prependTo(this.$el)},dropDownClicked:function(){var selected_user_id=$(event.target).parents("li").last().data("id");var selected_user=this.collaborators.get(selected_user_id);var current_permission=selected_user.get("editor")?"editor":"viewer";$.log(Share.helpers.getPrivacyState()+" sharing "+this.model.get("location")+" permission_dropdown_btn "+current_permission+" "+selected_user.get("email"))},removeCollaborator:function(id){$(this.$el.find("li[data-id='"+id+"']")[0]).fadeOut("normal",function(){$(this).remove()});var selected_user=this.collaborators.get(id);var current_permission=selected_user.get("editor")?"editor":"viewer";$.log(Share.helpers.getPrivacyState()+" sharing "+this.model.get("location")+" permission_change "+current_permission+" none "+selected_user.get("email"));this.collaborators.remove(id);var permissions=this.model.get("permissions");permissions.collab_count--;this.model.set({permissions:permissions});this.description.destroy();this.description=new Share.Views.Description({model:this.model});if(id==this.model.get("user_id")&&location.href.indexOf("/your/")==-1){location.href="/your/"}},modifyCollaborator:function(event){var selected_user_id=$(event.target).parents("li").last().data("id");var selected_user=this.collaborators.get(selected_user_id);var current_permission=selected_user.get("editor")?"editor":"viewer";this.permission_changed=false;if($(event.target).data("permission")=="editor"&&current_permission!="editor"){selected_user.set({viewer:false,editor:true});this.permission_changed=true;$.log(Share.helpers.getPrivacyState()+" sharing "+this.model.get("location")+" permission_change viewer editor "+selected_user.get("email"))}else if($(event.target).data("permission")=="viewer"&&current_permission!="viewer"){selected_user.set({viewer:true,editor:false});this.permission_changed=true;$.log(Share.helpers.getPrivacyState()+" sharing "+this.model.get("location")+" permission_change editor viewer "+selected_user.get("email"))}if(this.permission_changed){selected_user.change()}},modifyCollaboratorFinished:function(user_id){var selected_user=this.collaborators.get(user_id);$(this.$el.find("li[data-id='"+user_id+"']")[0]).replaceWith(selected_user.render())},getCollaborators:function(){var that=this;var userid=this.model.get("user_id");var ownerid=this.model.get("owner_id");this.userlist=this.model.get("permissions").viewers.concat(this.model.get("permissions").editors);this.userlist=_.reject(this.userlist,function(user){return user.id==userid||user.id==ownerid}).sort(function(a,b){var name1=!b.name||b.name.length==0?b.email:b.name;var name2=!a.name||a.name.length==0?a.email:a.name;return name1.toLowerCase().localeCompare(name2.toLowerCase())}).concat(_.filter(this.userlist,function(user){return user.id==ownerid})).concat(_.filter(this.userlist,function(user){return user.id==userid})).reverse();$.each(this.userlist,function(index,user){if(userid==user.id){that.model.set("is_collaborator",true)}var you_text=gettext("You");that.collaborators.add(new Share.Models.UserPermissionModel({id:user.id,name:userid==user.id?you_text:user.name,name_lowercase:user.name.toLocaleLowerCase(),email:user.email,editor:user.is_editor,viewer:user.is_viewer,owner:user.id==ownerid,avatar:user.avatar,use_coedit:that.model.get("is_js_prezi")&&that.model.get("is_coedit_enabled"),oid:that.model.get("oid")},{permission_notification:that.permission_notification,description:that.description,userListView:that}))})},show:function(){var that=this;this.collaborators.each(function(collaborator){$(collaborator.render()).appendTo(that.$el)})},removeUser:function(e){var selected_user_id=$(e.currentTarget).parents("li").last().data("id");var selected_user=this.collaborators.get(selected_user_id);selected_user.destroyHandler()},destroy:function(){this.undelegateEvents();this.$el.empty();this.stopListening()}});

Share.Views.UserListInputView=Backbone.View.extend({coedit_base_url:"/coeditshare",el:"#add-panel",api_url_add:"/api/presentations/setpermission/",level:1,events:{"click #add-btn":"addUser","click #add-viewer":"setLevel","click #add-editor":"setLevel","input #add-fld":"inputGiven"},ensure_single_row:function(){$("#add-fld").width($("#add-panel").width()-20-$("#add-options").outerWidth(true)-$("#add-btn").outerWidth(true))},initialize:function(){this.userListView=this.options.userListView;this.description=this.options.description;var current_view=this;$("#add-controls").hide();$("#add-fld").addClass("full-width-input");$("#add-fld").removeAttr("style");$("#add-fld").focus(function(){$("#add-controls").show();$("#add-fld").removeClass("full-width-input");current_view.ensure_single_row()});var leaveOptionHandler=function(){$(this).find("i").removeClass("icon-white")};$("#add-viewer, #add-editor").hover(function(){var icon=$(this).find("i");if(!icon.hasClass("icon-white")){icon.addClass("icon-white")}},leaveOptionHandler).click(leaveOptionHandler);var bind_typeahead_events=function(){$("#add-fld").typeahead({source:Share.Views.search_array,minLength:2,updater:function(item){var selected_email=Share.Views.contact_list[item].email?Share.Views.contact_list[item].email:Share.Views.contact_list[item].name;$.log(Share.helpers.getPrivacyState()+" sharing "+current_view.model.get("location")+" autocomplete_select "+selected_email);$("#add-btn").removeAttr("disabled").removeClass("disabled");return selected_email},matcher:function(item){var contact=Share.Views.contact_list[item];return contact.name.toLowerCase().indexOf(this.query.toLowerCase())!=-1||contact.email.toLowerCase().indexOf(this.query.toLowerCase())!=-1},highlighter:function(item){return item}})};if(!Share.Views.contact_list){Share.Views.contact_list={};Share.Views.search_array=[];Share.Views.plain_contact_list={};var csrfToken=Share.helpers.getCsrfToken();if(csrfToken===null){$.log("simple_sharing missing_csrftoken");return}var url="//"+Prezi.contact_api_domain+"/contacts/?_method=GET&_callback=?&csrftoken="+csrfToken;$.getJSON(url,{format:"json"}).done(function(data){if(data.data){Share.Views.plain_contact_list=data.data;$.each(data.data,function(index,contact){if(!contact.name){contact.name=contact.email;contact.email=""}if(!contact.avatar){contact.avatar="//prezi.com/assets/share/static/img/face.png"}var key='<div class="media-body user-list-entry">'+'<div class="pull-left avatar-image">'+'<img src="'+encodeURI(contact.avatar)+'"/>'+"</div>"+'<div class="pull-left contact-name"><p>'+_.escape(contact.name)+"</p></div>"+'<div class="pull-left contact-email-container">'+'<small class="ac-contact-email">'+_.escape(contact.email)+"</small>"+"</div>"+"</div>";Share.Views.contact_list[key]=contact;Share.Views.search_array.push(key)})}bind_typeahead_events()})}else{bind_typeahead_events()}},inputGiven:function(event){var email=$(this.$el.find("#add-fld")[0]).val();if(email.length>=4&&email.indexOf("@")!=-1){$("#add-btn").removeAttr("disabled").removeClass("disabled")}else{$("#add-btn").attr("disabled","disabled").addClass("disabled")}},setLevel:function(event){if($(event.target).attr("id")=="add-viewer"){this.level=2;this.$el.find("span#active-selection")[0].innerHTML=this.$el.find("a#add-viewer")[0].innerHTML;$.log(Share.helpers.getPrivacyState()+" sharing "+this.model.get("location")+" permission_set viewer")}if($(event.target).attr("id")=="add-editor"){this.level=1;this.$el.find("span#active-selection")[0].innerHTML=this.$el.find("a#add-editor")[0].innerHTML;$.log(Share.helpers.getPrivacyState()+" sharing "+this.model.get("location")+" permission_set editor")}this.ensure_single_row()},is_contact:function(email_address){var is_contact=false;$.each(Share.Views.plain_contact_list,function(index,contact){var cur_email=contact.email.length<1?contact.name:contact.email;if(cur_email==email_address){is_contact=true}});return is_contact},isValidEmailAddress:function(email){return email.length>=4&&email.indexOf("@")!=-1&&email.indexOf(".")!=-1},addUser:function(e){var email_address=$(this.$el.find("#add-fld")[0]).val();if(this.isValidEmailAddress(email_address)){var found=this.userListView.collaborators.find(function(user){return user.get("email")==email_address});if(found){Share.broker.trigger("notification:permission:error",gettext("User is already in the list"));return}this.email_address=email_address;var url=this.api_url_add;if(this.model.get("is_coedit_enabled")){url=this.coedit_base_url+this.api_url_add}$.ajax({url:url,context:this,type:"POST",async:true,cache:false,timeout:12e3,data:{id:this.model.get("oid"),list:this.level==1?"1,2":"2",target_user_email:email_address,send_invitation:true},beforeSend:function(request){request.setRequestHeader("X-CSRFToken",Share.helpers.getCsrfToken()||"")},error:function(xhr,status,errorThrown){var msg="";if(location.href.indexOf("preprod")>-1){msg="status: "+status+" xhr.status: "+xhr.status+" xhr.statusText: "+xhr.statusText+" xhr.errorTrhown: "+errorThrown}else{msg=xhr.status}Share.broker.trigger("notification:permission:error",gettext("Error adding collaborator")+" ("+msg+")");$.log("simple_sharing ajax error "+status+" ("+xhr.status+","+errorThrown+") when adding collaborator "+this.email_address)},success:function(response){if(!response.success){Share.broker.trigger("notification:permission:error",gettext("Error adding collaborator"));$.log("simple_sharing backend error when adding collaborator "+this.email_address)}else{var is_contact=this.is_contact(this.email_address);if(response.user.id){this.userListView.addCollaborator({id:response.user.id,name:response.user.name,editor:this.level==1,viewer:this.level==2,owner:false,email:response.user.email,avatar:response.user.avatar,oid:this.model.get("oid"),use_coedit:this.model.get("is_coedit_enabled")});var msg=Share.helpers.getPrivacyState()+" sharing "+this.model.get("location")+" "+(this.level==2?"viewer":"editor")+" add "+this.email_address+" user "+(is_contact?"contact":"no_contact");$.log({msg:msg,prezi_id:this.model.get("oid")});var permissions=this.model.get("permissions");permissions.collab_count++;this.model.set({permissions:permissions});this.description.render();Share.broker.trigger("notification:permission:success",gettext("E-mail sent"))}else{Share.broker.trigger("notification:permission:success",gettext("An e-mail was sent. Waiting for person to sign up"));var logmsg=Share.helpers.getPrivacyState()+" sharing "+this.model.get("location")+" "+(this.level==2?"viewer":"editor")+" add "+this.email_address+" no_user "+(is_contact?"contact":"no_contact");$.log({msg:logmsg,prezi_id:this.model.get("oid")})}$(this.$el.find("#add-fld")[0]).val("");$("#add-btn").attr("disabled","disabled").addClass("disabled");this.$el.find("span#active-selection")[0].innerHTML=this.$el.find("a#add-editor")[0].innerHTML;this.level=1}}})}else{Share.broker.trigger("notification:permission:error",gettext("Invalid email address"))}},destroy:function(){this.undelegateEvents();this.stopListening()}});

var Notification=Backbone.View.extend({tagName:"span",className:"notification",initialize:function(options){_.extend(this,options)},render:function(){this.$el.addClass(this.type).text(this.msg).delay(5e3).fadeOut("slow",function(){$(this).remove()});return this}});Share.Views.Notification=Backbone.View.extend({initialize:function(){var prefix="notification:"+this.options.event_prefix+":";Share.broker.on(prefix+"success",this.show.bind(this,"success"));Share.broker.on(prefix+"error",this.show.bind(this,"error"));Share.broker.on(prefix+"info",this.show.bind(this,"info"))},show:function(type,msg){var notification=new Notification({msg:msg,type:type}).render(),$el=this.$el;if(!$el.find(".notification").length){$el.append(notification.$el)}else{$el.find(".notification").replaceWith(notification.$el)}},destroy:function(){this.stopListening()}});

Share.Views.TitleView=Backbone.View.extend({el:"#share-modal-heading",render:function(){$(".privacy-permissions-modal").show();var title=this.model.escape("title");if(!title){title=gettext("Share prezi")}this.$el.html(title)}});Share.Views.ModalView=Backbone.View.extend({el:"#btn_share_modal, #ln_privacy_modal:not(.disabled)",events:{click:"handleShareClick"},template:$("#privacy_and_permissions")[0].innerHTML,handleShareClick:function(e){if(this.model.get("location")=="your"){this.destroy()}var permissions=this.model.get("permissions");var is_coedit_enabled=this.model.get("is_coedit_enabled");var is_core_prezi=!this.model.get("is_js_prezi");var user_can_modify=permissions.can_edit||permissions.is_owner;var can_modify=(is_core_prezi||is_coedit_enabled)&&user_can_modify;this.is_public_user=this.model.get("license").indexOf("PUBLIC")>-1;if(!this.modal){this.modal=$(Mustache.render(this.template,{can_modify:can_modify,canonical_landing_url_short:this.model.get("canonical_landing_url_short"),use_basic_sharing_panel:this.model.get("use_basic_sharing_panel"),current_user_is_owner:this.model.get("current_user_is_owner")}));this.modal.appendTo($("body"));this.modal_margin=this.model.get("location")=="your"?250:150}var license_type_oid=Prezi.data&&Prezi.data.license_type_oid||"-";var putma=Prezi.data&&Prezi.data.putma||"-";$.log(Share.helpers.getPrivacyState()+" sharing "+this.model.get("location")+" share_btn "+putma+" "+license_type_oid);var isWinChrome=$.os.name=="win"&&$.browser.chrome;if(isWinChrome){var height=$("#pEmbed").height();$("#pEmbed").css({position:"absolute",left:"-10000px",top:"-10000px"}).parent().css("height",height+"px")}if(this.model.get("location")=="edit"&&(isWinChrome||$.browser.msie)){var height=$("#content").height();$("#content").css({position:"absolute",left:"-10000px",top:"-10000px"}).parent().css("height",height+"px")}this.modal.modal();$(".privacy-permissions-modal").css("top",Math.max(300,($(window).height()+this.modal_margin-$(".privacy-permissions-modal").outerHeight())/2+$(window).scrollTop())+"px");Share.modal_closed=false;$(this.modal).on("hidden",{location:this.model.get("location")},function(e){if(!Share.modal_closed){$.log(Share.helpers.getPrivacyState()+" sharing "+e.data.location+" share_close")}Share.modal_closed=true;if(isWinChrome){$("#pEmbed").css({position:"static",left:"0px",top:"0px"})}if(e.data.location=="edit"&&(isWinChrome||$.browser.msie)){var height=$("#content").height();$("#content").css({position:"static",left:"0px",top:"0px"})}});this.privacy_notification=new Share.Views.Notification({el:"#modal-privacy-heading",event_prefix:"privacy"});this.permission_notification=new Share.Views.Notification({el:"#modal-permission-heading",event_prefix:"permission"});permissions.collab_count=permissions.editors.length+permissions.viewers.length;this.model.set({permissions:permissions});this.description=new Share.Views.Description({model:this.model});this.titleView=new Share.Views.TitleView({model:this.model});if(!this.userListView){this.userListView=new Share.Views.UserListView({model:this.model,permission_notification:this.permission_notification,description:this.description});if(permissions.can_edit||permissions.is_owner){this.userListInputView=new Share.Views.UserListInputView({model:this.model,userListView:this.userListView,permission_notification:this.permission_notification,description:this.description})}this.userListView.getCollaborators();this.userListView.show()}if($.inArray(Share.helpers.getPrivacyState(),["public","reusable"])>-1&&!this.model.get("is_collaborator")){$("#share-modify-permissions").hide(0)}this.sliderValues={0:"private",1:"hidden",2:"public",3:"reusable"};if(!can_modify){Share.helpers.initializeCopyButton($("#permission-popup-container"),this.model.get("location"))}if(permissions.is_owner){if(!this.sliderView){this.sliderView=new Share.Views.SliderView({model:this.model,values:this.sliderValues})}if(!this.privacyCheckBox){this.privacyCheckBox=new Share.Views.PrivacyCheckbox({model:this.model,el:".privacy-permissions-modal"})}}if(!this.stateView){this.stateView=new Share.Views.PrivacyStateView({model:this.model,values:this.sliderValues,description:this.description,single_disabled:!permissions.is_owner})}this.initializeFakeSlider();this.titleView.render()},destroy:function(){if(this.model.get("location")=="your"){var views=["userListView","userListInputView","stateView","sliderView","privacyCheckBox","fakesliderModalView","fakesliderModal","privacy_notification","permission_notification","description","titleView"];for(var i=0;i<views.length;i++){if(this[views[i]]&&"destroy"in this[views[i]]){this[views[i]].destroy();delete this[views[i]]}}if(this.modal){this.modal.remove();this.modal=null}}Share.copy_overlay=null},initializeFakeSlider:function(){var that=this;Modernizr.load([{test:Modernizr.inputtypes.range&&!(window.ActiveXObject||"ActiveXObject"in window),nope:["/assets/share/js/common/jquery.nouislider.js","/assets/share/css/privacy/jquery.nouislider.css"],callback:function(id,testResult){if(!that.fakesliderModalView){var $input=$(".modal input[type=range]"),min=$input.attr("min"),max=$input.attr("max"),step=$input.attr("step"),disabled=$input.attr("disabled");$input.remove();that.fakesliderModal=$(".modal .slider").noUiSlider({range:[min,max],start:0,step:step,handles:1}).addClass("noUiSlider");if(disabled){that.fakesliderModal.noUiSlider("disabled",true)}that.fakesliderModalView=new Share.Views.FakeSliderView({model:that.model,values:that.sliderValues,el:".modal .noUiSlider"})}}}])}});

Share.Views.Description=Backbone.View.extend({el:"#description-container",template:$("#description-template")[0].innerHTML,initialize:function(){this.copy_overlay=null;this.render();this.model.on("saveSuccess",this.render,this)},render:function(params){var context={};context["public-user"]=this.model.get("license").indexOf("PUBLIC")>-1;if(params&&params.override_privacy){context[params.override_privacy]=true}else{context[this.model.get("privacy")]=true}context["total_collaborators"]=this.model.get("permissions").collab_count;context["other_collaborators"]=context["total_collaborators"]-1;context["has_other_collaborators"]=context["other_collaborators"]>0;context["one_other_collaborator"]=context["other_collaborators"]==1;context["canonical_landing_url_short"]=this.model.get("canonical_landing_url_short");context["is_js_prezi"]=this.model.get("is_js_prezi");context["is_coedit_enabled"]=this.model.get("is_coedit_enabled");this.$el.html(Mustache.render(this.template,context));this.$el.find("span.description-tooltip").tooltip({placement:"bottom",delay:{show:0,hide:300},container:this.$el});if(this.model.get("privacy")!="private"&&!(params&&params.override_privacy)){Share.helpers.initializeCopyButton(this.$el,this.model.get("location"))}return this},destroy:function(){if(this.model.get("location")=="your"){this.stopListening();this.$el.empty();this.copy_overlay=null}}});
