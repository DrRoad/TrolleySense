Share.Views.SliderView=Backbone.View.extend({el:"#slider-container",template:$("#slider-template")[0].innerHTML,events:{"mouseup input":"handleMouseUp"},initialize:function(){var is_owner=this.model.get("current_user_is_owner"),can_set_private=this.model.get("can_set_private"),slider_disabled=!can_set_private;if(is_owner){this.model.on("change",this.render,this)}this.$el.append(Mustache.render(this.template,{slider_disabled:slider_disabled}));this.$input=this.$el.find("input");this.render()},handleMouseUp:function(){var self=this;if(self.timer){clearTimeout(self.timer)}self.timer=setTimeout(function(){self.model.set({privacy:self.getTextValue(self.$input)});self.timer=null},200)},render:function(){var numericValue=this.getKey(this.options.values,this.model.get("privacy"));if(numericValue==3){numericValue=2}this.$input.val(numericValue)},destroy:function(){this.undelegateEvents();this.$el.empty();this.stopListening()}});Share.Views.FakeSliderView=Backbone.View.extend({events:{change:"handleChange"},initialize:function(){if(!this.$el.attr("disabled")){this.model.on("change",this.render,this);this.render()}},handleChange:function(){var self=this;if(self.timer){clearTimeout(self.timer)}self.timer=setTimeout(function(){self.model.set({privacy:self.getTextValue(self.$el)});self.timer=null},500)},render:function(){var numericValue=this.getKey(this.options.values,this.model.get("privacy"));this.$el.val(numericValue)},destroy:function(){this.undelegateEvents();this.$el.empty();this.stopListening()}});Share.Views.PrivacyButton=Backbone.View.extend({el:"#ln_privacy_modal",initialize:function(){this.model.on("saveSuccess",this.render,this);this.value_mapping={private:{label:gettext("Private"),icon_class:"icon-lock",title:gettext("Only those added to the prezi can view or edit.")},hidden:{label:gettext("Hidden"),icon_class:"icon-link",title:gettext("Only those added to the prezi can view or edit. Anyone with the link can view.")},public:{label:gettext("Public"),icon_class:"icon-globe",title:gettext("This prezi can be seen by the world on prezi.com/explore.")},reusable:{label:gettext("Public&Reusable"),icon_class:"icon-reusable",title:gettext("This prezi is publicly reusable.")}};if(this.model.get("viewerstate")=="owner"){var privacy_item=this.getPrivacyItem();this.$el.attr("title",privacy_item.title)}this.$el.tooltip()},render:function(){if(this.model.get("viewerstate")=="owner"){var privacy_item=this.getPrivacyItem();this.$el.find("i").removeClass().addClass(privacy_item.icon_class);this.$el.find("span").text(" "+privacy_item.label);this.$el.attr("title",privacy_item.title);this.$el.tooltip("fixTitle")}},getPrivacyItem:function(){var privacy_value=this.model.get("privacy");return this.value_mapping[privacy_value]}});Share.Views.PrivacyStateView=Backbone.View.extend({tagName:"li",el:"#slider-icons-container",template:$("#slider-icons-template")[0].innerHTML,events:{"click .icon":"handleSelect","mouseenter .icon":"handleMouseEnter","mouseleave .icon":"handleMouseLeave"},handleSelect:function(e){e.preventDefault();if(this.slider_disabled){return}if(this.model.get("current_user_is_owner")){var privacy=$(e.currentTarget).parent().data("type");this.model.set({privacy:privacy,copyright:0})}},handleMouseEnter:function(e){if(this.slider_disabled){return}this.description.render({override_privacy:$(e.currentTarget).parent().data("type"),preview_only:true})},handleMouseLeave:function(e){if(this.slider_disabled){return}this.description.destroy();this.description=new Share.Views.Description({model:this.model})},initialize:function(){var is_owner=this.model.get("current_user_is_owner"),can_set_private=this.model.get("can_set_private"),slider_disabled=!can_set_private,show_upgrade_message=!can_set_private&&is_owner,is_js_prezi=this.model.get("is_js_prezi");this.slider_disabled=slider_disabled;if(is_owner){this.model.on("change",this.render,this)}this.$el.html(Mustache.render(this.template,{current_user_is_owner:is_owner,is_public:this.model.get("privacy")=="public"&&!is_js_prezi,is_private:this.model.get("privacy")=="private"&&!is_js_prezi,is_reusable:this.model.get("privacy")=="reusable"&&!is_js_prezi,is_hidden:this.model.get("privacy")=="hidden"&&!is_js_prezi,single_disabled:this.options.single_disabled||is_js_prezi,slider_disabled:slider_disabled||is_js_prezi,show_upgrade_message:show_upgrade_message&&!is_js_prezi}));this.description=this.options.description;this.render()},render:function(){var level=this.model.get("privacy");this.$el.find("ul").toggleClass("disabled",this.slider_disabled);this.$el.find("li").removeClass("active");this.$el.find("li[data-type="+level+"]").addClass("active")},destroy:function(){this.undelegateEvents();this.$el.empty();this.stopListening()}});Share.Views.PrivacyCheckbox=Backbone.View.extend({template:$("#privacy-box-template")[0].innerHTML,events:{"change #reuse_checkbox":"handleChange"},initialize:function(){this.$checkbox=$("#reuse_checkbox");this.$container=$("#checkbox-container");this.listenTo(this.model,"change",this.render);var permissions=this.model.get("permissions");var content=Mustache.render(this.template,{copyright:permissions.copyright,is_owner:permissions.is_owner});this.$container.empty();this.$container.append(content);this.setElement(this.options.el);this.delegateEvents();this.render()},handleChange:function(){this.model.set({copyright:this.$el.find("#reuse_checkbox").is(":checked")?1:0})},render:function(){if($.inArray(this.model.get("privacy"),["private","hidden"])>-1){$("#i-text-private-hidden").show();$("#i-text-public").hide()}else{$("#i-text-private-hidden").hide();$("#i-text-public").show()}var copyright=this.model.get("copyright");if(copyright===undefined){copyright=this.model.get("permissions").copyright}this.$el.find("#reuse_checkbox").prop("checked",!!copyright)},destroy:function(){this.undelegateEvents();if(this.$container){this.$container.empty()}this.stopListening()}});_.extend(Share.Views.SliderView.prototype,Share.helpers);_.extend(Share.Views.FakeSliderView.prototype,Share.helpers);_.extend(Share.Views.PrivacyStateView.prototype,Share.helpers);

var Notification=Backbone.View.extend({tagName:"span",className:"notification",initialize:function(options){_.extend(this,options)},render:function(){this.$el.addClass(this.type).text(this.msg).delay(5e3).fadeOut("slow",function(){$(this).remove()});return this}});Share.Views.Notification=Backbone.View.extend({initialize:function(){var prefix="notification:"+this.options.event_prefix+":";Share.broker.on(prefix+"success",this.show.bind(this,"success"));Share.broker.on(prefix+"error",this.show.bind(this,"error"));Share.broker.on(prefix+"info",this.show.bind(this,"info"))},show:function(type,msg){var notification=new Notification({msg:msg,type:type}).render(),$el=this.$el;if(!$el.find(".notification").length){$el.append(notification.$el)}else{$el.find(".notification").replaceWith(notification.$el)}},destroy:function(){this.stopListening()}});

Share.Models.Presentation=Backbone.Model.extend({initialize:function(attributes){this.prev_privacy_state=attributes.privacy;this.on("change",this.save,this)},save:function(){var that=this;if(this.changed.hasOwnProperty("privacy")||this.changed.hasOwnProperty("copyright")){var url="/api/presentations/privacy/",data={id:this.get("oid"),privacy:this.get("privacy"),copyright:this.changed.copyright?this.get("copyright"):0};$.ajax({type:"POST",url:url,context:this,data:data,beforeSend:function(request){request.setRequestHeader("X-CSRFToken",Share.helpers.getCsrfToken()||"")},success:function(){Share.broker.trigger("notification:privacy:success",gettext("Privacy level saved"));Share.broker.trigger("presentation:privacy:update",that);$.log(Share.helpers.getPrivacyState()+" sharing "+that.get("location")+" set_privacy "+that.get("privacy"));that.prev_privacy_state=that.get("privacy");that.trigger("saveSuccess")},error:function(){Share.broker.trigger("notification:privacy:error",gettext("Error during saving privacy level"))}})}}});
