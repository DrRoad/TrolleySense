var EMBEDCODE={getHTML:function(data){var PREZI_URL=location.href.split("/")[2],prezi_id=data.id,features=data.features,disabled_features=data.disabled_features,token=data.token,autohide_ctrls=typeof data.autohide_ctrls!="undefined"?data.autohide_ctrls:0,width=typeof data.width!="undefined"?data.width:550,height=typeof data.height!="undefined"?data.height:400,bgcolor=typeof data.bgcolor!="undefined"?data.bgcolor:"ffffff",lock=typeof data.lock!="undefined"?data.lock:0,autoplay=typeof data.autoplay!="undefined"?data.autoplay:0,wmode=typeof data.wmode!="undefined"?data.wmode:"direct",external=typeof data.external!="undefined"?data.external:0,color=typeof data.color!="undefined"?data.color:"ffffff",url_hash=(data.url_hash||"").substr(1),base_url;if(external){base_url="https://"+PREZI_URL}else{base_url=""}var options={internal:external?undefined:"1",wmode:external?undefined:wmode,bgcolor:color,lock_to_path:lock?"1":"0",autoplay:autoplay==1?"1":"0",autohide_ctrls:autohide_ctrls,features:features,disabled_features:disabled_features,token:token,webgl:data.webgl,webgl_viewer_version:data.webgl_viewer_version,webgl_no_autofallback:data.webgl_no_autofallback,webgl_debug_log:data.webgl_debug_log,landing_data:window.landing_data||"",landing_sign:window.landing_sign||""};function buildQueryParams(options){var query_list=[];var keys=Object.keys(options);for(var i=0;i<keys.length;i++){var key=keys[i];var value=options[key];if(value!==undefined){query_list.push(encodeURIComponent(key)+"="+encodeURIComponent(value))}}return query_list.join("&")}var iframe=document.createElement("iframe");iframe.id="iframe_container";iframe.frameBorder="0";iframe.setAttribute("webkitAllowFullScreen","");iframe.setAttribute("mozAllowFullscreen","");iframe.setAttribute("allowfullscreen","");iframe.width=width;iframe.height=height;iframe.src=base_url+"/embed/"+prezi_id+"/?"+buildQueryParams(options);if(url_hash){iframe.src+="#"+encodeURIComponent(url_hash)}return iframe.outerHTML}};

var swfobject=function(){var b="undefined",Q="object",n="Shockwave Flash",p="ShockwaveFlash.ShockwaveFlash",P="application/x-shockwave-flash",m="SWFObjectExprInst",j=window,K=document,T=navigator,o=[],N=[],i=[],d=[],J,Z=null,M=null,l=null,e=false,A=false;var h=function(){var v=typeof K.getElementById!=b&&typeof K.getElementsByTagName!=b&&typeof K.createElement!=b,AC=[0,0,0],x=null;if(typeof T.plugins!=b&&typeof T.plugins[n]==Q){x=T.plugins[n].description;if(x&&!(typeof T.mimeTypes!=b&&T.mimeTypes[P]&&!T.mimeTypes[P].enabledPlugin)){x=x.replace(/^.*\s+(\S+\s+\S+$)/,"$1");AC[0]=parseInt(x.replace(/^(.*)\..*$/,"$1"),10);AC[1]=parseInt(x.replace(/^.*\.(.*)\s.*$/,"$1"),10);AC[2]=/r/.test(x)?parseInt(x.replace(/^.*r(.*)$/,"$1"),10):0}}else{if(typeof j.ActiveXObject!=b){var y=null,AB=false;try{y=new ActiveXObject(p+".7")}catch(t){try{y=new ActiveXObject(p+".6");AC=[6,0,21];y.AllowScriptAccess="always"}catch(t){if(AC[0]==6){AB=true}}if(!AB){try{y=new ActiveXObject(p)}catch(t){}}}if(!AB&&y){try{x=y.GetVariable("$version");if(x){x=x.split(" ")[1].split(",");AC=[parseInt(x[0],10),parseInt(x[1],10),parseInt(x[2],10)]}}catch(t){}}}}var AD=T.userAgent.toLowerCase(),r=T.platform.toLowerCase(),AA=/webkit/.test(AD)?parseFloat(AD.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,q=false,z=r?/win/.test(r):/win/.test(AD),w=r?/mac/.test(r):/mac/.test(AD);return{w3cdom:v,pv:AC,webkit:AA,ie:q,win:z,mac:w}}();var L=function(){if(!h.w3cdom){return}f(H);if(h.ie&&h.win){try{K.write("<script id=__ie_ondomload defer=true src=//:></script>");J=C("__ie_ondomload");if(J){I(J,"onreadystatechange",S)}}catch(q){}}if(h.webkit&&typeof K.readyState!=b){Z=setInterval(function(){if(/loaded|complete/.test(K.readyState)){E()}},10)}if(typeof K.addEventListener!=b){K.addEventListener("DOMContentLoaded",E,null)}R(E)}();function S(){if(J.readyState=="complete"){J.parentNode.removeChild(J);E()}}function E(){if(e){return}if(h.ie&&h.win){var v=a("span");try{var u=K.getElementsByTagName("body")[0].appendChild(v);u.parentNode.removeChild(u)}catch(w){return}}e=true;if(Z){clearInterval(Z);Z=null}var q=o.length;for(var r=0;r<q;r++){o[r]()}}function f(q){if(e){q()}else{o[o.length]=q}}function R(r){if(typeof j.addEventListener!=b){j.addEventListener("load",r,false)}else{if(typeof K.addEventListener!=b){K.addEventListener("load",r,false)}else{if(typeof j.attachEvent!=b){I(j,"onload",r)}else{if(typeof j.onload=="function"){var q=j.onload;j.onload=function(){q();r()}}else{j.onload=r}}}}}function H(){var t=N.length;for(var q=0;q<t;q++){var u=N[q].id;if(h.pv[0]>0){var r=C(u);if(r){N[q].width=r.getAttribute("width")?r.getAttribute("width"):"0";N[q].height=r.getAttribute("height")?r.getAttribute("height"):"0";if(c(N[q].swfVersion)){if(h.webkit&&h.webkit<312){Y(r)}W(u,true)}else{if(N[q].expressInstall&&!A&&c("6.0.65")&&(h.win||h.mac)){k(N[q])}else{O(r)}}}}else{W(u,true)}}}function Y(t){var q=t.getElementsByTagName(Q)[0];if(q){var w=a("embed"),y=q.attributes;if(y){var v=y.length;for(var u=0;u<v;u++){if(y[u].nodeName=="DATA"){w.setAttribute("src",y[u].nodeValue)}else{w.setAttribute(y[u].nodeName,y[u].nodeValue)}}}var x=q.childNodes;if(x){var z=x.length;for(var r=0;r<z;r++){if(x[r].nodeType==1&&x[r].nodeName=="PARAM"){w.setAttribute(x[r].getAttribute("name"),x[r].getAttribute("value"))}}}t.parentNode.replaceChild(w,t)}}function k(w){A=true;var u=C(w.id);if(u){if(w.altContentId){var y=C(w.altContentId);if(y){M=y;l=w.altContentId}}else{M=G(u)}if(!/%$/.test(w.width)&&parseInt(w.width,10)<310){w.width="310"}if(!/%$/.test(w.height)&&parseInt(w.height,10)<137){w.height="137"}K.title=K.title.slice(0,47)+" - Flash Player Installation";var z=h.ie&&h.win?"ActiveX":"PlugIn",q=K.title,r="MMredirectURL="+j.location+"&MMplayerType="+z+"&MMdoctitle="+q,x=w.id;if(h.ie&&h.win&&u.readyState!=4){var t=a("div");x+="SWFObjectNew";t.setAttribute("id",x);u.parentNode.insertBefore(t,u);u.style.display="none";var v=function(){u.parentNode.removeChild(u)};I(j,"onload",v)}U({data:w.expressInstall,id:m,width:w.width,height:w.height},{flashvars:r},x)}}function O(t){if(h.ie&&h.win&&t.readyState!=4){var r=a("div");t.parentNode.insertBefore(r,t);r.parentNode.replaceChild(G(t),r);t.style.display="none";var q=function(){t.parentNode.removeChild(t)};I(j,"onload",q)}else{t.parentNode.replaceChild(G(t),t)}}function G(v){var u=a("div");if(h.win&&h.ie){u.innerHTML=v.innerHTML}else{var r=v.getElementsByTagName(Q)[0];if(r){var w=r.childNodes;if(w){var q=w.length;for(var t=0;t<q;t++){if(!(w[t].nodeType==1&&w[t].nodeName=="PARAM")&&!(w[t].nodeType==8)){u.appendChild(w[t].cloneNode(true))}}}}}return u}function U(AG,AE,t){var q,v=C(t);if(v){if(typeof AG.id==b){AG.id=t}if(h.ie&&h.win){var AF="";for(var AB in AG){if(AG[AB]!=Object.prototype[AB]){if(AB.toLowerCase()=="data"){AE.movie=AG[AB]}else{if(AB.toLowerCase()=="styleclass"){AF+=' class="'+AG[AB]+'"'}else{if(AB.toLowerCase()!="classid"){AF+=" "+AB+'="'+AG[AB]+'"'}}}}}var AD="";for(var AA in AE){if(AE[AA]!=Object.prototype[AA]){AD+='<param name="'+AA+'" value="'+AE[AA]+'" />'}}v.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+AF+">"+AD+"</object>";i[i.length]=AG.id;q=C(AG.id)}else{if(h.webkit&&h.webkit<312){var AC=a("embed");AC.setAttribute("type",P);for(var z in AG){if(AG[z]!=Object.prototype[z]){if(z.toLowerCase()=="data"){AC.setAttribute("src",AG[z])}else{if(z.toLowerCase()=="styleclass"){AC.setAttribute("class",AG[z])}else{if(z.toLowerCase()!="classid"){AC.setAttribute(z,AG[z])}}}}}for(var y in AE){if(AE[y]!=Object.prototype[y]){if(y.toLowerCase()!="movie"){AC.setAttribute(y,AE[y])}}}v.parentNode.replaceChild(AC,v);q=AC}else{var u=a(Q);u.setAttribute("type",P);for(var x in AG){if(AG[x]!=Object.prototype[x]){if(x.toLowerCase()=="styleclass"){u.setAttribute("class",AG[x])}else{if(x.toLowerCase()!="classid"){u.setAttribute(x,AG[x])}}}}for(var w in AE){if(AE[w]!=Object.prototype[w]&&w.toLowerCase()!="movie"){F(u,w,AE[w])}}v.parentNode.replaceChild(u,v);q=u}}}return q}function F(t,q,r){var u=a("param");u.setAttribute("name",q);u.setAttribute("value",r);t.appendChild(u)}function X(r){var q=C(r);if(q&&(q.nodeName=="OBJECT"||q.nodeName=="EMBED")){if(h.ie&&h.win){if(q.readyState==4){B(r)}else{j.attachEvent("onload",function(){B(r)})}}else{q.parentNode.removeChild(q)}}}function B(t){var r=C(t);if(r){for(var q in r){if(typeof r[q]=="function"){r[q]=null}}r.parentNode.removeChild(r)}}function C(t){var q=null;try{q=K.getElementById(t)}catch(r){}return q}function a(q){return K.createElement(q)}function I(t,q,r){t.attachEvent(q,r);d[d.length]=[t,q,r]}function c(t){var r=h.pv,q=t.split(".");q[0]=parseInt(q[0],10);q[1]=parseInt(q[1],10)||0;q[2]=parseInt(q[2],10)||0;return r[0]>q[0]||r[0]==q[0]&&r[1]>q[1]||r[0]==q[0]&&r[1]==q[1]&&r[2]>=q[2]?true:false}function V(v,r){if(h.ie&&h.mac){return}var u=K.getElementsByTagName("head")[0],t=a("style");t.setAttribute("type","text/css");t.setAttribute("media","screen");if(!(h.ie&&h.win)&&typeof K.createTextNode!=b){t.appendChild(K.createTextNode(v+" {"+r+"}"))}u.appendChild(t);if(h.ie&&h.win&&typeof K.styleSheets!=b&&K.styleSheets.length>0){var q=K.styleSheets[K.styleSheets.length-1];if(typeof q.addRule==Q){q.addRule(v,r)}}}function W(t,q){var r=q?"visible":"hidden";if(e&&C(t)){C(t).style.visibility=r}else{V("#"+t,"visibility:"+r)}}function g(s){var r=/[\\\"<>\.;]/;var q=r.exec(s)!=null;return q?encodeURIComponent(s):s}var D=function(){if(h.ie&&h.win){window.attachEvent("onunload",function(){var w=d.length;for(var v=0;v<w;v++){d[v][0].detachEvent(d[v][1],d[v][2])}var t=i.length;for(var u=0;u<t;u++){X(i[u])}for(var r in h){h[r]=null}h=null;for(var q in swfobject){swfobject[q]=null}swfobject=null})}}();return{registerObject:function(u,q,t){if(!h.w3cdom||!u||!q){return}var r={};r.id=u;r.swfVersion=q;r.expressInstall=t?t:false;N[N.length]=r;W(u,false)},getObjectById:function(v){var q=null;if(h.w3cdom){var t=C(v);if(t){var u=t.getElementsByTagName(Q)[0];if(!u||u&&typeof t.SetVariable!=b){q=t}else{if(typeof u.SetVariable!=b){q=u}}}}return q},embedSWF:function(x,AE,AB,AD,q,w,r,z,AC){if(!h.w3cdom||!x||!AE||!AB||!AD||!q){return}AB+="";AD+="";if(c(q)){W(AE,false);var AA={};if(AC&&typeof AC===Q){for(var v in AC){if(AC[v]!=Object.prototype[v]){AA[v]=AC[v]}}}AA.data=x;AA.width=AB;AA.height=AD;var y={};if(z&&typeof z===Q){for(var u in z){if(z[u]!=Object.prototype[u]){y[u]=z[u]}}}if(r&&typeof r===Q){for(var t in r){if(r[t]!=Object.prototype[t]){if(typeof y.flashvars!=b){y.flashvars+="&"+t+"="+r[t]}else{y.flashvars=t+"="+r[t]}}}}f(function(){U(AA,y,AE);if(AA.id==AE){W(AE,true)}})}else{if(w&&!A&&c("6.0.65")&&(h.win||h.mac)){A=true;W(AE,false);f(function(){var AF={};AF.id=AF.altContentId=AE;AF.width=AB;AF.height=AD;AF.expressInstall=w;k(AF)})}}},getFlashPlayerVersion:function(){return{major:h.pv[0],minor:h.pv[1],release:h.pv[2]}},hasFlashPlayerVersion:c,createSWF:function(t,r,q){if(h.w3cdom){return U(t,r,q)}else{return undefined}},removeSWF:function(q){if(h.w3cdom){X(q)}},createCSS:function(r,q){if(h.w3cdom){V(r,q)}},addDomLoadEvent:f,addLoadEvent:R,getQueryParamValue:function(v){var u=K.location.search||K.location.hash;if(v==null){return g(u)}if(u){var t=u.substring(1).split("&");for(var r=0;r<t.length;r++){if(t[r].substring(0,t[r].indexOf("="))==v){return g(t[r].substring(t[r].indexOf("=")+1))}}}return""},expressInstallCallback:function(){if(A&&M){var q=C(m);if(q){q.parentNode.replaceChild(M,q);if(l){W(l,true);if(h.ie&&h.win){M.style.display="block"}}M=null;l=null;A=false}}}}}();

var EMAILCHECK=function(){this.emailCount=0;this.allOK=false;this.results={};this.resultCSV="";function check(inputCSV,separators){if(!inputCSV)return false;if(!separators)separators=",;";var emails=inputCSV.split(new RegExp("["+separators+"]")),emailRegExp=/^(("[\w-\s]+")|([\w-]+(?:\.[\w-]+)*)|("[\w-\s]+")([\w-]+(?:\.[\w-]+)*))(@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$)|(@\[?((25[0-5]\.|2[0-4][0-9]\.|1[0-9]{2}\.|[0-9]{1,2}\.))((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\.){2}(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\]?$)/i,results={},matchCount=0,verified=[];this.emailCount=emails.length;for(idx=0;idx<emails.length;idx++){var email=emails[idx].replace(/(^\s*)([^\s]*)(\s*$)/,"$2");if(email!=""){matchCount+=results[email]=email.match(emailRegExp)?true:false;verified.push(email)}else this.emailCount--}this.resultCSV=verified.join(",");this.allOK=this.emailCount==matchCount?true:false;return this.results=results}function getHTMLErrorList(){var ecList="";for(emailAddr in this.results)if(!this.results[emailAddr])ecList+="<li style='color:#000'>'"+emailAddr+"': Invalid email address.</li>";ecList='<ul class="invMsg highlight"><li>Please correct the following:</li>'+ecList+"</ul>";return ecList}function getHTMLResponseFrom(recipients){var lists={success:[],failed:[],alreadyadded:[]},msgArr=[];if(typeof headerTxt=="undefined")headerTxt="Email sent to";if(typeof recipients!="undefined"){for(email in recipients){lists[recipients[email]].push('<span class="invEmail">'+email+"</span>")}if(lists.success.length)msgArr.push("Email sent to "+lists.success.join(", ")+" successfully");if(lists.failed.length)msgArr.push("sending to "+lists.failed.join(", ")+" failed");if(lists.alreadyadded.length)msgArr.push(lists.alreadyadded.join(", ")+" already invited");msg='<span class="invMsg highlight">'+msgArr.join(", ")+(msgArr.length?".":"")+"</span>"}else msg=null;return msg}return{check:check,allOK:this.allOK,results:this.results,resultCSV:this.resultCSV,getHTMLErrorList:getHTMLErrorList,getHTMLResponseFrom:getHTMLResponseFrom}};

(function($){$.template=function(html,options){return new $.template.instance(html,options)};$.template.instance=function(html,options){if(options&&options["regx"])options.regx=this.regx[options.regx];this.options=$.extend({compile:false,regx:this.regx.standard},options||{});this.html=html;if(this.options.compile){this.compile()}this.isTemplate=true};$.template.regx=$.template.instance.prototype.regx={jsp:/\$\{([\w-]+)(?:\:([\w\.]*)(?:\((.*?)?\))?)?\}/g,ext:/\{([\w-]+)(?:\:([\w\.]*)(?:\((.*?)?\))?)?\}/g,jtemplates:/\{\{([\w-]+)(?:\:([\w\.]*)(?:\((.*?)?\))?)?\}\}/g};$.template.regx.standard=$.template.regx.jsp;$.template.helpers=$.template.instance.prototype.helpers={substr:function(value,start,length){return String(value).substr(start,length)}};$.extend($.template.instance.prototype,{apply:function(values){if(this.options.compile){return this.compiled(values)}else{var tpl=this;var fm=this.helpers;var fn=function(m,name,format,args){if(format){if(format.substr(0,5)=="this."){return tpl.call(format.substr(5),values[name],values)}else{if(args){var re=/^\s*['"](.*)["']\s*$/;args=args.split(",");for(var i=0,len=args.length;i<len;i++){args[i]=args[i].replace(re,"$1")}args=[values[name]].concat(args)}else{args=[values[name]]}return fm[format].apply(fm,args)}}else{return values[name]!==undefined?values[name]:""}};return this.html.replace(this.options.regx,fn)}},compile:function(){var sep=$.browser.mozilla?"+":",";var fm=this.helpers;var fn=function(m,name,format,args){if(format){args=args?","+args:"";if(format.substr(0,5)!="this."){format="fm."+format+"("}else{format='this.call("'+format.substr(5)+'", ';args=", values"}}else{args="";format="(values['"+name+"'] == undefined ? '' : "}return"'"+sep+format+"values['"+name+"']"+args+")"+sep+"'"};var body;if($.browser.mozilla){body="this.compiled = function(values){ return '"+this.html.replace(/\\/g,"\\\\").replace(/(\r\n|\n)/g,"\\n").replace(/'/g,"\\'").replace(this.options.regx,fn)+"';};"}else{body=["this.compiled = function(values){ return ['"];body.push(this.html.replace(/\\/g,"\\\\").replace(/(\r\n|\n)/g,"\\n").replace(/'/g,"\\'").replace(this.options.regx,fn));body.push("'].join('');};");body=body.join("")}eval(body);return this}});var $_old={domManip:$.fn.domManip,text:$.fn.text,html:$.fn.html};$.fn.domManip=function(args,table,reverse,callback){if(args[0].isTemplate){args[0]=args[0].apply(args[1]);delete args[1]}var r=$_old.domManip.apply(this,arguments);return r};$.fn.html=function(value,o){if(value&&value.isTemplate)var value=value.apply(o);var r=$_old.html.apply(this,[value]);return r};$.fn.text=function(value,o){if(value&&value.isTemplate)var value=value.apply(o);var r=$_old.text.apply(this,[value]);return r}})(jQuery);

(function($){jQuery.fn.extend({lazy:function(callback){if($("body").hasClass("lazy")){var d=$(window).data("lazyloaders");if(!d){d=[];d.loading=[]}if(typeof callback=="function"){d.push()}this.each(function(){d.push([this,callback])});$(window).data("lazyloaders",d)}}});$(document).ready(function(){if($("body").hasClass("lazy")){var scrolling=false;$(window).scroll(function(){if(!scrolling){scrolling=true;setTimeout(function(){var d=$(window).data("lazyloaders");if(!d||!d.length){return}$(d).each(function(i){if(!d[i]){return}if(d.loading[i]){return}if(this&&d[i]&&$.inviewport(this,{threshold:0})&&!$(this[0]).data("loaded")){d.loading[i]=true;this[1].call(this[0]);$(this[0]).data("loaded",true);delete d[i]}});scrolling=false},0)}});$(window).trigger("scroll");$(".thumbnail a").lazy(function(){var elem=$(this),bg=elem.data("background");if(bg){elem.css("background","url("+bg+") repeat 50% 50%")}})}});$.belowthefold=function(element,settings){var fold=$(window).height()+$(window).scrollTop();return fold<=$(element).offset().top-settings.threshold};$.abovethetop=function(element,settings){var top=$(window).scrollTop();return top>=$(element).offset().top+$(element).height()-settings.threshold};$.rightofscreen=function(element,settings){var fold=$(window).width()+$(window).scrollLeft();return fold<=$(element).offset().left-settings.threshold};$.leftofscreen=function(element,settings){var left=$(window).scrollLeft();return left>=$(element).offset().left+$(element).width()-settings.threshold};$.inviewport=function(element,settings){return!$.rightofscreen(element,settings)&&!$.leftofscreen(element,settings)&&!$.belowthefold(element,settings)&&!$.abovethetop(element,settings)};$.extend($.expr[":"],{"below-the-fold":function(a,i,m){return $.belowthefold(a,{threshold:0})},"above-the-top":function(a,i,m){return $.abovethetop(a,{threshold:0})},"left-of-screen":function(a,i,m){return $.leftofscreen(a,{threshold:0})},"right-of-screen":function(a,i,m){return $.rightofscreen(a,{threshold:0})},"in-viewport":function(a,i,m){return $.inviewport(a,{threshold:0})}})})(jQuery);

(function($){$.fn.editable=function(target,options){if("disable"==target){$(this).data("disabled.editable",true);return}if("enable"==target){$(this).data("disabled.editable",false);return}if("destroy"==target){$(this).unbind($(this).data("event.editable")).removeData("disabled.editable").removeData("event.editable");return}var settings=$.extend({},$.fn.editable.defaults,{target:target},options);var plugin=$.editable.types[settings.type].plugin||function(){};var submit=$.editable.types[settings.type].submit||function(){};var buttons=$.editable.types[settings.type].buttons||$.editable.types["defaults"].buttons;var content=$.editable.types[settings.type].content||$.editable.types["defaults"].content;var element=$.editable.types[settings.type].element||$.editable.types["defaults"].element;var reset=$.editable.types[settings.type].reset||$.editable.types["defaults"].reset;var callback=settings.callback||function(){};var onedit=settings.onedit||function(){};var onsubmit=settings.onsubmit||function(){};var onreset=settings.onreset||function(){};var onerror=settings.onerror||reset;if(settings.tooltip){$(this).attr("title",settings.tooltip)}settings.autowidth="auto"==settings.width;settings.autoheight="auto"==settings.height;return this.each(function(){var self=this;var savedwidth=$(self).width();var savedheight=$(self).height();$(this).data("event.editable",settings.event);if(!$.trim($(this).html())){$(this).html(settings.placeholder)}$(this).bind(settings.event,function(e){if(true===$(this).data("disabled.editable")){return}if(self.editing){return}if(false===onedit.apply(this,[settings,self])){return}e.preventDefault();e.stopPropagation();if(settings.tooltip){$(self).removeAttr("title")}if(0===$(self).width()){settings.width=savedwidth;settings.height=savedheight}else{if(settings.width!="none"){settings.width=settings.autowidth?$(self).width():settings.width}if(settings.height!="none"){settings.height=settings.autoheight?$(self).height():settings.height}}if($(this).html().toLowerCase().replace(/(;|")/g,"")==settings.placeholder.toLowerCase().replace(/(;|")/g,"")){$(this).html("")}self.editing=true;self.revert=$(self).html();$(self).html("");var form=$("<form />");if(settings.cssclass){if("inherit"==settings.cssclass){form.attr("class",$(self).attr("class"))}else{form.attr("class",settings.cssclass)}}if(settings.style){if("inherit"==settings.style){form.attr("style",$(self).attr("style"));form.css("display",$(self).css("display"))}else{form.attr("style",settings.style)}}var input=element.apply(form,[settings,self]);var input_content;if(settings.loadurl){var t=setTimeout(function(){input.disabled=true;content.apply(form,[settings.loadtext,settings,self])},100);var loaddata={};loaddata[settings.id]=self.id;if($.isFunction(settings.loaddata)){$.extend(loaddata,settings.loaddata.apply(self,[self.revert,settings]))}else{$.extend(loaddata,settings.loaddata)}$.ajax({type:settings.loadtype,url:settings.loadurl,data:loaddata,async:false,success:function(result){window.clearTimeout(t);input_content=result;input.disabled=false}})}else if(settings.data){input_content=settings.data;if($.isFunction(settings.data)){input_content=settings.data.apply(self,[self.revert,settings])}}else{input_content=self.revert}content.apply(form,[input_content,settings,self]);input.attr("name",settings.name);buttons.apply(form,[settings,self]);$(self).append(form);plugin.apply(form,[settings,self]);$(":input:visible:enabled:first",form).focus();if(settings.select){input.select()}input.keydown(function(e){if(e.keyCode==27){e.preventDefault();reset.apply(form,[settings,self])}});var t;if("cancel"==settings.onblur){input.blur(function(e){t=setTimeout(function(){reset.apply(form,[settings,self])},500)})}else if("submit"==settings.onblur){input.blur(function(e){t=setTimeout(function(){form.submit()},200)})}else if($.isFunction(settings.onblur)){input.blur(function(e){settings.onblur.apply(self,[input.val(),settings])})}else{input.blur(function(e){})}form.submit(function(e){if(t){clearTimeout(t)}e.preventDefault();if(false!==onsubmit.apply(form,[settings,self])){if(false!==submit.apply(form,[settings,self])){if($.isFunction(settings.target)){var str=settings.target.apply(self,[input.val(),settings]);$(self).html(str);self.editing=false;callback.apply(self,[self.innerHTML,settings]);if(!$.trim($(self).html())){$(self).html(settings.placeholder)}}else{var submitdata={};submitdata[settings.name]=input.val();submitdata[settings.id]=self.id;if($.isFunction(settings.submitdata)){$.extend(submitdata,settings.submitdata.apply(self,[self.revert,settings]))}else{$.extend(submitdata,settings.submitdata)}if("PUT"==settings.method){submitdata["_method"]="put"}$(self).html(settings.indicator);var ajaxoptions={type:"POST",data:submitdata,dataType:"html",url:settings.target,success:function(result,status){if(ajaxoptions.dataType=="html"){$(self).html(submitdata[settings.name])}self.editing=false;callback.apply(self,[result,settings]);if(!$.trim($(self).html())){$(self).html(settings.placeholder)}},error:function(xhr,status,error){onerror.apply(form,[settings,self,xhr])}};$.extend(ajaxoptions,settings.ajaxoptions);$.ajax(ajaxoptions)}}}$(self).attr("title",settings.tooltip);return false})});this.reset=function(form){if(this.editing){if(false!==onreset.apply(form,[settings,self])){$(self).html(self.revert);self.editing=false;if(!$.trim($(self).html())){$(self).html(settings.placeholder)}if(settings.tooltip){$(self).attr("title",settings.tooltip)}}}}})};$.editable={types:{defaults:{element:function(settings,original){var input=$('<input type="hidden"></input>');$(this).append(input);return input},content:function(string,settings,original){$(":input:first",this).val(string)},reset:function(settings,original){original.reset(this)},buttons:function(settings,original){var form=this;if(settings.submit){if(settings.submit.match(/>$/)){var submit=$(settings.submit).click(function(){if(submit.attr("type")!="submit"){form.submit()}})}else{var submit=$('<button type="submit" />');submit.html(settings.submit)}$(this).append(submit)}if(settings.cancel){if(settings.cancel.match(/>$/)){var cancel=$(settings.cancel)}else{var cancel=$('<button type="cancel" />');cancel.html(settings.cancel)}$(this).append(cancel);$(cancel).click(function(event){if($.isFunction($.editable.types[settings.type].reset)){var reset=$.editable.types[settings.type].reset}else{var reset=$.editable.types["defaults"].reset}reset.apply(form,[settings,original]);return false})}}},text:{element:function(settings,original){var input=$("<input />");if(settings.width!="none"){input.width(settings.width)}if(settings.height!="none"){input.height(settings.height)}input.attr("autocomplete","off");$(this).append(input);return input}},textarea:{element:function(settings,original){var textarea=$("<textarea />");if(settings.rows){textarea.attr("rows",settings.rows)}else if(settings.height!="none"){textarea.height(settings.height)}if(settings.cols){textarea.attr("cols",settings.cols)}else if(settings.width!="none"){textarea.width(settings.width)}$(this).append(textarea);return textarea}},select:{element:function(settings,original){var select=$("<select />");$(this).append(select);return select},content:function(data,settings,original){if(String==data.constructor){eval("var json = "+data)}else{var json=data}for(var key in json){if(!json.hasOwnProperty(key)){continue}if("selected"==key){continue}var option=$("<option />").val(key).append(json[key]);$("select",this).append(option)}$("select",this).children().each(function(){if($(this).val()==json["selected"]||$(this).text()==$.trim(original.revert)){$(this).attr("selected","selected")}})}}},addInputType:function(name,input){$.editable.types[name]=input}};$.fn.editable.defaults={name:"value",id:"id",type:"text",width:"auto",height:"auto",event:"click.editable",onblur:"cancel",loadtype:"GET",loadtext:"Loading...",placeholder:"Click to edit",loaddata:{},submitdata:{},ajaxoptions:{}}})(jQuery);

(function(){"use strict";var currentElement;var flashState={bridge:null,version:"0.0.0",disabled:null,outdated:null,ready:null};var _clipData={};var clientIdCounter=0;var _clientMeta={};var elementIdCounter=0;var _elementMeta={};var _amdModuleId=null;var _cjsModuleId=null;var _swfPath=function(){var i,jsDir,tmpJsPath,jsPath,swfPath="ZeroClipboard.swf";if(document.currentScript&&(jsPath=document.currentScript.src)){}else{var scripts=document.getElementsByTagName("script");if("readyState"in scripts[0]){for(i=scripts.length;i--;){if(scripts[i].readyState==="interactive"&&(jsPath=scripts[i].src)){break}}}else if(document.readyState==="loading"){jsPath=scripts[scripts.length-1].src}else{for(i=scripts.length;i--;){tmpJsPath=scripts[i].src;if(!tmpJsPath){jsDir=null;break}tmpJsPath=tmpJsPath.split("#")[0].split("?")[0];tmpJsPath=tmpJsPath.slice(0,tmpJsPath.lastIndexOf("/")+1);if(jsDir==null){jsDir=tmpJsPath}else if(jsDir!==tmpJsPath){jsDir=null;break}}if(jsDir!==null){jsPath=jsDir}}}if(jsPath){jsPath=jsPath.split("#")[0].split("?")[0];swfPath=jsPath.slice(0,jsPath.lastIndexOf("/")+1)+swfPath}return swfPath}();var _camelizeCssPropName=function(){var matcherRegex=/\-([a-z])/g,replacerFn=function(match,group){return group.toUpperCase()};return function(prop){return prop.replace(matcherRegex,replacerFn)}}();var _getStyle=function(el,prop){var value,camelProp,tagName,possiblePointers,i,len;if(window.getComputedStyle){value=window.getComputedStyle(el,null).getPropertyValue(prop)}else{camelProp=_camelizeCssPropName(prop);if(el.currentStyle){value=el.currentStyle[camelProp]}else{value=el.style[camelProp]}}if(prop==="cursor"){if(!value||value==="auto"){tagName=el.tagName.toLowerCase();if(tagName==="a"){return"pointer"}}}return value};var _elementMouseOver=function(event){if(!event){event=window.event}var target;if(this!==window){target=this}else if(event.target){target=event.target}else if(event.srcElement){target=event.srcElement}ZeroClipboard.activate(target)};var _addEventHandler=function(element,method,func){if(!element||element.nodeType!==1){return}if(element.addEventListener){element.addEventListener(method,func,false)}else if(element.attachEvent){element.attachEvent("on"+method,func)}};var _removeEventHandler=function(element,method,func){if(!element||element.nodeType!==1){return}if(element.removeEventListener){element.removeEventListener(method,func,false)}else if(element.detachEvent){element.detachEvent("on"+method,func)}};var _addClass=function(element,value){if(!element||element.nodeType!==1){return element}if(element.classList){if(!element.classList.contains(value)){element.classList.add(value)}return element}if(value&&typeof value==="string"){var classNames=(value||"").split(/\s+/);if(element.nodeType===1){if(!element.className){element.className=value}else{var className=" "+element.className+" ",setClass=element.className;for(var c=0,cl=classNames.length;c<cl;c++){if(className.indexOf(" "+classNames[c]+" ")<0){setClass+=" "+classNames[c]}}element.className=setClass.replace(/^\s+|\s+$/g,"")}}}return element};var _removeClass=function(element,value){if(!element||element.nodeType!==1){return element}if(element.classList){if(element.classList.contains(value)){element.classList.remove(value)}return element}if(value&&typeof value==="string"||value===undefined){var classNames=(value||"").split(/\s+/);if(element.nodeType===1&&element.className){if(value){var className=(" "+element.className+" ").replace(/[\n\t]/g," ");for(var c=0,cl=classNames.length;c<cl;c++){className=className.replace(" "+classNames[c]+" "," ")}element.className=className.replace(/^\s+|\s+$/g,"")}else{element.className=""}}}return element};var _getZoomFactor=function(){var rect,physicalWidth,logicalWidth,zoomFactor=1;if(typeof document.body.getBoundingClientRect==="function"){rect=document.body.getBoundingClientRect();physicalWidth=rect.right-rect.left;logicalWidth=document.body.offsetWidth;zoomFactor=Math.round(physicalWidth/logicalWidth*100)/100}return zoomFactor};var _getDOMObjectPosition=function(obj,defaultZIndex){var info={left:0,top:0,width:0,height:0,zIndex:_getSafeZIndex(defaultZIndex)-1};if(obj.getBoundingClientRect){var rect=obj.getBoundingClientRect();var pageXOffset,pageYOffset,zoomFactor;if("pageXOffset"in window&&"pageYOffset"in window){pageXOffset=window.pageXOffset;pageYOffset=window.pageYOffset}else{zoomFactor=_getZoomFactor();pageXOffset=Math.round(document.documentElement.scrollLeft/zoomFactor);pageYOffset=Math.round(document.documentElement.scrollTop/zoomFactor)}var leftBorderWidth=document.documentElement.clientLeft||0;var topBorderWidth=document.documentElement.clientTop||0;info.left=rect.left+pageXOffset-leftBorderWidth;info.top=rect.top+pageYOffset-topBorderWidth;info.width="width"in rect?rect.width:rect.right-rect.left;info.height="height"in rect?rect.height:rect.bottom-rect.top}return info};var _cacheBust=function(path,options){var cacheBust=options==null||options&&options.cacheBust===true&&options.useNoCache===true;if(cacheBust){return(path.indexOf("?")===-1?"?":"&")+"noCache="+(new Date).getTime()}else{return""}};var _vars=function(options){var i,len,domain,str=[],domains=[],trustedOriginsExpanded=[];if(options.trustedOrigins){if(typeof options.trustedOrigins==="string"){domains.push(options.trustedOrigins)}else if(typeof options.trustedOrigins==="object"&&"length"in options.trustedOrigins){domains=domains.concat(options.trustedOrigins)}}if(options.trustedDomains){if(typeof options.trustedDomains==="string"){domains.push(options.trustedDomains)}else if(typeof options.trustedDomains==="object"&&"length"in options.trustedDomains){domains=domains.concat(options.trustedDomains)}}if(domains.length){for(i=0,len=domains.length;i<len;i++){if(domains.hasOwnProperty(i)&&domains[i]&&typeof domains[i]==="string"){domain=_extractDomain(domains[i]);if(!domain){continue}if(domain==="*"){trustedOriginsExpanded=[domain];break}trustedOriginsExpanded.push.apply(trustedOriginsExpanded,[domain,"//"+domain,window.location.protocol+"//"+domain])}}}if(trustedOriginsExpanded.length){str.push("trustedOrigins="+encodeURIComponent(trustedOriginsExpanded.join(",")))}if(typeof options.jsModuleId==="string"&&options.jsModuleId){str.push("jsModuleId="+encodeURIComponent(options.jsModuleId))}return str.join("&")};var _inArray=function(elem,array,fromIndex){if(typeof array.indexOf==="function"){return array.indexOf(elem,fromIndex)}var i,len=array.length;if(typeof fromIndex==="undefined"){fromIndex=0}else if(fromIndex<0){fromIndex=len+fromIndex}for(i=fromIndex;i<len;i++){if(array.hasOwnProperty(i)&&array[i]===elem){return i}}return-1};var _prepClip=function(elements){if(typeof elements==="string")throw new TypeError("ZeroClipboard doesn't accept query strings.");if(!elements.length)return[elements];return elements};var _dispatchCallback=function(func,context,args,async){if(async){window.setTimeout(function(){func.apply(context,args)},0)}else{func.apply(context,args)}};var _getSafeZIndex=function(val){var zIndex,tmp;if(val){if(typeof val==="number"&&val>0){zIndex=val}else if(typeof val==="string"&&(tmp=parseInt(val,10))&&!isNaN(tmp)&&tmp>0){zIndex=tmp}}if(!zIndex){if(typeof _globalConfig.zIndex==="number"&&_globalConfig.zIndex>0){zIndex=_globalConfig.zIndex}else if(typeof _globalConfig.zIndex==="string"&&(tmp=parseInt(_globalConfig.zIndex,10))&&!isNaN(tmp)&&tmp>0){zIndex=tmp}}return zIndex||0};var _deprecationWarning=function(deprecatedApiName,debugEnabled){if(deprecatedApiName&&debugEnabled!==false&&typeof console!=="undefined"&&console&&(console.warn||console.log)){var deprecationWarning="`"+deprecatedApiName+"` is deprecated. See docs for more info:\n"+"    https://github.com/zeroclipboard/zeroclipboard/blob/master/docs/instructions.md#deprecations";if(console.warn){console.warn(deprecationWarning)}else{console.log(deprecationWarning)}}};var _extend=function(){var i,len,arg,prop,src,copy,target=arguments[0]||{};for(i=1,len=arguments.length;i<len;i++){if((arg=arguments[i])!=null){for(prop in arg){if(arg.hasOwnProperty(prop)){src=target[prop];copy=arg[prop];if(target===copy){continue}if(copy!==undefined){target[prop]=copy}}}}}return target};var _extractDomain=function(originOrUrl){if(originOrUrl==null||originOrUrl===""){return null}originOrUrl=originOrUrl.replace(/^\s+|\s+$/g,"");if(originOrUrl===""){return null}var protocolIndex=originOrUrl.indexOf("//");originOrUrl=protocolIndex===-1?originOrUrl:originOrUrl.slice(protocolIndex+2);var pathIndex=originOrUrl.indexOf("/");originOrUrl=pathIndex===-1?originOrUrl:protocolIndex===-1||pathIndex===0?null:originOrUrl.slice(0,pathIndex);if(originOrUrl&&originOrUrl.slice(-4).toLowerCase()===".swf"){return null}return originOrUrl||null};var _determineScriptAccess=function(){var _extractAllDomains=function(origins,resultsArray){var i,len,tmp;if(origins!=null&&resultsArray[0]!=="*"){if(typeof origins==="string"){origins=[origins]}if(typeof origins==="object"&&"length"in origins){for(i=0,len=origins.length;i<len;i++){if(origins.hasOwnProperty(i)){tmp=_extractDomain(origins[i]);if(tmp){if(tmp==="*"){resultsArray.length=0;resultsArray.push("*");break}if(_inArray(tmp,resultsArray)===-1){resultsArray.push(tmp)}}}}}}};var _accessLevelLookup={always:"always",samedomain:"sameDomain",never:"never"};return function(currentDomain,configOptions){var asaLower,allowScriptAccess=configOptions.allowScriptAccess;if(typeof allowScriptAccess==="string"&&(asaLower=allowScriptAccess.toLowerCase())&&/^always|samedomain|never$/.test(asaLower)){return _accessLevelLookup[asaLower]}var swfDomain=_extractDomain(configOptions.moviePath);if(swfDomain===null){swfDomain=currentDomain}var trustedDomains=[];_extractAllDomains(configOptions.trustedOrigins,trustedDomains);_extractAllDomains(configOptions.trustedDomains,trustedDomains);var len=trustedDomains.length;if(len>0){if(len===1&&trustedDomains[0]==="*"){return"always"}if(_inArray(currentDomain,trustedDomains)!==-1){if(len===1&&currentDomain===swfDomain){return"sameDomain"}return"always"}}return"never"}}();var _objectKeys=function(obj){if(obj==null){return[]}if(Object.keys){return Object.keys(obj)}var keys=[];for(var prop in obj){if(obj.hasOwnProperty(prop)){keys.push(prop)}}return keys};var _deleteOwnProperties=function(obj){if(obj){for(var prop in obj){if(obj.hasOwnProperty(prop)){delete obj[prop]}}}return obj};var _detectFlashSupport=function(){var hasFlash=false;if(typeof flashState.disabled==="boolean"){hasFlash=flashState.disabled===false}else{if(typeof ActiveXObject==="function"){try{if(new ActiveXObject("ShockwaveFlash.ShockwaveFlash")){hasFlash=true}}catch(error){}}if(!hasFlash&&navigator.mimeTypes["application/x-shockwave-flash"]){hasFlash=true}}return hasFlash};function _parseFlashVersion(flashVersion){return flashVersion.replace(/,/g,".").replace(/[^0-9\.]/g,"")}function _isFlashVersionSupported(flashVersion){return parseFloat(_parseFlashVersion(flashVersion))>=10}var ZeroClipboard=function(elements,options){if(!(this instanceof ZeroClipboard)){return new ZeroClipboard(elements,options)}this.id=""+clientIdCounter++;_clientMeta[this.id]={instance:this,elements:[],handlers:{}};if(elements){this.clip(elements)}if(typeof options!=="undefined"){_deprecationWarning("new ZeroClipboard(elements, options)",_globalConfig.debug);ZeroClipboard.config(options)}this.options=ZeroClipboard.config();if(typeof flashState.disabled!=="boolean"){flashState.disabled=!_detectFlashSupport()}if(flashState.disabled===false&&flashState.outdated!==true){if(flashState.bridge===null){flashState.outdated=false;flashState.ready=false;_bridge()}}};ZeroClipboard.prototype.setText=function(newText){if(newText&&newText!==""){_clipData["text/plain"]=newText;if(flashState.ready===true&&flashState.bridge){flashState.bridge.setText(newText)}else{}}return this};ZeroClipboard.prototype.setSize=function(width,height){if(flashState.ready===true&&flashState.bridge){flashState.bridge.setSize(width,height)}else{}return this};var _setHandCursor=function(enabled){if(flashState.ready===true&&flashState.bridge){flashState.bridge.setHandCursor(enabled)}else{}};ZeroClipboard.prototype.destroy=function(){this.unclip();this.off();delete _clientMeta[this.id]};var _getAllClients=function(){var i,len,client,clients=[],clientIds=_objectKeys(_clientMeta);for(i=0,len=clientIds.length;i<len;i++){client=_clientMeta[clientIds[i]].instance;if(client&&client instanceof ZeroClipboard){clients.push(client)}}return clients};ZeroClipboard.version="1.3.2";var _globalConfig={swfPath:_swfPath,trustedDomains:window.location.host?[window.location.host]:[],cacheBust:true,forceHandCursor:false,zIndex:999999999,debug:true,title:null,autoActivate:true};ZeroClipboard.config=function(options){if(typeof options==="object"&&options!==null){_extend(_globalConfig,options)}if(typeof options==="string"&&options){if(_globalConfig.hasOwnProperty(options)){return _globalConfig[options]}return}var copy={};for(var prop in _globalConfig){if(_globalConfig.hasOwnProperty(prop)){if(typeof _globalConfig[prop]==="object"&&_globalConfig[prop]!==null){if("length"in _globalConfig[prop]){copy[prop]=_globalConfig[prop].slice(0)}else{copy[prop]=_extend({},_globalConfig[prop])}}else{copy[prop]=_globalConfig[prop]}}}return copy};ZeroClipboard.destroy=function(){ZeroClipboard.deactivate();for(var clientId in _clientMeta){if(_clientMeta.hasOwnProperty(clientId)&&_clientMeta[clientId]){var client=_clientMeta[clientId].instance;if(client&&typeof client.destroy==="function"){client.destroy()}}}var htmlBridge=_getHtmlBridge(flashState.bridge);if(htmlBridge&&htmlBridge.parentNode){htmlBridge.parentNode.removeChild(htmlBridge);flashState.ready=null;flashState.bridge=null}};ZeroClipboard.activate=function(element){if(currentElement){_removeClass(currentElement,_globalConfig.hoverClass);_removeClass(currentElement,_globalConfig.activeClass)}currentElement=element;_addClass(element,_globalConfig.hoverClass);_reposition();var newTitle=_globalConfig.title||element.getAttribute("title");if(newTitle){var htmlBridge=_getHtmlBridge(flashState.bridge);if(htmlBridge){htmlBridge.setAttribute("title",newTitle)}}var useHandCursor=_globalConfig.forceHandCursor===true||_getStyle(element,"cursor")==="pointer";_setHandCursor(useHandCursor)};ZeroClipboard.deactivate=function(){var htmlBridge=_getHtmlBridge(flashState.bridge);if(htmlBridge){htmlBridge.style.left="0px";htmlBridge.style.top="-9999px";htmlBridge.removeAttribute("title")}if(currentElement){_removeClass(currentElement,_globalConfig.hoverClass);_removeClass(currentElement,_globalConfig.activeClass);currentElement=null}};var _bridge=function(){var flashBridge,len;var container=document.getElementById("global-zeroclipboard-html-bridge");if(!container){var opts=ZeroClipboard.config();opts.jsModuleId=typeof _amdModuleId==="string"&&_amdModuleId||typeof _cjsModuleId==="string"&&_cjsModuleId||null;var allowScriptAccess=_determineScriptAccess(window.location.host,_globalConfig);var flashvars=_vars(opts);var swfUrl=_globalConfig.moviePath+_cacheBust(_globalConfig.moviePath,_globalConfig);var html='      <object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" id="global-zeroclipboard-flash-bridge" width="100%" height="100%">         <param name="movie" value="'+swfUrl+'"/>         <param name="allowScriptAccess" value="'+allowScriptAccess+'"/>         <param name="scale" value="exactfit"/>         <param name="loop" value="false"/>         <param name="menu" value="false"/>         <param name="quality" value="best" />         <param name="bgcolor" value="#ffffff"/>         <param name="wmode" value="transparent"/>         <param name="flashvars" value="'+flashvars+'"/>         <embed src="'+swfUrl+'"           loop="false" menu="false"           quality="best" bgcolor="#ffffff"           width="100%" height="100%"           name="global-zeroclipboard-flash-bridge"           allowScriptAccess="'+allowScriptAccess+'"           allowFullScreen="false"           type="application/x-shockwave-flash"           wmode="transparent"           pluginspage="http://www.macromedia.com/go/getflashplayer"           flashvars="'+flashvars+'"           scale="exactfit">         </embed>       </object>';container=document.createElement("div");container.id="global-zeroclipboard-html-bridge";container.setAttribute("class","global-zeroclipboard-container");container.style.position="absolute";container.style.left="0px";container.style.top="-9999px";container.style.width="15px";container.style.height="15px";container.style.zIndex=""+_getSafeZIndex(_globalConfig.zIndex);document.body.appendChild(container);container.innerHTML=html}flashBridge=document["global-zeroclipboard-flash-bridge"];if(flashBridge&&(len=flashBridge.length)){flashBridge=flashBridge[len-1]}flashState.bridge=flashBridge||container.children[0].lastElementChild};var _getHtmlBridge=function(flashBridge){var isFlashElement=/^OBJECT|EMBED$/;var htmlBridge=flashBridge&&flashBridge.parentNode;while(htmlBridge&&isFlashElement.test(htmlBridge.nodeName)&&htmlBridge.parentNode){htmlBridge=htmlBridge.parentNode}return htmlBridge||null};var _reposition=function(){if(currentElement){var pos=_getDOMObjectPosition(currentElement,_globalConfig.zIndex);var htmlBridge=_getHtmlBridge(flashState.bridge);if(htmlBridge){htmlBridge.style.top=pos.top+"px";htmlBridge.style.left=pos.left+"px";htmlBridge.style.width=pos.width+"px";htmlBridge.style.height=pos.height+"px";htmlBridge.style.zIndex=pos.zIndex+1}if(flashState.ready===true&&flashState.bridge){flashState.bridge.setSize(pos.width,pos.height)}}return this};ZeroClipboard.prototype.on=function(eventName,func){var i,len,events,added={},handlers=_clientMeta[this.id]&&_clientMeta[this.id].handlers;if(typeof eventName==="string"&&eventName){events=eventName.toLowerCase().split(/\s+/)}else if(typeof eventName==="object"&&eventName&&typeof func==="undefined"){for(i in eventName){if(eventName.hasOwnProperty(i)&&typeof i==="string"&&i&&typeof eventName[i]==="function"){this.on(i,eventName[i])}}}if(events&&events.length){for(i=0,len=events.length;i<len;i++){eventName=events[i].replace(/^on/,"");added[eventName]=true;if(!handlers[eventName]){handlers[eventName]=[]}handlers[eventName].push(func)}if(added.noflash&&flashState.disabled){_receiveEvent.call(this,"noflash",{})}if(added.wrongflash&&flashState.outdated){_receiveEvent.call(this,"wrongflash",{flashVersion:flashState.version})}if(added.load&&flashState.ready){_receiveEvent.call(this,"load",{flashVersion:flashState.version})}}return this};ZeroClipboard.prototype.off=function(eventName,func){var i,len,foundIndex,events,perEventHandlers,handlers=_clientMeta[this.id]&&_clientMeta[this.id].handlers;if(arguments.length===0){events=_objectKeys(handlers)}else if(typeof eventName==="string"&&eventName){events=eventName.split(/\s+/)}else if(typeof eventName==="object"&&eventName&&typeof func==="undefined"){for(i in eventName){if(eventName.hasOwnProperty(i)&&typeof i==="string"&&i&&typeof eventName[i]==="function"){this.off(i,eventName[i])}}}if(events&&events.length){for(i=0,len=events.length;i<len;i++){eventName=events[i].toLowerCase().replace(/^on/,"");perEventHandlers=handlers[eventName];if(perEventHandlers&&perEventHandlers.length){if(func){foundIndex=_inArray(func,perEventHandlers);while(foundIndex!==-1){perEventHandlers.splice(foundIndex,1);foundIndex=_inArray(func,perEventHandlers,foundIndex)}}else{handlers[eventName].length=0}}}}return this};ZeroClipboard.prototype.handlers=function(eventName){var prop,copy=null,handlers=_clientMeta[this.id]&&_clientMeta[this.id].handlers;if(handlers){if(typeof eventName==="string"&&eventName){return handlers[eventName]?handlers[eventName].slice(0):null}copy={};for(prop in handlers){if(handlers.hasOwnProperty(prop)&&handlers[prop]){copy[prop]=handlers[prop].slice(0)}}}return copy};var _dispatchClientCallbacks=function(eventName,context,args,async){var handlers=_clientMeta[this.id]&&_clientMeta[this.id].handlers[eventName];if(handlers&&handlers.length){var i,len,func,originalContext=context||this;for(i=0,len=handlers.length;i<len;i++){func=handlers[i];context=originalContext;if(typeof func==="string"&&typeof window[func]==="function"){func=window[func]}if(typeof func==="object"&&func&&typeof func.handleEvent==="function"){context=func;func=func.handleEvent}if(typeof func==="function"){_dispatchCallback(func,context,args,async)}}}return this};ZeroClipboard.prototype.clip=function(elements){elements=_prepClip(elements);for(var i=0;i<elements.length;i++){if(elements.hasOwnProperty(i)&&elements[i]&&elements[i].nodeType===1){if(!elements[i].zcClippingId){elements[i].zcClippingId="zcClippingId_"+elementIdCounter++;_elementMeta[elements[i].zcClippingId]=[this.id];if(_globalConfig.autoActivate===true){_addEventHandler(elements[i],"mouseover",_elementMouseOver)}}else if(_inArray(this.id,_elementMeta[elements[i].zcClippingId])===-1){_elementMeta[elements[i].zcClippingId].push(this.id)}var clippedElements=_clientMeta[this.id].elements;if(_inArray(elements[i],clippedElements)===-1){clippedElements.push(elements[i])}}}return this};ZeroClipboard.prototype.unclip=function(elements){var meta=_clientMeta[this.id];if(meta){var clippedElements=meta.elements;var arrayIndex;if(typeof elements==="undefined"){elements=clippedElements.slice(0)}else{elements=_prepClip(elements)}for(var i=elements.length;i--;){if(elements.hasOwnProperty(i)&&elements[i]&&elements[i].nodeType===1){arrayIndex=0;while((arrayIndex=_inArray(elements[i],clippedElements,arrayIndex))!==-1){clippedElements.splice(arrayIndex,1)}var clientIds=_elementMeta[elements[i].zcClippingId];if(clientIds){arrayIndex=0;while((arrayIndex=_inArray(this.id,clientIds,arrayIndex))!==-1){clientIds.splice(arrayIndex,1)}if(clientIds.length===0){if(_globalConfig.autoActivate===true){_removeEventHandler(elements[i],"mouseover",_elementMouseOver)}delete elements[i].zcClippingId}}}}}return this};ZeroClipboard.prototype.elements=function(){var meta=_clientMeta[this.id];return meta&&meta.elements?meta.elements.slice(0):[]};var _getAllClientsClippedToElement=function(element){var elementMetaId,clientIds,i,len,client,clients=[];if(element&&element.nodeType===1&&(elementMetaId=element.zcClippingId)&&_elementMeta.hasOwnProperty(elementMetaId)){clientIds=_elementMeta[elementMetaId];if(clientIds&&clientIds.length){for(i=0,len=clientIds.length;i<len;i++){client=_clientMeta[clientIds[i]].instance;if(client&&client instanceof ZeroClipboard){clients.push(client)}}}}return clients};_globalConfig.hoverClass="zeroclipboard-is-hover";_globalConfig.activeClass="zeroclipboard-is-active";_globalConfig.trustedOrigins=null;_globalConfig.allowScriptAccess=null;_globalConfig.useNoCache=true;_globalConfig.moviePath="ZeroClipboard.swf";ZeroClipboard.detectFlashSupport=function(){_deprecationWarning("ZeroClipboard.detectFlashSupport",_globalConfig.debug);return _detectFlashSupport()};ZeroClipboard.dispatch=function(eventName,args){if(typeof eventName==="string"&&eventName){var cleanEventName=eventName.toLowerCase().replace(/^on/,"");if(cleanEventName){var clients=currentElement?_getAllClientsClippedToElement(currentElement):_getAllClients();for(var i=0,len=clients.length;i<len;i++){_receiveEvent.call(clients[i],cleanEventName,args)}}}};ZeroClipboard.prototype.setHandCursor=function(enabled){_deprecationWarning("ZeroClipboard.prototype.setHandCursor",_globalConfig.debug);enabled=typeof enabled==="boolean"?enabled:!!enabled;_setHandCursor(enabled);_globalConfig.forceHandCursor=enabled;return this};ZeroClipboard.prototype.reposition=function(){_deprecationWarning("ZeroClipboard.prototype.reposition",_globalConfig.debug);return _reposition()};ZeroClipboard.prototype.receiveEvent=function(eventName,args){_deprecationWarning("ZeroClipboard.prototype.receiveEvent",_globalConfig.debug);if(typeof eventName==="string"&&eventName){var cleanEventName=eventName.toLowerCase().replace(/^on/,"");if(cleanEventName){_receiveEvent.call(this,cleanEventName,args)}}};ZeroClipboard.prototype.setCurrent=function(element){_deprecationWarning("ZeroClipboard.prototype.setCurrent",_globalConfig.debug);ZeroClipboard.activate(element);return this};ZeroClipboard.prototype.resetBridge=function(){_deprecationWarning("ZeroClipboard.prototype.resetBridge",_globalConfig.debug);ZeroClipboard.deactivate();return this};ZeroClipboard.prototype.setTitle=function(newTitle){_deprecationWarning("ZeroClipboard.prototype.setTitle",_globalConfig.debug);newTitle=newTitle||_globalConfig.title||currentElement&&currentElement.getAttribute("title");if(newTitle){var htmlBridge=_getHtmlBridge(flashState.bridge);if(htmlBridge){htmlBridge.setAttribute("title",newTitle)}}return this};ZeroClipboard.setDefaults=function(options){_deprecationWarning("ZeroClipboard.setDefaults",_globalConfig.debug);ZeroClipboard.config(options)};ZeroClipboard.prototype.addEventListener=function(eventName,func){_deprecationWarning("ZeroClipboard.prototype.addEventListener",_globalConfig.debug);return this.on(eventName,func)};ZeroClipboard.prototype.removeEventListener=function(eventName,func){_deprecationWarning("ZeroClipboard.prototype.removeEventListener",_globalConfig.debug);return this.off(eventName,func)};ZeroClipboard.prototype.ready=function(){_deprecationWarning("ZeroClipboard.prototype.ready",_globalConfig.debug);return flashState.ready===true};var _receiveEvent=function(eventName,args){eventName=eventName.toLowerCase().replace(/^on/,"");var cleanVersion=args&&args.flashVersion&&_parseFlashVersion(args.flashVersion)||null;var element=currentElement;var performCallbackAsync=true;switch(eventName){case"load":if(cleanVersion){if(!_isFlashVersionSupported(cleanVersion)){_receiveEvent.call(this,"onWrongFlash",{flashVersion:cleanVersion});return}flashState.outdated=false;flashState.ready=true;flashState.version=cleanVersion}break;case"wrongflash":if(cleanVersion&&!_isFlashVersionSupported(cleanVersion)){flashState.outdated=true;flashState.ready=false;flashState.version=cleanVersion}break;case"mouseover":_addClass(element,_globalConfig.hoverClass);break;case"mouseout":if(_globalConfig.autoActivate===true){ZeroClipboard.deactivate()}break;case"mousedown":_addClass(element,_globalConfig.activeClass);break;case"mouseup":_removeClass(element,_globalConfig.activeClass);break;case"datarequested":var targetId=element.getAttribute("data-clipboard-target"),targetEl=!targetId?null:document.getElementById(targetId);if(targetEl){var textContent=targetEl.value||targetEl.textContent||targetEl.innerText;if(textContent){this.setText(textContent)}}else{var defaultText=element.getAttribute("data-clipboard-text");if(defaultText){this.setText(defaultText)}}performCallbackAsync=false;break;case"complete":_deleteOwnProperties(_clipData);break}var context=element;var eventArgs=[this,args];return _dispatchClientCallbacks.call(this,eventName,context,eventArgs,performCallbackAsync)};if(typeof define==="function"&&define.amd){define(["require","exports","module"],function(require,exports,module){_amdModuleId=module&&module.id||null;return ZeroClipboard})}else if(typeof module==="object"&&module&&typeof module.exports==="object"&&module.exports){_cjsModuleId=module.id||null;module.exports=ZeroClipboard}else{window.ZeroClipboard=ZeroClipboard}})();

(function($){var clipboard={},clip=null;$.fn.copy_button=function(input_to_copy,clip_to_reuse){var $element=this,original_text=$element[0].text,$input_to_copy=$(input_to_copy);if(clip_to_reuse){clip=clip_to_reuse;delete clip.handlers;clip.handlers={}}else{if(clipboard[this]){delete clipboard[this]}clip=new ZeroClipboard($element,{trustedDomains:["*"],allowScriptAccess:"always",cacheBust:false,moviePath:Site.STATIC_URL.replace("https:","")+"common/lib/clipboard/ZeroClipboard-1.3.2.swf"});clip.setHandCursor(true);$(window).bind("resize",function(){clip.reposition()})}clip.on("dataRequested",function(client,args){client.setText($input_to_copy.val())});clip.on("load",function(client){client.on("complete",function(client,args){var $element=$(this);$element.text(gettext("Copied!"));window.setTimeout(function(){$element.text(original_text)},1200);var input_contents=$input_to_copy.data("contents");if(typeof Prezi!="undefined"&&"data"in Prezi){if(input_contents===undefined){if($input_to_copy.attr("id")=="inp_view_together_url"){input_contents="view_together_url"}}if(input_contents===undefined){$.log((Prezi.data.permissions["public"]?"public":"private")+" share copy_url WARNING "+input_contents+" button"+" [id:"+$input_to_copy.attr("id")+" , tagname:"+$input_to_copy.get(0).tagName+"] "+navigator.userAgent)}else{$.log((Prezi.data.permissions["public"]?"public":"private")+" share copy_url "+input_contents+" button")}}})});if(clip_to_reuse){clip.reposition($element)}};$(function(){$(".copy").each(function(){var $button=$(this);var copy=$button.data("copy");if(copy){var input_to_copy=$("#"+copy);$button.copy_button(input_to_copy)}});$(".shareable-data-container").each(function(){var $field=$(this);var contents=$field.data("contents");$field.bind({copy:function(){$.log((Prezi.data.permissions["public"]?"public":"private")+" share copy_url "+contents+" wo_button")}})});$("body").delegate("#ln_send_view_email","click",function(){var recipients=$("#form_share_view_recipient").val().split(" ").join("");var personal_note=$("#note").val().length;$.log((Prezi.data.permissions["public"]?"public":"private")+" share email view_url button "+recipients+" "+personal_note)});$("body").delegate("#ln_send_edit_email","click",function(){var recipients=$("#form_share_edit_recipient").val().split(" ").join("");var personal_note=$("#note").val().length;$.log((Prezi.data.permissions["public"]?"public":"private")+" share email edit_url button "+recipients+" "+personal_note)});$("body").delegate("#btn_share_view_group","click",function(){var personal_note=$("#note").val().length;$.log((Prezi.data.permissions["public"]?"public":"private")+" share group view_url button "+personal_note)});$("body").delegate("#btn_share_edit_group","click",function(){var personal_note=$("#note").val().length;$.log((Prezi.data.permissions["public"]?"public":"private")+" share group edit_url button "+personal_note)});$("body").delegate("#ln_share_view_facebook","click",function(){$.log((Prezi.data.permissions["public"]?"public":"private")+" share facebook view_url button")});$("body").delegate("#ln_share_view_twitter","click",function(){$.log((Prezi.data.permissions["public"]?"public":"private")+" share twitter view_url button")});$("body").delegate("#ln_reset_links","click",function(){$.log((Prezi.data.permissions["public"]?"public":"private")+" share reset_share_links_pressed")})})})(jQuery);

var Prezi=Prezi||{};var memory_timeout=3;var delay_logging=memory_timeout;Prezi.memory={cache:[],heartbeat:0};window.check_flash_state=function(){var freq=1e3,now=(new Date).getTime(),prepared_data,t=setTimeout(check_flash_state,freq),memory;Prezi.memory.heartbeat++;if(typeof Prezi.object_elem=="undefined"){try{$("object")[0].total_memory();Prezi.object_elem=$("object")[0]}catch(e){Prezi.object_elem=$("embed")[0]}}try{memory=Prezi.object_elem.total_memory()}catch(e){}if(!memory){if(delay_logging>0){delay_logging--}else{clearTimeout(t);var used_memory=Prezi.memory.cache[0]||0;var flash_version=[];$.each(swfobject.getFlashPlayerVersion(),function(k,v){flash_version.push(v)});data={name:"memory_error",levelname:"ERROR",levelno:20,created:parseInt(now/1e3,10),msecs:now%1e3,relativeCreated:0,msg:used_memory+" "+Prezi.memory.heartbeat};data.msg=data.msg+" "+flash_version.join(".")+" "+$.browser.name+$.browser.versionNumber+" "+$.os.name;prepared_data=$.base64.encode(JSON.stringify(data));$.ajax({url:"/backend/log/",type:"POST",dataType:"json",data:{data:prepared_data,prezi_id:Prezi.data.oid,source:$("body").hasClass("landing")?"landing":"editor"},success:function(){},error:function(){}});alert("There is not enough memory for this prezi to load. Please try to close other tabs and applications and reload the page!")}}else{delay_logging=memory_timeout;Prezi.memory.cache.pop();Prezi.memory.cache.push(memory)}};

(function(){var root=this;var previousUnderscore=root._;var breaker={};var ArrayProto=Array.prototype,ObjProto=Object.prototype,FuncProto=Function.prototype;var push=ArrayProto.push,slice=ArrayProto.slice,concat=ArrayProto.concat,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty;var nativeForEach=ArrayProto.forEach,nativeMap=ArrayProto.map,nativeReduce=ArrayProto.reduce,nativeReduceRight=ArrayProto.reduceRight,nativeFilter=ArrayProto.filter,nativeEvery=ArrayProto.every,nativeSome=ArrayProto.some,nativeIndexOf=ArrayProto.indexOf,nativeLastIndexOf=ArrayProto.lastIndexOf,nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeBind=FuncProto.bind;var _=function(obj){if(obj instanceof _)return obj;if(!(this instanceof _))return new _(obj);this._wrapped=obj};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=_}exports._=_}else{root._=_}_.VERSION="1.4.4";var each=_.each=_.forEach=function(obj,iterator,context){if(obj==null)return;if(nativeForEach&&obj.forEach===nativeForEach){obj.forEach(iterator,context)}else if(obj.length===+obj.length){for(var i=0,l=obj.length;i<l;i++){if(iterator.call(context,obj[i],i,obj)===breaker)return}}else{for(var key in obj){if(_.has(obj,key)){if(iterator.call(context,obj[key],key,obj)===breaker)return}}}};_.map=_.collect=function(obj,iterator,context){var results=[];if(obj==null)return results;if(nativeMap&&obj.map===nativeMap)return obj.map(iterator,context);each(obj,function(value,index,list){results[results.length]=iterator.call(context,value,index,list)});return results};var reduceError="Reduce of empty array with no initial value";_.reduce=_.foldl=_.inject=function(obj,iterator,memo,context){var initial=arguments.length>2;if(obj==null)obj=[];if(nativeReduce&&obj.reduce===nativeReduce){if(context)iterator=_.bind(iterator,context);return initial?obj.reduce(iterator,memo):obj.reduce(iterator)}each(obj,function(value,index,list){if(!initial){memo=value;initial=true}else{memo=iterator.call(context,memo,value,index,list)}});if(!initial)throw new TypeError(reduceError);return memo};_.reduceRight=_.foldr=function(obj,iterator,memo,context){var initial=arguments.length>2;if(obj==null)obj=[];if(nativeReduceRight&&obj.reduceRight===nativeReduceRight){if(context)iterator=_.bind(iterator,context);return initial?obj.reduceRight(iterator,memo):obj.reduceRight(iterator)}var length=obj.length;if(length!==+length){var keys=_.keys(obj);length=keys.length}each(obj,function(value,index,list){index=keys?keys[--length]:--length;if(!initial){memo=obj[index];initial=true}else{memo=iterator.call(context,memo,obj[index],index,list)}});if(!initial)throw new TypeError(reduceError);return memo};_.find=_.detect=function(obj,iterator,context){var result;any(obj,function(value,index,list){if(iterator.call(context,value,index,list)){result=value;return true}});return result};_.filter=_.select=function(obj,iterator,context){var results=[];if(obj==null)return results;if(nativeFilter&&obj.filter===nativeFilter)return obj.filter(iterator,context);each(obj,function(value,index,list){if(iterator.call(context,value,index,list))results[results.length]=value});return results};_.reject=function(obj,iterator,context){return _.filter(obj,function(value,index,list){return!iterator.call(context,value,index,list)},context)};_.every=_.all=function(obj,iterator,context){iterator||(iterator=_.identity);var result=true;if(obj==null)return result;if(nativeEvery&&obj.every===nativeEvery)return obj.every(iterator,context);each(obj,function(value,index,list){if(!(result=result&&iterator.call(context,value,index,list)))return breaker});return!!result};var any=_.some=_.any=function(obj,iterator,context){iterator||(iterator=_.identity);var result=false;if(obj==null)return result;if(nativeSome&&obj.some===nativeSome)return obj.some(iterator,context);each(obj,function(value,index,list){if(result||(result=iterator.call(context,value,index,list)))return breaker});return!!result};_.contains=_.include=function(obj,target){if(obj==null)return false;if(nativeIndexOf&&obj.indexOf===nativeIndexOf)return obj.indexOf(target)!=-1;return any(obj,function(value){return value===target})};_.invoke=function(obj,method){var args=slice.call(arguments,2);var isFunc=_.isFunction(method);return _.map(obj,function(value){return(isFunc?method:value[method]).apply(value,args)})};_.pluck=function(obj,key){return _.map(obj,function(value){return value[key]})};_.where=function(obj,attrs,first){if(_.isEmpty(attrs))return first?null:[];return _[first?"find":"filter"](obj,function(value){for(var key in attrs){if(attrs[key]!==value[key])return false}return true})};_.findWhere=function(obj,attrs){return _.where(obj,attrs,true)};_.max=function(obj,iterator,context){if(!iterator&&_.isArray(obj)&&obj[0]===+obj[0]&&obj.length<65535){return Math.max.apply(Math,obj)}if(!iterator&&_.isEmpty(obj))return-Infinity;var result={computed:-Infinity,value:-Infinity};each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;computed>=result.computed&&(result={value:value,computed:computed})});return result.value};_.min=function(obj,iterator,context){if(!iterator&&_.isArray(obj)&&obj[0]===+obj[0]&&obj.length<65535){return Math.min.apply(Math,obj)}if(!iterator&&_.isEmpty(obj))return Infinity;var result={computed:Infinity,value:Infinity};each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;computed<result.computed&&(result={value:value,computed:computed})});return result.value};_.shuffle=function(obj){var rand;var index=0;var shuffled=[];each(obj,function(value){rand=_.random(index++);shuffled[index-1]=shuffled[rand];shuffled[rand]=value});return shuffled};var lookupIterator=function(value){return _.isFunction(value)?value:function(obj){return obj[value]}};_.sortBy=function(obj,value,context){var iterator=lookupIterator(value);return _.pluck(_.map(obj,function(value,index,list){return{value:value,index:index,criteria:iterator.call(context,value,index,list)}}).sort(function(left,right){var a=left.criteria;var b=right.criteria;if(a!==b){if(a>b||a===void 0)return 1;if(a<b||b===void 0)return-1}return left.index<right.index?-1:1}),"value")};var group=function(obj,value,context,behavior){var result={};var iterator=lookupIterator(value||_.identity);each(obj,function(value,index){var key=iterator.call(context,value,index,obj);behavior(result,key,value)});return result};_.groupBy=function(obj,value,context){return group(obj,value,context,function(result,key,value){(_.has(result,key)?result[key]:result[key]=[]).push(value)})};_.countBy=function(obj,value,context){return group(obj,value,context,function(result,key){if(!_.has(result,key))result[key]=0;result[key]++})};_.sortedIndex=function(array,obj,iterator,context){iterator=iterator==null?_.identity:lookupIterator(iterator);var value=iterator.call(context,obj);var low=0,high=array.length;while(low<high){var mid=low+high>>>1;iterator.call(context,array[mid])<value?low=mid+1:high=mid}return low};_.toArray=function(obj){if(!obj)return[];if(_.isArray(obj))return slice.call(obj);if(obj.length===+obj.length)return _.map(obj,_.identity);return _.values(obj)};_.size=function(obj){if(obj==null)return 0;return obj.length===+obj.length?obj.length:_.keys(obj).length};_.first=_.head=_.take=function(array,n,guard){if(array==null)return void 0;return n!=null&&!guard?slice.call(array,0,n):array[0]};_.initial=function(array,n,guard){return slice.call(array,0,array.length-(n==null||guard?1:n))};_.last=function(array,n,guard){if(array==null)return void 0;if(n!=null&&!guard){return slice.call(array,Math.max(array.length-n,0))}else{return array[array.length-1]}};_.rest=_.tail=_.drop=function(array,n,guard){return slice.call(array,n==null||guard?1:n)};_.compact=function(array){return _.filter(array,_.identity)};var flatten=function(input,shallow,output){each(input,function(value){if(_.isArray(value)){shallow?push.apply(output,value):flatten(value,shallow,output)}else{output.push(value)}});return output};_.flatten=function(array,shallow){return flatten(array,shallow,[])};_.without=function(array){return _.difference(array,slice.call(arguments,1))};_.uniq=_.unique=function(array,isSorted,iterator,context){if(_.isFunction(isSorted)){context=iterator;iterator=isSorted;isSorted=false}var initial=iterator?_.map(array,iterator,context):array;var results=[];var seen=[];each(initial,function(value,index){if(isSorted?!index||seen[seen.length-1]!==value:!_.contains(seen,value)){seen.push(value);results.push(array[index])}});return results};_.union=function(){return _.uniq(concat.apply(ArrayProto,arguments))};_.intersection=function(array){var rest=slice.call(arguments,1);return _.filter(_.uniq(array),function(item){return _.every(rest,function(other){return _.indexOf(other,item)>=0})})};_.difference=function(array){var rest=concat.apply(ArrayProto,slice.call(arguments,1));return _.filter(array,function(value){return!_.contains(rest,value)})};_.zip=function(){var args=slice.call(arguments);var length=_.max(_.pluck(args,"length"));var results=new Array(length);for(var i=0;i<length;i++){results[i]=_.pluck(args,""+i)}return results};_.object=function(list,values){if(list==null)return{};var result={};for(var i=0,l=list.length;i<l;i++){if(values){result[list[i]]=values[i]}else{result[list[i][0]]=list[i][1]}}return result};_.indexOf=function(array,item,isSorted){if(array==null)return-1;var i=0,l=array.length;if(isSorted){if(typeof isSorted=="number"){i=isSorted<0?Math.max(0,l+isSorted):isSorted}else{i=_.sortedIndex(array,item);return array[i]===item?i:-1}}if(nativeIndexOf&&array.indexOf===nativeIndexOf)return array.indexOf(item,isSorted);for(;i<l;i++)if(array[i]===item)return i;return-1};_.lastIndexOf=function(array,item,from){if(array==null)return-1;var hasIndex=from!=null;if(nativeLastIndexOf&&array.lastIndexOf===nativeLastIndexOf){return hasIndex?array.lastIndexOf(item,from):array.lastIndexOf(item)}var i=hasIndex?from:array.length;while(i--)if(array[i]===item)return i;return-1};_.range=function(start,stop,step){if(arguments.length<=1){stop=start||0;start=0}step=arguments[2]||1;var len=Math.max(Math.ceil((stop-start)/step),0);var idx=0;var range=new Array(len);while(idx<len){range[idx++]=start;start+=step}return range};_.bind=function(func,context){if(func.bind===nativeBind&&nativeBind)return nativeBind.apply(func,slice.call(arguments,1));var args=slice.call(arguments,2);return function(){return func.apply(context,args.concat(slice.call(arguments)))}};_.partial=function(func){var args=slice.call(arguments,1);return function(){return func.apply(this,args.concat(slice.call(arguments)))}};_.bindAll=function(obj){var funcs=slice.call(arguments,1);if(funcs.length===0)funcs=_.functions(obj);each(funcs,function(f){obj[f]=_.bind(obj[f],obj)});return obj};_.memoize=function(func,hasher){var memo={};hasher||(hasher=_.identity);return function(){var key=hasher.apply(this,arguments);return _.has(memo,key)?memo[key]:memo[key]=func.apply(this,arguments)}};_.delay=function(func,wait){var args=slice.call(arguments,2);return setTimeout(function(){return func.apply(null,args)},wait)};_.defer=function(func){return _.delay.apply(_,[func,1].concat(slice.call(arguments,1)))};_.throttle=function(func,wait){var context,args,timeout,result;var previous=0;var later=function(){previous=new Date;timeout=null;result=func.apply(context,args)};return function(){var now=new Date;var remaining=wait-(now-previous);context=this;args=arguments;if(remaining<=0){clearTimeout(timeout);timeout=null;previous=now;result=func.apply(context,args)}else if(!timeout){timeout=setTimeout(later,remaining)}return result}};_.debounce=function(func,wait,immediate){var timeout,result;return function(){var context=this,args=arguments;var later=function(){timeout=null;if(!immediate)result=func.apply(context,args)};var callNow=immediate&&!timeout;clearTimeout(timeout);timeout=setTimeout(later,wait);if(callNow)result=func.apply(context,args);return result}};_.once=function(func){var ran=false,memo;return function(){if(ran)return memo;ran=true;memo=func.apply(this,arguments);func=null;return memo}};_.wrap=function(func,wrapper){return function(){var args=[func];push.apply(args,arguments);return wrapper.apply(this,args)}};_.compose=function(){var funcs=arguments;return function(){var args=arguments;for(var i=funcs.length-1;i>=0;i--){args=[funcs[i].apply(this,args)]}return args[0]}};_.after=function(times,func){if(times<=0)return func();return function(){if(--times<1){return func.apply(this,arguments)}}};_.keys=nativeKeys||function(obj){if(obj!==Object(obj))throw new TypeError("Invalid object");var keys=[];for(var key in obj)if(_.has(obj,key))keys[keys.length]=key;return keys};_.values=function(obj){var values=[];for(var key in obj)if(_.has(obj,key))values.push(obj[key]);return values};_.pairs=function(obj){var pairs=[];for(var key in obj)if(_.has(obj,key))pairs.push([key,obj[key]]);return pairs};_.invert=function(obj){var result={};for(var key in obj)if(_.has(obj,key))result[obj[key]]=key;return result};_.functions=_.methods=function(obj){var names=[];for(var key in obj){if(_.isFunction(obj[key]))names.push(key)}return names.sort()};_.extend=function(obj){each(slice.call(arguments,1),function(source){if(source){for(var prop in source){obj[prop]=source[prop]}}});return obj};_.pick=function(obj){var copy={};var keys=concat.apply(ArrayProto,slice.call(arguments,1));each(keys,function(key){if(key in obj)copy[key]=obj[key]});return copy};_.omit=function(obj){var copy={};var keys=concat.apply(ArrayProto,slice.call(arguments,1));for(var key in obj){if(!_.contains(keys,key))copy[key]=obj[key]}return copy};_.defaults=function(obj){each(slice.call(arguments,1),function(source){if(source){for(var prop in source){if(obj[prop]==null)obj[prop]=source[prop]}}});return obj};_.clone=function(obj){if(!_.isObject(obj))return obj;return _.isArray(obj)?obj.slice():_.extend({},obj)};_.tap=function(obj,interceptor){interceptor(obj);return obj};var eq=function(a,b,aStack,bStack){if(a===b)return a!==0||1/a==1/b;if(a==null||b==null)return a===b;if(a instanceof _)a=a._wrapped;if(b instanceof _)b=b._wrapped;var className=toString.call(a);if(className!=toString.call(b))return false;switch(className){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:a==0?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if(typeof a!="object"||typeof b!="object")return false;var length=aStack.length;while(length--){if(aStack[length]==a)return bStack[length]==b}aStack.push(a);bStack.push(b);var size=0,result=true;if(className=="[object Array]"){size=a.length;result=size==b.length;if(result){while(size--){if(!(result=eq(a[size],b[size],aStack,bStack)))break}}}else{var aCtor=a.constructor,bCtor=b.constructor;if(aCtor!==bCtor&&!(_.isFunction(aCtor)&&aCtor instanceof aCtor&&_.isFunction(bCtor)&&bCtor instanceof bCtor)){return false}for(var key in a){if(_.has(a,key)){size++;if(!(result=_.has(b,key)&&eq(a[key],b[key],aStack,bStack)))break}}if(result){for(key in b){if(_.has(b,key)&&!size--)break}result=!size}}aStack.pop();bStack.pop();return result};_.isEqual=function(a,b){return eq(a,b,[],[])};_.isEmpty=function(obj){if(obj==null)return true;if(_.isArray(obj)||_.isString(obj))return obj.length===0;for(var key in obj)if(_.has(obj,key))return false;return true};_.isElement=function(obj){return!!(obj&&obj.nodeType===1)};_.isArray=nativeIsArray||function(obj){return toString.call(obj)=="[object Array]"};_.isObject=function(obj){return obj===Object(obj)};each(["Arguments","Function","String","Number","Date","RegExp"],function(name){_["is"+name]=function(obj){return toString.call(obj)=="[object "+name+"]"}});if(!_.isArguments(arguments)){_.isArguments=function(obj){return!!(obj&&_.has(obj,"callee"))}}if(typeof/./!=="function"){_.isFunction=function(obj){return typeof obj==="function"}}_.isFinite=function(obj){return isFinite(obj)&&!isNaN(parseFloat(obj))};_.isNaN=function(obj){return _.isNumber(obj)&&obj!=+obj};_.isBoolean=function(obj){return obj===true||obj===false||toString.call(obj)=="[object Boolean]"};_.isNull=function(obj){return obj===null};_.isUndefined=function(obj){return obj===void 0};_.has=function(obj,key){return hasOwnProperty.call(obj,key)};_.noConflict=function(){root._=previousUnderscore;return this};_.identity=function(value){return value};_.times=function(n,iterator,context){var accum=Array(n);for(var i=0;i<n;i++)accum[i]=iterator.call(context,i);return accum};_.random=function(min,max){if(max==null){max=min;min=0}return min+Math.floor(Math.random()*(max-min+1))};var entityMap={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};entityMap.unescape=_.invert(entityMap.escape);var entityRegexes={escape:new RegExp("["+_.keys(entityMap.escape).join("")+"]","g"),unescape:new RegExp("("+_.keys(entityMap.unescape).join("|")+")","g")};_.each(["escape","unescape"],function(method){_[method]=function(string){if(string==null)return"";return(""+string).replace(entityRegexes[method],function(match){return entityMap[method][match]})}});_.result=function(object,property){if(object==null)return null;var value=object[property];return _.isFunction(value)?value.call(object):value};_.mixin=function(obj){each(_.functions(obj),function(name){var func=_[name]=obj[name];_.prototype[name]=function(){var args=[this._wrapped];push.apply(args,arguments);return result.call(this,func.apply(_,args))}})};var idCounter=0;_.uniqueId=function(prefix){var id=++idCounter+"";return prefix?prefix+id:id};_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var noMatch=/(.)^/;var escapes={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"};var escaper=/\\|'|\r|\n|\t|\u2028|\u2029/g;_.template=function(text,data,settings){var render;settings=_.defaults({},settings,_.templateSettings);var matcher=new RegExp([(settings.escape||noMatch).source,(settings.interpolate||noMatch).source,(settings.evaluate||noMatch).source].join("|")+"|$","g");var index=0;var source="__p+='";text.replace(matcher,function(match,escape,interpolate,evaluate,offset){source+=text.slice(index,offset).replace(escaper,function(match){return"\\"+escapes[match]});if(escape){source+="'+\n((__t=("+escape+"))==null?'':_.escape(__t))+\n'"}if(interpolate){source+="'+\n((__t=("+interpolate+"))==null?'':__t)+\n'"}if(evaluate){source+="';\n"+evaluate+"\n__p+='"}index=offset+match.length;return match});source+="';\n";if(!settings.variable)source="with(obj||{}){\n"+source+"}\n";source="var __t,__p='',__j=Array.prototype.join,"+"print=function(){__p+=__j.call(arguments,'');};\n"+source+"return __p;\n";try{render=new Function(settings.variable||"obj","_",source)}catch(e){e.source=source;throw e}if(data)return render(data,_);var template=function(data){return render.call(this,data,_)};template.source="function("+(settings.variable||"obj")+"){\n"+source+"}";return template};_.chain=function(obj){return _(obj).chain()};var result=function(obj){return this._chain?_(obj).chain():obj};_.mixin(_);each(["pop","push","reverse","shift","sort","splice","unshift"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){var obj=this._wrapped;method.apply(obj,arguments);if((name=="shift"||name=="splice")&&obj.length===0)delete obj[0];return result.call(this,obj)}});each(["concat","join","slice"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){return result.call(this,method.apply(this._wrapped,arguments))}});_.extend(_.prototype,{chain:function(){this._chain=true;return this},value:function(){return this._wrapped}})}).call(this);

(function(){var root=this;var previousBackbone=root.Backbone;var array=[];var push=array.push;var slice=array.slice;var splice=array.splice;var Backbone;if(typeof exports!=="undefined"){Backbone=exports}else{Backbone=root.Backbone={}}Backbone.VERSION="1.0.0";var _=root._;if(!_&&typeof require!=="undefined")_=require("underscore");Backbone.$=root.jQuery||root.Zepto||root.ender||root.$;Backbone.noConflict=function(){root.Backbone=previousBackbone;return this};Backbone.emulateHTTP=false;Backbone.emulateJSON=false;var Events=Backbone.Events={on:function(name,callback,context){if(!eventsApi(this,"on",name,[callback,context])||!callback)return this;this._events||(this._events={});var events=this._events[name]||(this._events[name]=[]);events.push({callback:callback,context:context,ctx:context||this});return this},once:function(name,callback,context){if(!eventsApi(this,"once",name,[callback,context])||!callback)return this;var self=this;var once=_.once(function(){self.off(name,once);callback.apply(this,arguments)});once._callback=callback;return this.on(name,once,context)},off:function(name,callback,context){var retain,ev,events,names,i,l,j,k;if(!this._events||!eventsApi(this,"off",name,[callback,context]))return this;if(!name&&!callback&&!context){this._events={};return this}names=name?[name]:_.keys(this._events);for(i=0,l=names.length;i<l;i++){name=names[i];if(events=this._events[name]){this._events[name]=retain=[];if(callback||context){for(j=0,k=events.length;j<k;j++){ev=events[j];if(callback&&callback!==ev.callback&&callback!==ev.callback._callback||context&&context!==ev.context){retain.push(ev)}}}if(!retain.length)delete this._events[name]}}return this},trigger:function(name){if(!this._events)return this;var args=slice.call(arguments,1);if(!eventsApi(this,"trigger",name,args))return this;var events=this._events[name];var allEvents=this._events.all;if(events)triggerEvents(events,args);if(allEvents)triggerEvents(allEvents,arguments);return this},stopListening:function(obj,name,callback){var listeners=this._listeners;if(!listeners)return this;var deleteListener=!name&&!callback;if(typeof name==="object")callback=this;if(obj)(listeners={})[obj._listenerId]=obj;for(var id in listeners){listeners[id].off(name,callback,this);if(deleteListener)delete this._listeners[id]}return this}};var eventSplitter=/\s+/;var eventsApi=function(obj,action,name,rest){if(!name)return true;if(typeof name==="object"){for(var key in name){obj[action].apply(obj,[key,name[key]].concat(rest))}return false}if(eventSplitter.test(name)){var names=name.split(eventSplitter);for(var i=0,l=names.length;i<l;i++){obj[action].apply(obj,[names[i]].concat(rest))}return false}return true};var triggerEvents=function(events,args){var ev,i=-1,l=events.length,a1=args[0],a2=args[1],a3=args[2];switch(args.length){case 0:while(++i<l)(ev=events[i]).callback.call(ev.ctx);return;case 1:while(++i<l)(ev=events[i]).callback.call(ev.ctx,a1);return;case 2:while(++i<l)(ev=events[i]).callback.call(ev.ctx,a1,a2);return;case 3:while(++i<l)(ev=events[i]).callback.call(ev.ctx,a1,a2,a3);return;default:while(++i<l)(ev=events[i]).callback.apply(ev.ctx,args)}};var listenMethods={listenTo:"on",listenToOnce:"once"};_.each(listenMethods,function(implementation,method){Events[method]=function(obj,name,callback){var listeners=this._listeners||(this._listeners={});var id=obj._listenerId||(obj._listenerId=_.uniqueId("l"));listeners[id]=obj;if(typeof name==="object")callback=this;obj[implementation](name,callback,this);return this}});Events.bind=Events.on;Events.unbind=Events.off;_.extend(Backbone,Events);var Model=Backbone.Model=function(attributes,options){var defaults;var attrs=attributes||{};options||(options={});this.cid=_.uniqueId("c");this.attributes={};_.extend(this,_.pick(options,modelOptions));if(options.parse)attrs=this.parse(attrs,options)||{};if(defaults=_.result(this,"defaults")){attrs=_.defaults({},attrs,defaults)}this.set(attrs,options);this.changed={};this.initialize.apply(this,arguments)};var modelOptions=["url","urlRoot","collection"];_.extend(Model.prototype,Events,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(options){return _.clone(this.attributes)},sync:function(){return Backbone.sync.apply(this,arguments)},get:function(attr){return this.attributes[attr]},escape:function(attr){return _.escape(this.get(attr))},has:function(attr){return this.get(attr)!=null},set:function(key,val,options){var attr,attrs,unset,changes,silent,changing,prev,current;if(key==null)return this;if(typeof key==="object"){attrs=key;options=val}else{(attrs={})[key]=val}options||(options={});if(!this._validate(attrs,options))return false;unset=options.unset;silent=options.silent;changes=[];changing=this._changing;this._changing=true;if(!changing){this._previousAttributes=_.clone(this.attributes);this.changed={}}current=this.attributes,prev=this._previousAttributes;if(this.idAttribute in attrs)this.id=attrs[this.idAttribute];for(attr in attrs){val=attrs[attr];if(!_.isEqual(current[attr],val))changes.push(attr);if(!_.isEqual(prev[attr],val)){this.changed[attr]=val}else{delete this.changed[attr]}unset?delete current[attr]:current[attr]=val}if(!silent){if(changes.length)this._pending=true;for(var i=0,l=changes.length;i<l;i++){this.trigger("change:"+changes[i],this,current[changes[i]],options)}}if(changing)return this;if(!silent){while(this._pending){this._pending=false;this.trigger("change",this,options)}}this._pending=false;this._changing=false;return this},unset:function(attr,options){return this.set(attr,void 0,_.extend({},options,{unset:true}))},clear:function(options){var attrs={};for(var key in this.attributes)attrs[key]=void 0;return this.set(attrs,_.extend({},options,{unset:true}))},hasChanged:function(attr){if(attr==null)return!_.isEmpty(this.changed);return _.has(this.changed,attr)},changedAttributes:function(diff){if(!diff)return this.hasChanged()?_.clone(this.changed):false;var val,changed=false;var old=this._changing?this._previousAttributes:this.attributes;for(var attr in diff){if(_.isEqual(old[attr],val=diff[attr]))continue;(changed||(changed={}))[attr]=val}return changed},previous:function(attr){if(attr==null||!this._previousAttributes)return null;return this._previousAttributes[attr]},previousAttributes:function(){return _.clone(this._previousAttributes)},fetch:function(options){options=options?_.clone(options):{};if(options.parse===void 0)options.parse=true;var model=this;var success=options.success;options.success=function(resp){if(!model.set(model.parse(resp,options),options))return false;if(success)success(model,resp,options);model.trigger("sync",model,resp,options)};wrapError(this,options);return this.sync("read",this,options)},save:function(key,val,options){var attrs,method,xhr,attributes=this.attributes;if(key==null||typeof key==="object"){attrs=key;options=val}else{(attrs={})[key]=val}if(attrs&&(!options||!options.wait)&&!this.set(attrs,options))return false;options=_.extend({validate:true},options);if(!this._validate(attrs,options))return false;if(attrs&&options.wait){this.attributes=_.extend({},attributes,attrs)}if(options.parse===void 0)options.parse=true;var model=this;var success=options.success;options.success=function(resp){model.attributes=attributes;var serverAttrs=model.parse(resp,options);if(options.wait)serverAttrs=_.extend(attrs||{},serverAttrs);if(_.isObject(serverAttrs)&&!model.set(serverAttrs,options)){return false}if(success)success(model,resp,options);model.trigger("sync",model,resp,options)};wrapError(this,options);method=this.isNew()?"create":options.patch?"patch":"update";if(method==="patch")options.attrs=attrs;xhr=this.sync(method,this,options);if(attrs&&options.wait)this.attributes=attributes;return xhr},destroy:function(options){options=options?_.clone(options):{};var model=this;var success=options.success;var destroy=function(){model.trigger("destroy",model,model.collection,options)};options.success=function(resp){if(options.wait||model.isNew())destroy();if(success)success(model,resp,options);if(!model.isNew())model.trigger("sync",model,resp,options)};if(this.isNew()){options.success();return false}wrapError(this,options);var xhr=this.sync("delete",this,options);if(!options.wait)destroy();return xhr},url:function(){var base=_.result(this,"urlRoot")||_.result(this.collection,"url")||urlError();if(this.isNew())return base;return base+(base.charAt(base.length-1)==="/"?"":"/")+encodeURIComponent(this.id)},parse:function(resp,options){return resp},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},isValid:function(options){return this._validate({},_.extend(options||{},{validate:true}))},_validate:function(attrs,options){if(!options.validate||!this.validate)return true;attrs=_.extend({},this.attributes,attrs);var error=this.validationError=this.validate(attrs,options)||null;if(!error)return true;this.trigger("invalid",this,error,_.extend(options||{},{validationError:error}));return false}});var modelMethods=["keys","values","pairs","invert","pick","omit"];_.each(modelMethods,function(method){Model.prototype[method]=function(){var args=slice.call(arguments);args.unshift(this.attributes);return _[method].apply(_,args)}});var Collection=Backbone.Collection=function(models,options){options||(options={});if(options.url)this.url=options.url;if(options.model)this.model=options.model;if(options.comparator!==void 0)this.comparator=options.comparator;this._reset();this.initialize.apply(this,arguments);if(models)this.reset(models,_.extend({silent:true},options))};var setOptions={add:true,remove:true,merge:true};var addOptions={add:true,merge:false,remove:false};_.extend(Collection.prototype,Events,{model:Model,initialize:function(){},toJSON:function(options){return this.map(function(model){return model.toJSON(options)})},sync:function(){return Backbone.sync.apply(this,arguments)},add:function(models,options){return this.set(models,_.defaults(options||{},addOptions))},remove:function(models,options){models=_.isArray(models)?models.slice():[models];options||(options={});var i,l,index,model;for(i=0,l=models.length;i<l;i++){model=this.get(models[i]);if(!model)continue;delete this._byId[model.id];delete this._byId[model.cid];index=this.indexOf(model);this.models.splice(index,1);this.length--;if(!options.silent){options.index=index;model.trigger("remove",model,this,options)}this._removeReference(model)}return this},set:function(models,options){options=_.defaults(options||{},setOptions);if(options.parse)models=this.parse(models,options);if(!_.isArray(models))models=models?[models]:[];var i,l,model,attrs,existing,sort;var at=options.at;var sortable=this.comparator&&at==null&&options.sort!==false;var sortAttr=_.isString(this.comparator)?this.comparator:null;var toAdd=[],toRemove=[],modelMap={};for(i=0,l=models.length;i<l;i++){if(!(model=this._prepareModel(models[i],options)))continue;if(existing=this.get(model)){if(options.remove)modelMap[existing.cid]=true;if(options.merge){existing.set(model.attributes,options);if(sortable&&!sort&&existing.hasChanged(sortAttr))sort=true}}else if(options.add){toAdd.push(model);model.on("all",this._onModelEvent,this);this._byId[model.cid]=model;if(model.id!=null)this._byId[model.id]=model}}if(options.remove){for(i=0,l=this.length;i<l;++i){if(!modelMap[(model=this.models[i]).cid])toRemove.push(model)}if(toRemove.length)this.remove(toRemove,options)}if(toAdd.length){if(sortable)sort=true;this.length+=toAdd.length;if(at!=null){splice.apply(this.models,[at,0].concat(toAdd))}else{push.apply(this.models,toAdd)}}if(sort)this.sort({silent:true});if(options.silent)return this;for(i=0,l=toAdd.length;i<l;i++){(model=toAdd[i]).trigger("add",model,this,options)}if(sort)this.trigger("sort",this,options);return this},reset:function(models,options){options||(options={});for(var i=0,l=this.models.length;i<l;i++){this._removeReference(this.models[i])}options.previousModels=this.models;this._reset();this.add(models,_.extend({silent:true},options));if(!options.silent)this.trigger("reset",this,options);return this},push:function(model,options){model=this._prepareModel(model,options);this.add(model,_.extend({at:this.length},options));return model},pop:function(options){var model=this.at(this.length-1);this.remove(model,options);return model},unshift:function(model,options){model=this._prepareModel(model,options);this.add(model,_.extend({at:0},options));return model},shift:function(options){var model=this.at(0);this.remove(model,options);return model},slice:function(begin,end){return this.models.slice(begin,end)},get:function(obj){if(obj==null)return void 0;return this._byId[obj.id!=null?obj.id:obj.cid||obj]},at:function(index){return this.models[index]},where:function(attrs,first){if(_.isEmpty(attrs))return first?void 0:[];return this[first?"find":"filter"](function(model){for(var key in attrs){if(attrs[key]!==model.get(key))return false}return true})},findWhere:function(attrs){return this.where(attrs,true)},sort:function(options){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");options||(options={});if(_.isString(this.comparator)||this.comparator.length===1){this.models=this.sortBy(this.comparator,this)}else{this.models.sort(_.bind(this.comparator,this))}if(!options.silent)this.trigger("sort",this,options);return this},sortedIndex:function(model,value,context){value||(value=this.comparator);var iterator=_.isFunction(value)?value:function(model){return model.get(value)};return _.sortedIndex(this.models,model,iterator,context)},pluck:function(attr){return _.invoke(this.models,"get",attr)},fetch:function(options){options=options?_.clone(options):{};if(options.parse===void 0)options.parse=true;var success=options.success;var collection=this;options.success=function(resp){var method=options.reset?"reset":"set";collection[method](resp,options);if(success)success(collection,resp,options);collection.trigger("sync",collection,resp,options)};wrapError(this,options);return this.sync("read",this,options)},create:function(model,options){options=options?_.clone(options):{};if(!(model=this._prepareModel(model,options)))return false;if(!options.wait)this.add(model,options);var collection=this;var success=options.success;options.success=function(resp){if(options.wait)collection.add(model,options);if(success)success(model,resp,options)};model.save(null,options);return model},parse:function(resp,options){return resp},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0;this.models=[];this._byId={}},_prepareModel:function(attrs,options){if(attrs instanceof Model){if(!attrs.collection)attrs.collection=this;return attrs}options||(options={});options.collection=this;var model=new this.model(attrs,options);if(!model._validate(attrs,options)){this.trigger("invalid",this,attrs,options);return false}return model},_removeReference:function(model){if(this===model.collection)delete model.collection;model.off("all",this._onModelEvent,this)},_onModelEvent:function(event,model,collection,options){if((event==="add"||event==="remove")&&collection!==this)return;if(event==="destroy")this.remove(model,options);if(model&&event==="change:"+model.idAttribute){delete this._byId[model.previous(model.idAttribute)];if(model.id!=null)this._byId[model.id]=model}this.trigger.apply(this,arguments)}});var methods=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"];_.each(methods,function(method){Collection.prototype[method]=function(){var args=slice.call(arguments);args.unshift(this.models);return _[method].apply(_,args)}});var attributeMethods=["groupBy","countBy","sortBy"];_.each(attributeMethods,function(method){Collection.prototype[method]=function(value,context){var iterator=_.isFunction(value)?value:function(model){return model.get(value)};return _[method](this.models,iterator,context)}});var View=Backbone.View=function(options){this.cid=_.uniqueId("view");this._configure(options||{});this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()};var delegateEventSplitter=/^(\S+)\s*(.*)$/;var viewOptions=["model","collection","el","id","attributes","className","tagName","events"];_.extend(View.prototype,Events,{tagName:"div",$:function(selector){return this.$el.find(selector)},initialize:function(){},render:function(){return this},remove:function(){this.$el.remove();this.stopListening();return this},setElement:function(element,delegate){if(this.$el)this.undelegateEvents();this.$el=element instanceof Backbone.$?element:Backbone.$(element);this.el=this.$el[0];if(delegate!==false)this.delegateEvents();return this},delegateEvents:function(events){if(!(events||(events=_.result(this,"events"))))return this;this.undelegateEvents();for(var key in events){var method=events[key];if(!_.isFunction(method))method=this[events[key]];if(!method)continue;var match=key.match(delegateEventSplitter);var eventName=match[1],selector=match[2];method=_.bind(method,this);eventName+=".delegateEvents"+this.cid;if(selector===""){this.$el.on(eventName,method)}else{this.$el.on(eventName,selector,method)}}return this},undelegateEvents:function(){this.$el.off(".delegateEvents"+this.cid);return this},_configure:function(options){if(this.options)options=_.extend({},_.result(this,"options"),options);_.extend(this,_.pick(options,viewOptions));this.options=options},_ensureElement:function(){if(!this.el){var attrs=_.extend({},_.result(this,"attributes"));if(this.id)attrs.id=_.result(this,"id");if(this.className)attrs["class"]=_.result(this,"className");var $el=Backbone.$("<"+_.result(this,"tagName")+">").attr(attrs);this.setElement($el,false)}else{this.setElement(_.result(this,"el"),false)}}});Backbone.sync=function(method,model,options){var type=methodMap[method];_.defaults(options||(options={}),{emulateHTTP:Backbone.emulateHTTP,emulateJSON:Backbone.emulateJSON});var params={type:type,dataType:"json"};if(!options.url){params.url=_.result(model,"url")||urlError()}if(options.data==null&&model&&(method==="create"||method==="update"||method==="patch")){params.contentType="application/json";params.data=JSON.stringify(options.attrs||model.toJSON(options))}if(options.emulateJSON){params.contentType="application/x-www-form-urlencoded";params.data=params.data?{model:params.data}:{}}if(options.emulateHTTP&&(type==="PUT"||type==="DELETE"||type==="PATCH")){params.type="POST";if(options.emulateJSON)params.data._method=type;var beforeSend=options.beforeSend;options.beforeSend=function(xhr){xhr.setRequestHeader("X-HTTP-Method-Override",type);if(beforeSend)return beforeSend.apply(this,arguments)}}if(params.type!=="GET"&&!options.emulateJSON){params.processData=false}if(params.type==="PATCH"&&window.ActiveXObject&&!(window.external&&window.external.msActiveXFilteringEnabled)){params.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")}}var xhr=options.xhr=Backbone.ajax(_.extend(params,options));model.trigger("request",model,xhr,options);return xhr};var methodMap={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};Backbone.ajax=function(){return Backbone.$.ajax.apply(Backbone.$,arguments)};var Router=Backbone.Router=function(options){options||(options={});if(options.routes)this.routes=options.routes;this._bindRoutes();this.initialize.apply(this,arguments)};var optionalParam=/\((.*?)\)/g;var namedParam=/(\(\?)?:\w+/g;var splatParam=/\*\w+/g;var escapeRegExp=/[\-{}\[\]+?.,\\\^$|#\s]/g;_.extend(Router.prototype,Events,{initialize:function(){},route:function(route,name,callback){if(!_.isRegExp(route))route=this._routeToRegExp(route);if(_.isFunction(name)){callback=name;name=""}if(!callback)callback=this[name];var router=this;Backbone.history.route(route,function(fragment){var args=router._extractParameters(route,fragment);callback&&callback.apply(router,args);router.trigger.apply(router,["route:"+name].concat(args));router.trigger("route",name,args);Backbone.history.trigger("route",router,name,args)});return this},navigate:function(fragment,options){Backbone.history.navigate(fragment,options);return this},_bindRoutes:function(){if(!this.routes)return;this.routes=_.result(this,"routes");var route,routes=_.keys(this.routes);while((route=routes.pop())!=null){this.route(route,this.routes[route])}},_routeToRegExp:function(route){route=route.replace(escapeRegExp,"\\$&").replace(optionalParam,"(?:$1)?").replace(namedParam,function(match,optional){return optional?match:"([^/]+)"}).replace(splatParam,"(.*?)");return new RegExp("^"+route+"$")},_extractParameters:function(route,fragment){var params=route.exec(fragment).slice(1);return _.map(params,function(param){return param?decodeURIComponent(param):null})}});var History=Backbone.History=function(){this.handlers=[];_.bindAll(this,"checkUrl");if(typeof window!=="undefined"){this.location=window.location;this.history=window.history}};var routeStripper=/^[#\/]|\s+$/g;var rootStripper=/^\/+|\/+$/g;var isExplorer=/msie [\w.]+/;var trailingSlash=/\/$/;History.started=false;_.extend(History.prototype,Events,{interval:50,getHash:function(window){var match=(window||this).location.href.match(/#(.*)$/);return match?match[1]:""},getFragment:function(fragment,forcePushState){if(fragment==null){if(this._hasPushState||!this._wantsHashChange||forcePushState){fragment=this.location.pathname;var root=this.root.replace(trailingSlash,"");if(!fragment.indexOf(root))fragment=fragment.substr(root.length)}else{fragment=this.getHash()}}return fragment.replace(routeStripper,"")},start:function(options){if(History.started)throw new Error("Backbone.history has already been started");History.started=true;this.options=_.extend({},{root:"/"},this.options,options);this.root=this.options.root;this._wantsHashChange=this.options.hashChange!==false;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var fragment=this.getFragment();var docMode=document.documentMode;var oldIE=isExplorer.exec(navigator.userAgent.toLowerCase())&&(!docMode||docMode<=7);this.root=("/"+this.root+"/").replace(rootStripper,"/");if(oldIE&&this._wantsHashChange){this.iframe=Backbone.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow;this.navigate(fragment)}if(this._hasPushState){Backbone.$(window).on("popstate",this.checkUrl)}else if(this._wantsHashChange&&"onhashchange"in window&&!oldIE){Backbone.$(window).on("hashchange",this.checkUrl)}else if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval)}this.fragment=fragment;var loc=this.location;var atRoot=loc.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!atRoot){this.fragment=this.getFragment(null,true);this.location.replace(this.root+this.location.search+"#"+this.fragment);return true}else if(this._wantsPushState&&this._hasPushState&&atRoot&&loc.hash){this.fragment=this.getHash().replace(routeStripper,"");this.history.replaceState({},document.title,this.root+this.fragment+loc.search)}if(!this.options.silent)return this.loadUrl()},stop:function(){Backbone.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl);clearInterval(this._checkUrlInterval);History.started=false},route:function(route,callback){this.handlers.unshift({route:route,callback:callback})},checkUrl:function(e){var current=this.getFragment();if(current===this.fragment&&this.iframe){current=this.getFragment(this.getHash(this.iframe))}if(current===this.fragment)return false;if(this.iframe)this.navigate(current);this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(fragmentOverride){var fragment=this.fragment=this.getFragment(fragmentOverride);var matched=_.any(this.handlers,function(handler){if(handler.route.test(fragment)){handler.callback(fragment);return true}});return matched},navigate:function(fragment,options){if(!History.started)return false;if(!options||options===true)options={trigger:options};fragment=this.getFragment(fragment||"");if(this.fragment===fragment)return;this.fragment=fragment;var url=this.root+fragment;if(this._hasPushState){this.history[options.replace?"replaceState":"pushState"]({},document.title,url)}else if(this._wantsHashChange){this._updateHash(this.location,fragment,options.replace);if(this.iframe&&fragment!==this.getFragment(this.getHash(this.iframe))){if(!options.replace)this.iframe.document.open().close();this._updateHash(this.iframe.location,fragment,options.replace)}}else{return this.location.assign(url)}if(options.trigger)this.loadUrl(fragment)},_updateHash:function(location,fragment,replace){if(replace){var href=location.href.replace(/(javascript:|#).*$/,"");location.replace(href+"#"+fragment)}else{location.hash="#"+fragment}}});Backbone.history=new History;var extend=function(protoProps,staticProps){var parent=this;var child;if(protoProps&&_.has(protoProps,"constructor")){child=protoProps.constructor}else{child=function(){return parent.apply(this,arguments)}}_.extend(child,parent,staticProps);var Surrogate=function(){this.constructor=child};Surrogate.prototype=parent.prototype;child.prototype=new Surrogate;if(protoProps)_.extend(child.prototype,protoProps);child.__super__=parent.prototype;return child};Model.extend=Collection.extend=Router.extend=View.extend=History.extend=extend;var urlError=function(){throw new Error('A "url" property or function must be specified')};var wrapError=function(model,options){var error=options.error;options.error=function(resp){if(error)error(model,resp,options);model.trigger("error",model,resp,options)}}}).call(this);

var Mustache;(function(exports){if(typeof module!=="undefined"&&module.exports){module.exports=exports}else if(typeof define==="function"){define(exports)}else{Mustache=exports}})(function(){var exports={};exports.name="mustache.js";exports.version="0.7.1";exports.tags=["{{","}}"];exports.Scanner=Scanner;exports.Context=Context;exports.Writer=Writer;var whiteRe=/\s*/;var spaceRe=/\s+/;var nonSpaceRe=/\S/;var eqRe=/\s*=/;var curlyRe=/\s*\}/;var tagRe=/#|\^|\/|>|\{|&|=|!/;function testRe(re,string){return RegExp.prototype.test.call(re,string)}function isWhitespace(string){return!testRe(nonSpaceRe,string)}var isArray=Array.isArray||function(obj){return Object.prototype.toString.call(obj)==="[object Array]"};function escapeRe(string){return string.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}var entityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function escapeHtml(string){return String(string).replace(/[&<>"'\/]/g,function(s){return entityMap[s]})}exports.escape=escapeHtml;function Scanner(string){this.string=string;this.tail=string;this.pos=0}Scanner.prototype.eos=function(){return this.tail===""};Scanner.prototype.scan=function(re){var match=this.tail.match(re);if(match&&match.index===0){this.tail=this.tail.substring(match[0].length);this.pos+=match[0].length;return match[0]}return""};Scanner.prototype.scanUntil=function(re){var match,pos=this.tail.search(re);switch(pos){case-1:match=this.tail;this.pos+=this.tail.length;this.tail="";break;case 0:match="";break;default:match=this.tail.substring(0,pos);this.tail=this.tail.substring(pos);this.pos+=pos}return match};function Context(view,parent){this.view=view;this.parent=parent;this.clearCache()}Context.make=function(view){return view instanceof Context?view:new Context(view)};Context.prototype.clearCache=function(){this._cache={}};Context.prototype.push=function(view){return new Context(view,this)};Context.prototype.lookup=function(name){var value=this._cache[name];if(!value){if(name==="."){value=this.view}else{var context=this;while(context){if(name.indexOf(".")>0){var names=name.split("."),i=0;value=context.view;while(value&&i<names.length){value=value[names[i++]]}}else{value=context.view[name]}if(value!=null){break}context=context.parent}}this._cache[name]=value}if(typeof value==="function"){value=value.call(this.view)}return value};function Writer(){this.clearCache()}Writer.prototype.clearCache=function(){this._cache={};this._partialCache={}};Writer.prototype.compile=function(template,tags){var fn=this._cache[template];if(!fn){var tokens=exports.parse(template,tags);fn=this._cache[template]=this.compileTokens(tokens,template)}return fn};Writer.prototype.compilePartial=function(name,template,tags){var fn=this.compile(template,tags);this._partialCache[name]=fn;return fn};Writer.prototype.compileTokens=function(tokens,template){var fn=compileTokens(tokens);var self=this;return function(view,partials){if(partials){if(typeof partials==="function"){self._loadPartial=partials}else{for(var name in partials){self.compilePartial(name,partials[name])}}}return fn(self,Context.make(view),template)}};Writer.prototype.render=function(template,view,partials){return this.compile(template)(view,partials)};Writer.prototype._section=function(name,context,text,callback){var value=context.lookup(name);switch(typeof value){case"object":if(isArray(value)){var buffer="";for(var i=0,len=value.length;i<len;++i){buffer+=callback(this,context.push(value[i]))}return buffer}return value?callback(this,context.push(value)):"";case"function":var self=this;var scopedRender=function(template){return self.render(template,context)};var result=value.call(context.view,text,scopedRender);return result!=null?result:"";default:if(value){return callback(this,context)}}return""};Writer.prototype._inverted=function(name,context,callback){var value=context.lookup(name);if(!value||isArray(value)&&value.length===0){return callback(this,context)}return""};Writer.prototype._partial=function(name,context){if(!(name in this._partialCache)&&this._loadPartial){this.compilePartial(name,this._loadPartial(name))}var fn=this._partialCache[name];return fn?fn(context):""};Writer.prototype._name=function(name,context){var value=context.lookup(name);if(typeof value==="function"){value=value.call(context.view)}return value==null?"":String(value)};Writer.prototype._escaped=function(name,context){return exports.escape(this._name(name,context))};function sectionBounds(token){var start=token[3];var end=start;var tokens;while((tokens=token[4])&&tokens.length){token=tokens[tokens.length-1];end=token[3]}return[start,end]}function compileTokens(tokens){var subRenders={};function subRender(i,tokens,template){if(!subRenders[i]){var fn=compileTokens(tokens);subRenders[i]=function(writer,context){return fn(writer,context,template)}}return subRenders[i]}return function(writer,context,template){var buffer="";var token,sectionText;for(var i=0,len=tokens.length;i<len;++i){token=tokens[i];switch(token[0]){case"#":sectionText=template.slice.apply(template,sectionBounds(token));buffer+=writer._section(token[1],context,sectionText,subRender(i,token[4],template));break;case"^":buffer+=writer._inverted(token[1],context,subRender(i,token[4],template));break;case">":buffer+=writer._partial(token[1],context);break;case"&":buffer+=writer._name(token[1],context);break;case"name":buffer+=writer._escaped(token[1],context);break;case"text":buffer+=token[1];break}}return buffer}}function nestTokens(tokens){var tree=[];var collector=tree;var sections=[];var token,section;for(var i=0;i<tokens.length;++i){token=tokens[i];switch(token[0]){case"#":case"^":token[4]=[];sections.push(token);collector.push(token);collector=token[4];break;case"/":if(sections.length===0){throw new Error("Unopened section: "+token[1])}section=sections.pop();if(section[1]!==token[1]){throw new Error("Unclosed section: "+section[1])}if(sections.length>0){collector=sections[sections.length-1][4]}else{collector=tree}break;default:collector.push(token)}}section=sections.pop();if(section){throw new Error("Unclosed section: "+section[1])}return tree}function squashTokens(tokens){var token,lastToken,squashedTokens=[];for(var i=0;i<tokens.length;++i){token=tokens[i];if(lastToken&&lastToken[0]==="text"&&token[0]==="text"){lastToken[1]+=token[1];lastToken[3]=token[3]}else{lastToken=token;squashedTokens.push(token)}}return squashedTokens}function escapeTags(tags){if(tags.length!==2){throw new Error("Invalid tags: "+tags.join(" "))}return[new RegExp(escapeRe(tags[0])+"\\s*"),new RegExp("\\s*"+escapeRe(tags[1]))]}exports.parse=function(template,tags){template=template||"";tags=tags||exports.tags;var tagRes=escapeTags(tags);var scanner=new Scanner(template);var tokens=[],spaces=[],hasTag=false,nonSpace=false;function stripSpace(){if(hasTag&&!nonSpace){while(spaces.length){tokens.splice(spaces.pop(),1)}}else{spaces=[]}hasTag=false;nonSpace=false}var start,type,value,chr;while(!scanner.eos()){start=scanner.pos;value=scanner.scanUntil(tagRes[0]);if(value){for(var i=0,len=value.length;i<len;++i){chr=value.charAt(i);if(isWhitespace(chr)){spaces.push(tokens.length)}else{nonSpace=true}tokens.push(["text",chr,start,start+1]);start+=1;if(chr==="\n"){stripSpace()}}}start=scanner.pos;if(!scanner.scan(tagRes[0])){break}hasTag=true;type=scanner.scan(tagRe)||"name";scanner.scan(whiteRe);if(type==="="){value=scanner.scanUntil(eqRe);scanner.scan(eqRe);scanner.scanUntil(tagRes[1])}else if(type==="{"){var closeRe=new RegExp("\\s*"+escapeRe("}"+tags[1]));value=scanner.scanUntil(closeRe);scanner.scan(curlyRe);scanner.scanUntil(tagRes[1]);type="&"}else{value=scanner.scanUntil(tagRes[1])}if(!scanner.scan(tagRes[1])){throw new Error("Unclosed tag at "+scanner.pos)}tokens.push([type,value,start,scanner.pos]);if(type==="name"||type==="{"||type==="&"){nonSpace=true}if(type==="="){tags=value.split(spaceRe);tagRes=escapeTags(tags)}}tokens=squashTokens(tokens);return nestTokens(tokens)};var _writer=new Writer;exports.clearCache=function(){return _writer.clearCache()};exports.compile=function(template,tags){return _writer.compile(template,tags)};exports.compilePartial=function(name,template,tags){return _writer.compilePartial(name,template,tags)};exports.compileTokens=function(tokens,template){return _writer.compileTokens(tokens,template)};exports.render=function(template,view,partials){return _writer.render(template,view,partials)};exports.to_html=function(template,view,partials,send){var result=exports.render(template,view,partials);if(typeof send==="function"){send(result)}else{return result}};return exports}());

!function($){"use strict";var Modal=function(content,options){this.options=options;this.$element=$(content).delegate('[data-dismiss="modal"]',"click.dismiss.modal",$.proxy(this.hide,this))};Modal.prototype={constructor:Modal,toggle:function(){return this[!this.isShown?"show":"hide"]()},show:function(){var that=this,e=$.Event("show");this.$element.trigger(e);if(this.isShown||e.isDefaultPrevented())return;$("body").addClass("modal-open");this.isShown=true;escape.call(this);backdrop.call(this,function(){var transition=$.support.transition&&that.$element.hasClass("fade");if(!that.$element.parent().length){that.$element.appendTo(document.body)}that.$element.show();if(transition){that.$element[0].offsetWidth}that.$element.addClass("in");transition?that.$element.one($.support.transition.end,function(){that.$element.trigger("shown")}):that.$element.trigger("shown")})},hide:function(e){e&&e.preventDefault();var that=this;e=$.Event("hide");this.$element.trigger(e);if(!this.isShown||e.isDefaultPrevented())return;this.isShown=false;$("body").removeClass("modal-open");escape.call(this);this.$element.removeClass("in");$.support.transition&&this.$element.hasClass("fade")?hideWithTransition.call(this):hideModal.call(this)}};function hideWithTransition(){var that=this,timeout=setTimeout(function(){that.$element.off($.support.transition.end);hideModal.call(that)},500);this.$element.one($.support.transition.end,function(){clearTimeout(timeout);hideModal.call(that)})}function hideModal(that){this.$element.hide().trigger("hidden");backdrop.call(this)}function backdrop(callback){var that=this,animate=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var doAnimate=$.support.transition&&animate;this.$backdrop=$('<div class="modal-backdrop '+animate+'" />').appendTo(document.body);if(this.options.backdrop!="static"){this.$backdrop.click($.proxy(this.hide,this))}if(doAnimate)this.$backdrop[0].offsetWidth;this.$backdrop.addClass("in");doAnimate?this.$backdrop.one($.support.transition.end,callback):callback()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");$.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one($.support.transition.end,$.proxy(removeBackdrop,this)):removeBackdrop.call(this)}else if(callback){callback()}}function removeBackdrop(){this.$backdrop.remove();this.$backdrop=null}function escape(){var that=this;if(this.isShown&&this.options.keyboard){$(document).on("keyup.dismiss.modal",function(e){e.which==27&&that.hide()})}else if(!this.isShown){$(document).off("keyup.dismiss.modal")}}$.fn.modal=function(option){return this.each(function(){var $this=$(this),data=$this.data("modal"),options=$.extend({},$.fn.modal.defaults,$this.data(),typeof option=="object"&&option);if(!data)$this.data("modal",data=new Modal(this,options));if(typeof option=="string")data[option]();else if(options.show)data.show()})};$.fn.modal.defaults={backdrop:true,keyboard:true,show:true};$.fn.modal.Constructor=Modal;$(function(){$("body").on("click.modal.data-api",'[data-toggle="modal"]',function(e){var $this=$(this),href,$target=$($this.attr("data-target")||(href=$this.attr("href"))&&href.replace(/.*(?=#[^\s]+$)/,"")),option=$target.data("modal")?"toggle":$.extend({},$target.data(),$this.data());e.preventDefault();$target.modal(option)})})}(window.jQuery);

$(window).unload(function(){window.__flash__removeCallback=function(instance,name){try{if(instance){instance[name]=null}}catch(flashEx){}}});var errmsg={};$(document).ready(function(){var $show_more_button=$("#prezi_text a.show-more");var $prezi_text_content=$("#prezi_text .prezi-text-content");if($("#prezi_tool_container").length)window.toolTab=new ToolTab("prezi_tool_container");if($('*[data-instantEdit="true"]').length>0)window.instantEdit=new InstantEdit($('*[data-instantEdit="true"]'));if($prezi_text_content.prop("scrollHeight")>$prezi_text_content.height()){$show_more_button.click(function(){$prezi_text_content.removeClass("clamped");$prezi_text_content.animate({"max-height":$prezi_text_content.prop("scrollHeight")},300);$show_more_button.hide(300)})}else{$show_more_button.hide()}var _data=Prezi.data,is_mobile=_data.mobile.toLowerCase();var getUrlParam=function(paramName){return(location.href.match(new RegExp("(&|\\?)"+paramName+"=([^&#]*)"))||new Array(3))[2]};var doEmbed=function(){var _wmode="opaque";if(window.ActiveXObject||"ActiveXObject"in window){_wmode="transparent"}var container=$("#pEmbed"),flashContainer='<div id="flashContainer" class="under container">$embedcode</div>',embedcode=EMBEDCODE.getHTML({wmode:_wmode,id:_data.oid,features:_data.features,disabled_features:_data.disabled_features,width:"100%",height:"100%",lock:0,autoplay:0,bgcolor:"ffffff",nofooter:true,autohide_ctrls:0,debug:typeof $("#debug")!=="undefined",webgl:getUrlParam("webgl"),webgl_viewer_version:getUrlParam("webgl_viewer_version"),webgl_no_autofallback:getUrlParam("webgl_no_autofallback"),webgl_debug_log:getUrlParam("webgl_debug_log"),url_hash:location.hash||"",token:_data.token});flashContainer=flashContainer.replace("$embedcode",embedcode);$(container).empty().html(flashContainer)};if(is_mobile=="true"){$("#edit-prezi").addClass("disabled").click(function(){alert("Sorry, editing is disabled on iPad.");return});$("#download-prezi").addClass("disabled").click(function(){alert("Sorry, downloading is disabled on iPad.");return});if(_data.viewerstate=="owner"){$("#pEmbed").html("<p id='ipad-message'>You can view your own prezis in the<br><a href='itms://itunes.com/app/prezi'>Prezi for iPad</a> app available for free from the App Store.<br>Editing prezis on iPad is currently not supported.<br><br><a href='itms://itunes.com/app/prezi'><img src='/assets/gfx/newsite/appstore-badge-beige.png'></a></p>")}else{$("#pEmbed").html("<p id='ipad-message'>Watching other`s prezis is currently not supported on the iPad,<br>however you can play your own prezis with the <br><a href='itms://itunes.com/app/prezi'>Prezi for iPad</a> app available for free from the App Store.<br><br><a href='itms://itunes.com/app/prezi'><img src='/assets/gfx/newsite/appstore-badge-beige.png'></a></p>")}}else{doEmbed()}$(document).delegate(".disabled","click",function(event){event.preventDefault();event.stopPropagation()});var dmcaurl="/dmca/"+_data.oid+"/";$("#report").attr("href",dmcaurl);var prezidetailsurl="/my/prezi/details/"+_data.oid+"/";var getFragment=function(data){var params=data.params,elem=data.elem,func=data.func,api="/api/getfragment/";$.ajax({type:"POST",url:api,data:params,success:function(data){if(func==="before"){$(elem).before(data)}else if(func==="replace"){$(elem).replaceWith(data)}else{$(elem).replaceWith(data)}},error:function(){createGeneralErrorOverlay()},dataType:"text"})};var listheight=$("#prezi-morelisting").height();$("#prezi-more").css({minHeight:listheight+"px"});$(document).delegate(".load-more","click",function(){var id=$(this).data("preziid"),url="/comment/json/?id="+id,span=$(this),tpl_val=$("#commentitem-tpl").val(),tpl=$.template(tpl_val);span.html("Please wait! Loading all comments...");if(!Prezi.comments){$.getJSON(url,function(data){$("#prezi-comments ul").html("");$.each(data.comments,function(index,elem){$("#prezi-comments ul").append(tpl,elem)})})}else{$("#prezi-comments ul").html("");$.each(Prezi.comments.comments,function(index,elem){$("#prezi-comments ul").append(tpl,elem)})}});var remotes=$(".remote").length;$(".remote").bind("loadRemote",function(){var element=$(this);var fragment=$(this).data("fragment");$.ajax({url:"/api/getfragment/",type:"POST",data:{fragment:fragment},success:function(data){element.replaceWith(data);if(remotes==1){$(document).trigger("remoteLoaded")}else{remotes-=1}},error:function(){console.error("remote load failed")}})});$(".remote").trigger("loadRemote");(function(){var url="/comment/json/?id="+Prezi.data.oid;$(document).bind("remoteLoaded",function(){var tpl_val=$("#commentitem-tpl").val(),tpl=$.template(tpl_val);var header=$("#prezi-comments h4"),counter=header.find(".comments-count"),form=$("#prezi-comments").find(".commentform");if(!Prezi.comments&&!header.data("comments")){Prezi.comments={};$.getJSON(url,function(data){Prezi.comments=data;var len=data.comments.length,more,comment_list;if(len>10){first_comments=$(data.comments).slice(0,9);more=$("<button/>",{class:"load-more btn",html:"Load more","data-preziid":Prezi.data.oid})}header.data("comments",len);counter.text(len);if(!$("#prezi-comments ul").length){comments_list=$("<ul/>");comments_list.addClass("simple-list");$.each(typeof first_comments!="undefined"?first_comments:data.comments,function(index,elem){$(comments_list).append(tpl,elem)})}if(more){more.appendTo(comments_list)}if(form.length>0){$(comments_list).insertAfter(form)}else{$(comments_list).insertAfter(header)}})}})})();$("#prezi-morelisting .thumbnail").lazy(function(){var elem=$(this),bg=elem.data("background");if(bg){elem.css("background","url("+bg+") repeat 50% 50%")}})});

var EditModule=function($){var block_title,block_wrapper_description,btn_save_description,inp_prezi_description,inp_prezi_title,ln_edit_description,ln_edit_title,presentation,prezi_description,prezi_description_text,prezi_title;function init(){block_title=$("#block_title");block_wrapper_description=$("#block_wrapper_description");btn_save_description=$("#btn_save_description");inp_prezi_description=$("#inp_prezi_description");inp_prezi_title=$("#inp_prezi_title");ln_edit_description=$("#ln_edit_description");ln_edit_title=$("#ln_edit_title");presentation=$("#presentation");prezi_description=$("#prezi_description");prezi_description_text=$("#prezi_description").find("span");prezi_title=$("#prezi_title");inp_prezi_title.keypress(function(e){if(e.which===13){handleSaveTitle()}else if(e.which===27){handleCancelTitle()}});inp_prezi_description.keypress(function(e){if(e.which===13){handleSaveDescription()}else if(e.which===27){handleCancelDescription()}});$(document.body).delegate("*","click",function(event){var currentTarget=$(event.currentTarget),target_id=currentTarget.attr("id");if(target_id=="ln_edit_description"||target_id=="prezi_description_txt"&&isEdit()){event.preventDefault();handleEditDescription(currentTarget)}if(target_id=="inp_view_together_url"){$(this).select()}if(target_id=="btn_save_description"){event.preventDefault();handleSaveDescription()}if(target_id=="btn_cancel_description"){event.preventDefault();handleCancelDescription()}if(target_id=="ln_edit_title"||target_id=="prezi_title"&&isEdit()){event.preventDefault();handleTitleEdit()}if(target_id=="btn_save_title"){event.preventDefault();handleSaveTitle()}if(target_id=="btn_cancel_title"){event.preventDefault();handleCancelTitle()}if(target_id=="ln_open_description"){event.preventDefault();handleToggleDescription()}}).delegate(".editable","mouseover",function(event){var currentTarget=$(event.currentTarget),target_id=currentTarget.attr("id");if(target_id=="block_title"){event.preventDefault();$(ln_edit_title).show()}if(target_id=="prezi_description"){event.preventDefault();$(ln_edit_description).show()}if(isEdit())currentTarget.find("span").css({"background-color":"#F7EDBA",cursor:"text"})}).delegate(".editable","mouseout",function(event){var currentTarget=$(event.currentTarget),target_id=currentTarget.attr("id");if(target_id=="block_title"){event.preventDefault();$(ln_edit_title).hide()}if(target_id=="prezi_description"){event.preventDefault();$(ln_edit_description).hide()}if(isEdit())currentTarget.find("span").css({"background-color":"white"})})}function handleToggleDescription(){$(prezi_description).toggleClass("open")}function handleEditDescription(){$(prezi_description).addClass("editing");inp_prezi_description.show();btn_save_description.show();inp_prezi_description.focus();inp_prezi_description.select()}function handleSaveDescription(){var api="/api/presentations/edit/",_data={id:Prezi.data.oid,field:"description",value:$(inp_prezi_description).val()};$.ajax({type:"POST",url:api,data:_data,success:function(data){if(data==="OK"){var newval=_data.value;if(newval.trim().length===0)$(prezi_description_text).text("No description");else $(prezi_description_text).text(newval);if(newval.length>69){$(block_wrapper_description).addClass("description_long")}else{$(block_wrapper_description).removeClass("description_long")}}else{var err={};if(data==="ERROR: NO PERMISSION"||data==="ERROR: FORBIDDEN"){err={title:"Permission error",message:"You do not have the permission to do this operation."}}else{createGeneralErrorOverlay()}createErrorOverlay(err)}},error:function(){createGeneralErrorOverlay()},dataType:"text"});$(prezi_description).removeClass("editing")}function handleSaveTitle(){var title=$(inp_prezi_title),newtitle=$(title).val(),prezi=Prezi.data.oid,api="/api/presentations/edit/";if(newtitle==="")return;$.ajax({type:"POST",url:api,data:{field:"title",id:prezi,value:newtitle},success:function(data){if(data==="OK"){prezi_title.text(newtitle);$(block_title).removeClass("editing")}else{var err={};if(data==="ERROR: NO PERMISSION"||data==="ERROR: FORBIDDEN"){err={title:"Permission error",message:"You do not have the permission to do this operation."}}else{createGeneralErrorOverlay()}createErrorOverlay(err)}},error:function(){createGeneralErrorOverlay()},dataType:"text"})}function handleCancelDescription(){$(prezi_description).removeClass("editing")}function handleCancelTitle(){$(block_title).removeClass("editing")}function handleTitleEdit(){$(block_title).addClass("editing");inp_prezi_title.focus();inp_prezi_title.select()}function isEdit(){return ln_edit_description.is("*")}return{init:init}}(jQuery);$(function(){EditModule.init()});

$(function(){var block_overlay=$("#overlay"),block_overlay_wrapper=$("#overlay-wrapper"),tpl_overlay=$("#overlay-tpl"),body=$(document.body);var create=function(data){if(!data){return}tpl_overlay.remove();var tpl_body=$(data.template).val();var tpl_data={title:data.title,body:tpl_body,foot:"",cellux:data.cellux,divwidth:data.width,type:data.type||"wide"};var tpl=$(tpl_overlay).val();$(body).append($.template(tpl),tpl_data);if(!$.browser.mozilla){$(body).css({overflow:"hidden"})}$(block_overlay).show();$(block_overlay_wrapper).css({top:$(window).scrollTop()+50+"px"})};$(document).delegate("body","keydown",function(e){if(e.which==27&&$("#overlay").length){closeOverlay()}});return{create:create}});escapeHtml=function(stringToHtmlEscape){return $("<div/>").text(stringToHtmlEscape).html()};createOverlay=function(data){if(!data)return;$("#overlay").remove();var tplbody=$(data.template).val(),body=$(document.body),_data={title:data.title,body:tplbody,foot:"",cellux:data.cellux,divwidth:data.width,type:data.type||"wide"},tpl=$("#overlay-tpl").val();if(!tpl){alert(gettext("Something went wrong. Please reload the page and try again!"));return}$(body).append($.template(tpl),_data);if(!$.browser.mozilla){$(body).css({overflow:"hidden"})}$("#overlay").show();$("#overlay-wrapper").css({top:$(window).scrollTop()+50+"px"});if(data.callback){data.callback()}};closeOverlay=function(){var body=$(document.body);if(!$.browser.mozilla){$(body).css({overflowY:"scroll"})}$("#overlay").remove();if(window._xhr){window.clearInterval(periodicalTimer);_xhr.abort()}};createErrorOverlay=function(data){closeOverlay();createOverlay({template:$("#erroroverlaybody-tpl"),title:data.title||gettext("Error"),cellux:"red",width:data.width||60,type:data.type||"thin"});if(data.message){$(".errmsg").html(data.message)}if(data.extramsg){$(".extramsg").html(data.extramsg)}var format=$("#download-btn-zip").hasClass("disabled")?"zip":"pez";$.post("/desktop/log_event/download_prezi/",{format:format,source:"tab_unsuccessfulconversion",oid:Prezi.data.oid})};createGeneralErrorOverlay=function(){closeOverlay();var communityAnchor="<a href='https://getsatisfaction.com/prezi'>Community Forum</a>";var extraMsg=gettext("Sorry for the inconvenience. Please check your internet connection.")+"<br />"+interpolate(gettext("If the problem persists you can find support at %(community_anchor)s."),{community_anchor:communityAnchor},true)+"</p>";createErrorOverlay({title:gettext("Error"),message:gettext("An error occurred during processing your request."),extramsg:extraMsg,width:85})};createDeleteConfirmOverlay=function(){createOverlay({template:$("#deleteoverlaybody-tpl"),title:gettext("Delete prezi"),cellux:"red",width:66,type:"thin"})};createDownloadOverlay=function(){createOverlay({template:$("#downloadoverlaybody-tpl"),title:gettext("Choose a format to download"),cellux:"green-wide",width:36,type:"thin"})};createDownloadFinalOverlay=function(status_token,proxy,job_uuid){createOverlay({template:$("#downloadfinishedoverlaybody-tpl"),title:gettext("Packaging"),cellux:"green-wide",width:66,type:"wide"});var periodical_tried=0,$wrapper=$("#download-wrapper > p"),$wrapperText=$("#download-wrapper > p").text(),$progressbar=$("#download-wrapper > img"),$overlayTitle=$(".overlay-title-text");var periodicalUpdate=function(){periodical_tried+=1;if(proxy===true){window._xhr=$.ajax({type:"POST",url:"/backend/export/status/"+job_uuid+"/",data:{token_url:status_token.url,token_method:status_token.method,token_header:status_token.header},success:function(response){if(response.success){if(response.status==5){if(response.url!==""){$overlayTitle.text(gettext("Your prezi is ready"));$progressbar.hide();var fmts=gettext("Your downloadable prezi has been created. Please <a %(aattribs)s>click this link to download</a> the file.");var aAttribs='id="download_link" target="blank" href="'+escapeHtml(response.url)+'"';$wrapper.html(interpolate(fmts,{aattribs:aAttribs},true));window.clearInterval(periodicalTimer);var format=$("#download-btn-zip").hasClass("disabled")?"zip":"pez";$.post("/desktop/log_event/download_prezi/",{format:format,source:"tab_successfulconversion",oid:Prezi.data.oid});$("#download_link").on("click",function(e){$.post("/desktop/log_event/download_prezi/",{format:format,source:"tab_clickondownloadurl",oid:Prezi.data.oid})})}}else if(response.status==6){var communityUrl="https://getsatisfaction.com/prezi";var aAttribs='target="blank" href="'+communityUrl+'"';var messageFmts=gettext("Please try again later. If you keep running into this error, please visit our <a %(aattribs)s'>Community Forum</a>.");createErrorOverlay({title:gettext("Error creating downloadable prezi."),message:interpolate(messageFmts,{aattribs:aAttribs},true),width:25});window.clearInterval(periodicalTimer)}}else{createErrorOverlay({title:"Error creating downloadable prezi.",message:escapeHtml(response.error),width:25});window.clearInterval(periodicalTimer)}},error:function(response){closeOverlay();createGeneralErrorOverlay();window.clearInterval(periodicalTimer)},dataType:"json"})}else{window._xhr=$.ajax({type:"POST",url:status_token.url,beforeSend:function(xhr){xhr.setRequestHeader("Authorization",status_token.header)},success:function(response){if(response.success){if(response.status==5){if(response.url!==""){$overlayTitle.text(gettext("Your prezi is ready"));$progressbar.hide();var fmts=gettext("Your downloadable prezi has been created. Please <a %(aattribs)s>click this link to download</a> the file.");var aAttribs='id="download_link" target="blank" href="'+escapeHtml(response.url)+'"';$wrapper.html(interpolate(fmts,{aattribs:aAttribs},true));window.clearInterval(periodicalTimer);var format=$("#download-btn-zip").hasClass("disabled")?"zip":"pez";$.post("/desktop/log_event/download_prezi/",{format:format,source:"tab_successfulconversion",oid:Prezi.data.oid});$("#download_link").on("click",function(e){$.post("/desktop/log_event/download_prezi/",{format:format,source:"tab_clickondownloadurl",oid:Prezi.data.oid})})}}else if(response.status==6){var communityUrl="https://getsatisfaction.com/prezi";var aAttribs='target="blank" href="'+communityUrl+'"';var messageFmts=gettext("Please try again later. If you keep running into this error, please visit our <a %(aattribs)s'>Community Forum</a>.");createErrorOverlay({title:gettext("Error creating downloadable prezi."),message:interpolate(messageFmts,{aattribs:aAttribs},true),width:25});window.clearInterval(periodicalTimer)}}else{createErrorOverlay({title:gettext("Error creating downloadable prezi."),message:escapeHtml(response.error),width:25});window.clearInterval(periodicalTimer)}},error:function(response){closeOverlay();createGeneralErrorOverlay();window.clearInterval(periodicalTimer)},dataType:"json",xhrFields:{withCredentials:true}})}};window.periodicalTimer=window.setInterval(periodicalUpdate,5e3)};createLikeOverlay=function(){createOverlay({template:$("#likeoverlaybody-tpl"),title:gettext("Share your Prezi likes on Facebook?"),cellux:"green-wide",width:36,type:"thin"})};$(".overlay-close").live("click",function(){closeOverlay()});

function userNeedsLikePopup(){if(!loggedin||Prezi.data.can_publish_to_fb==1){return false}var likes_since_last_deny=parseInt(Prezi.data.likes_since_last_time_denied_publish_actions,10);return isNaN(likes_since_last_deny)||likes_since_last_deny>4}$(function(){var block_toolbar=$("#toolbar"),body=$(document.body),loggedin=false,clip=null;if(Prezi.data.viewerstate!="anon"){loggedin=true}if(window.toolTab){toolTab.registerButton($("#btn_share"),"share");toolTab.registerButton($("#ln_edit_together"),"share","edit");toolTab.registerButton($("#ln_view_together"),"view_together");if(!$("#ln_privacy").hasClass("disabled")){toolTab.registerButton($("#ln_privacy"),"privacy")}else{$("#ln_privacy").tooltip({placement:"bottom",delay:{show:0,hide:500}})}}else{$("#prezi-panel").toggle()}$(body).delegate("a","click",function(event){var currentTarget=$(event.currentTarget),target_id=currentTarget.attr("id");if(currentTarget.hasClass("disabled")){event.preventDefault();return}if(target_id=="ln_privacy"){event.preventDefault();if(!window.toolTab)$("#prezi-panel").toggle()}if(target_id=="ln_delete"){event.preventDefault();if(!window.toolTab||!window.toolTab.isRegistered($("#ln_delete")))createDeleteConfirmOverlay()}if(target_id=="ln_download"){event.preventDefault()}if(target_id=="download-btn"){event.preventDefault();var format=$("input[name=download-format]:checked").val();$(this).addClass("disabled");var data={format:format};$.post("/desktop/log_event/download_prezi/",{format:format,source:"radio_startdownload",oid:Prezi.data.oid});$.post("/desktop/log_event/download_prezi/",{format:format,source:"radio",oid:Prezi.data.oid})}if(target_id=="download-btn-pez"){event.preventDefault();$(this).addClass("disabled");var data={format:"pez"};handleDownload(data);$.post("/desktop/log_event/download_prezi/",{format:"pez",source:"tab_startdownload",oid:Prezi.data.oid});$.post("/desktop/log_event/download_prezi/",{format:"pez",source:"tab",oid:Prezi.data.oid})}if(target_id=="download-btn-zip"){event.preventDefault();$(this).addClass("disabled");var data={format:"zip"};handleDownload(data);$.post("/desktop/log_event/download_prezi/",{format:"zip",source:"tab_startdownload",oid:Prezi.data.oid});$.post("/desktop/log_event/download_prezi/",{format:"zip",source:"tab",oid:Prezi.data.oid})}if(target_id=="download_desktop"){if(navigator.userAgent.match(/Mac/gi)){$.post("/desktop/log_event/download_desktop/",{platform:"macdmg",source:"landing"})}else if(navigator.userAgent.match(/Win/gi)){$.post("/desktop/log_event/download_desktop/",{platform:"winexe",source:"landing"})}else{$(this).addClass("disabled")}}if(target_id=="ln_save"){event.preventDefault();$(this).addClass("disabled");handleDuplicate()}if(target_id=="confirmdelete"){event.preventDefault();$(this).addClass("disabled");handleDelete()}if(target_id=="canceldelete"){event.preventDefault();closeOverlay()}if(target_id=="ln_view_together"){event.preventDefault();handleViewTogether()}});function handleDelete(){var api="/api/v2/presentation/delete/"+Prezi.data.oid+"/?csrftoken="+$.cookie("csrftoken");$.ajax({type:"GET",url:api,success:function(data){location.href=Prezi.data.redirect_back_url},statusCode:{403:function(data){createErrorOverlay({title:gettext("Permission error"),message:gettext("You do not have the permission to do this operation.")})}},error:function(data){createGeneralErrorOverlay()},dataType:"text"})}function handleSaveAs(){var new_title="Copy of "+Prezi.data.permissions.title;$.ajax({url:"/api/presentations/reuse/",type:"POST",dataType:"json",data:{id:Prezi.data.oid,saveas:new_title},success:function(data){},error:function(a,b,c){alert("oops")}})}function handleDuplicate(){var api="/api/presentations/duplicate/",title="Copy of "+Prezi.data.permissions.title;$.ajax({url:api,type:"POST",dataType:"json",data:{id:Prezi.data.oid,title:title},success:function(data){if(data[0].oid){location.href="/dashboard/"}else{if(data==="ERROR: FORBIDDEN"){createErrorOverlay({title:"Permission error",message:"You are not allowed to save a copy of this presentation.",width:85})}}},error:function(a,b,c){createGeneralErrorOverlay()}})}function handleDownload(data,proxy){var oid=Prezi.data.oid,format=data.format;var url="/backend/export/"+oid+"/"+format+"/";$.ajax({type:"POST",url:url,data:{},success:function(response){if(response.success){var start_token=response.conversion_token;$.ajax({type:start_token.method,url:start_token.url,beforeSend:function(xhr){xhr.setRequestHeader("Authorization",start_token.header)},success:function(start_response){closeOverlay();createDownloadFinalOverlay(start_response.conversion_status_token)},error:function(start_response){$.ajax({type:"POST",url:url+"proxy/",success:function(fallback_response){if(fallback_response.success){closeOverlay();createDownloadFinalOverlay(fallback_response.conversion_status_token,true,fallback_response.job_uuid)}else{createErrorOverlay({title:"Error creating downloadable prezi.",message:response.error,width:25})}},error:function(fallback_response){closeOverlay();createGeneralErrorOverlay()},dataType:"json"})},dataType:"json",xhrFields:{withCredentials:true}})}else{createErrorOverlay({title:"Error creating downloadable prezi.",message:response.error,width:25})}},error:function(response){closeOverlay();createGeneralErrorOverlay()},complete:function(){$("#download-btn").removeClass("disabled")},dataType:"json"})}function handleViewTogether(){var url="/api/presentations/"+Prezi.data.oid+"/present/url/";$.ajax({type:"GET",url:url,success:function(data){var input=$("input[name=view_together_lnk]");if(window.toolTab){setTimeout(function(){$("#btn_copy_view_together").copy_button("input[name='view_together_lnk']")},500)}else{createOverlay({template:$("#viewtogether-tpl"),title:"View together",cellux:"green",width:64,type:"thin",callback:function(){$("#btn_copy_view_together").copy_button("input[name='view_together_lnk']")}})}var input=$("input[name=view_together_lnk]");input.val(data.url).select().focus();$.track.event("Prezi",Prezi.data.oid,"share to view together")},error:function(data){if(data.status==403){$(".view_together").empty().css("background-color","#F2DEDE").text(gettext("You have no permissions to present this Prezi online"))}}})}$(body).delegate("#btn_start_presenting","click",function(){document.location=$("input[name=view_together_lnk]").val()})});

$(function(){var block_presentation=$("#presentation"),block_privacy=$("#block_privacy"),block_permission_panel=$("#prezi-panel"),btn_privacy_toggle=$("#btn_privacy_toggle"),btn_privacy_caption=$("#ln_privacy span"),btn_privacy_icon=$("#ln_privacy i"),txt_privacy_state=$(btn_privacy_toggle),prezi=Prezi.data,perm=prezi.permissions,that=this;$(block_privacy).delegate("span.select","click",function(event){block_presentation.toggleClass("open")});$(block_permission_panel).delegate("input","click",function(event){var currentTarget=$(event.currentTarget),target_id=currentTarget.attr("id");if(target_id=="prezi-private"){event.preventDefault();handleSetPrivate(currentTarget)}if(target_id=="prezi-public"){event.preventDefault();handleSetPublic(currentTarget)}if(target_id=="prezi-pubshare"){event.preventDefault();handleSetReusable(currentTarget)}});var handleSetPublic=function(radio){setPreziPrivacy({state:"public",radio:radio})};var handleSetPrivate=function(radio){setPreziPrivacy({state:"private",radio:radio})};var handleSetReusable=function(radio){setPreziPrivacy({state:"reusable",radio:radio})};var setPreziPrivacy=function(data){var prezi=Prezi.data,perm=prezi.permissions,state=data.state,radio=data.radio,api="/api/presentations/privacy/";$.ajax({type:"POST",url:api,data:{id:Prezi.data.oid,value:state},success:function(){$(radio).attr("checked","true");btn_privacy_caption.text(" "+$(radio).attr("data-caption"));btn_privacy_icon.attr("class","icon-"+$(radio).attr("data-icon"));switch(state){case"private":prezi.reusable=0;prezi.prezistate="private";prezi.permissions["public"]=0;$(txt_privacy_state).text("Private");break;case"public":prezi.reusable=0;prezi.prezistate="public";prezi.permissions["public"]=1;$(txt_privacy_state).text("Public");break;case"reusable":prezi.reusable=1;prezi.prezistate="reusable";prezi.permissions["public"]=1;$(txt_privacy_state).text("Allow copy");break;default:throw"bad state"}setPermissionToggler()},error:function(response){if(response.status==403){createErrorOverlay({title:"Permission error",message:"You do not have the permission to do this operation."})}else{createGeneralErrorOverlay()}}})};var setPermissionToggler=function(){var prezistate=Prezi.data.prezistate;block_privacy[0].className=prezistate};var setPermissionPanel=function(){var prezi=Prezi.data;var perm=prezi.permissions;var controls=$("#prezi-panel-public input");var input,parent;if(prezi.viewerstate==="anon"||prezi.viewerstate==="foreign"){return}if(prezi.viewerstate==="owner"){if(!perm.can_publish){input=$("#prezi-private");parent=$(input).parents("li");var control=$(parent).find(".controls");var explanation=$(parent).find(".explanation");$(input).attr("disabled",true);$(control).addClass("disabled");$(explanation).html('<p>Please <a href="/pricing/">upgrade</a> to access this option.</p>')}if(!perm.can_set_reuse){input=$("#prezi-pubshare");parent=$(input).parents("li");$(input).attr("disabled",true);$(parent).addClass("disabled")}}if(prezi.viewerstate==="collab"){if(!perm.can_publish){input=$("#prezi-private");parent=$(input).parents("li");$(input).attr("disabled",true);$(parent).addClass("disabled")}if(!perm.can_set_reuse){input=$("#prezi-pubshare");parent=$(input).parents("li");$(input).attr("disabled",true);$(parent).addClass("disabled")}}};setPermissionPanel()});

$(function(){var prevComment="";$("#prezi-comments").delegate("a, button","click",function(event){var targetElem=$(event.currentTarget);if(targetElem.hasClass("comment-submit")){event.preventDefault();handleCommentSubmit(targetElem)}if(targetElem.hasClass("comment-delete")){event.preventDefault();handleCommentDelete(targetElem)}if(targetElem.hasClass("reply")){event.preventDefault();handleCommentReply(targetElem)}if(targetElem.hasClass("comment-delete")){event.preventDefault();handleCommentDelete(targetElem)}if(targetElem.hasClass("comment-delete-cancel")){event.preventDefault();handleCommentDeleteCancel(targetElem)}if(targetElem.hasClass("comment-delete-confirmed")){event.preventDefault();handleCommentDeleteConfirmed(targetElem)}if(targetElem.hasClass("inlineform-close")){event.preventDefault();hideReplyForm()}}).delegate("textarea[name='comment']","keyup focus",function(event){var targetElem=$(event.currentTarget);if(event.type=="keyup"){event.preventDefault();handleCommentKeyup(event)}if(event.type=="focusin"){event.preventDefault();handleFocus(targetElem)}});function handleFocus(textarea){var text=$(textarea).val(),defaultcomment=/Add your/g,defaultreply=/Reply to/g;if(defaultcomment.test(text)||defaultreply.test(text)){$(textarea).val("")}}function handleCommentSubmit(button){if(!$(button).hasClass("disabled")){var form=$(button).parents("form"),txt=$(form).find("textarea"),text=$(txt).val(),defaultmsg=/Reply to/g;if($(".load-more").length){$(".load-more").trigger("click")}if(defaultmsg.test(text)){$(txt)[0].focus()}commentJson(form)}}function handleCommentDelete(button){hideCommentDeleteConfirmation();hideReplyForm();var item=$(button).parents(".comment");item.addClass("comment-delete-confirm");$(item).append($.template($("#deleteconfirmation-tpl").val()),{})}function handleCommentReply(button){hideCommentDeleteConfirmation();hideReplyForm();var prezi=Prezi.data.oid,reply=button[0].id.split("_").pop(),user=$(button).parent().siblings("cite").text(),item=$(button).parents(".comment"),data={prezi:prezi,reply:reply};item.addClass("replying");$(item).append($.template($("#replyform-tpl").val()),data)}function hideReplyForm(){$(".commentform.inlineform").remove();$(".replying").removeClass("replying")}function hideCommentDeleteConfirmation(){$(".delete-confirmation").remove();$(".comment-delete-confirm").removeClass("comment-delete-confirm")}function handleCommentDeleteCancel(){hideCommentDeleteConfirmation()}function handleCommentDeleteConfirmed(button){var comments_num=$("#prezi-comments h4").data("comments");var item=$(button).parents(".comment"),id=item.find(".reply").attr("id").split("_").pop();$.ajax({url:"/comment/delete/",type:"POST",dataType:"json",data:{id:id},success:function(data){if(data["success"]){$("#prezi-comments h4").data("comments",comments_num-data["deleted_comments"].length);var deleted_comments=data["deleted_comments"],len=deleted_comments.length;for(i=0;i<len;i+=1){item="#comment_"+deleted_comments[i];$(item).find(".comment").replaceWith('<div class="comment"><p>Comment removed</p></div>');$(item).animate({opacity:"0"},1e3,function(stuff){$(this).remove();recalcCommentsCount()})}recalcCommentsCount();$.track.event("Prezi",Prezi.data.oid,"Comment deleted")}else{createErrorOverlay({title:"Delete comment",message:data["message"]})}},error:function(a,b,c){createGeneralErrorOverlay()}});hideCommentDeleteConfirmation()}function handleCommentKeyup(event){var elem=$(event.target),$form=$(event.target).closest("form"),submitBtn=$form.find(".comment-submit"),feedBackElem=$form.find("#comment_charsleft"),currentLength=elem[0].textLength,maxLength=300,charsLeft=maxLength-currentLength;$(feedBackElem).text(currentLength);if(currentLength<maxLength){$(feedBackElem).css({color:"green"});$(submitBtn).removeClass("disabled")}if(currentLength>maxLength-10){$(feedBackElem).css({color:"brown"});$(submitBtn).removeClass("disabled")}if(currentLength>maxLength){$(feedBackElem).css({color:"red"});$(submitBtn).addClass("disabled")}}function insertComment(data){var comments_num=$("#prezi-comments h4").data("comments");var cclass="",replyid=data.replied_to;if(replyid){cclass="comment-reply"}var tpl=$("#commentitem-tpl").val(),tpl=$.template(tpl),data={id:data.id,comment:data.text,age:data.age,user:data.user,cclass:cclass},item="#comment_"+replyid,replieditem=$(item);var prezi=Prezi.data;if(!replieditem.length){var commentlist=$("#prezi-comments ul");$(commentlist).prepend(tpl,data)}else{$(replieditem).after(tpl,data)}$("#prezi-comments h4").data("comments",comments_num+1);hideReplyForm();recalcCommentsCount()}function recalcCommentsCount(){var len=$("#prezi-comments h4").data("comments"),heading=$("#prezi-comments h4"),counter=heading.find(".comments-count");counter.text(len)}function commentJson(form){if(!loggedin||!form){return}var comment=$(form).find("#id_comment").val(),replied_to=$(form).find("#id_replied_to").val(),submit=$(form).find(".comment-submit"),feedBackElem=$("#comment_charsleft"),warningElem="<p class='alert alert-error' id='warning'>You just sent a comment with the same "+"text. <button data-dismiss='alert' class='close' type='button'>\xd7</button></p>",origSubmitText=gettext("Comment");if(!comment||comment==="")return;$("#warning").remove();if(comment===prevComment){$(form).prepend(warningElem);return}var api="/comment/json/";$.ajax({type:"POST",url:api,data:$(form).serialize(),beforeSend:function(){$(form).find("#id_comment").val("");$(submit).text("Sending comment ...");$(submit).addClass("disabled")},complete:function(){$(submit).text(origSubmitText);$(submit).removeClass("disabled")},success:function(data){commentCallback(data);$(feedBackElem).text("0")},error:function(data){$(submit).text(origSubmitText);$(submit).removeClass("disabled");createGeneralErrorOverlay()},dataType:"json"})}function commentCallback(data,textStatus){var feedback={};if(data.comment==="success"&&typeof data.content!=="undefined"){with(data.content){var prezi_id=Prezi.data.oid;if(text===""){$.track.event("Prezi",Prezi.data.oid,"New like");return}else if(text!==""&&replied_to===null){$.track.event("Prezi",Prezi.data.oid,"New comment");prevComment=text}else{$.track.event("Prezi",Prezi.data.oid,"New reply comment");prevComment=text}insertComment(data.content)}}else if(data.comment==="notloggedin"){}else if(data.comment==="alreadyremoved"){feedback={width:"85",message:"The comment you replied to is already deleted.",extramsg:"Please reload the page to see the current comments."};createErrorOverlay(feedback)}else if(data.errors){feedback={width:"85",message:"Sorry, the comment you submitted is too long.",extramsg:data.errors[0].comment};createErrorOverlay(feedback)}else{createGeneralErrorOverlay()}}});

$(function(){$(".prezi-author").click(function(){$.track.syncEvent("LandingPage","preziAuthorLink",window.Prezi.data.oid)});$("#btn_copy").click(function(){$.track.syncEvent("LandingPage","copyButton",window.Prezi.data.oid)});$("#btn_share").click(function(){$.track.event("LandingPage","shareButton",window.Prezi.data.oid)});$("body").delegate("#overlay .overlay-close","click",function(){$.track.event("LandingPage","shareOverlayClose",window.Prezi.data.oid)});$("body").delegate("#overlay #ln_tab_share_view","click",function(){$.track.event("LandingPage","shareViewTabSelect",window.Prezi.data.oid)});$("body").delegate("#overlay #ln_tab_share_edit","click",function(){$.track.event("LandingPage","shareEditTabSelect",window.Prezi.data.oid)});$("body").delegate("#overlay #btn_copy_share_view","click",function(){$.track.event("LandingPage","buttonCopyLink",window.Prezi.data.oid)});$("body").delegate("#overlay #ln_share_view_email","click",function(){$.track.event("LandingPage","shareEmailButton",window.Prezi.data.oid)});$("body").delegate("#overlay #ln_send_view_email","click",function(){$.track.event("LandingPage","sendEmailButton",window.Prezi.data.oid)});$("body").delegate("#overlay #ln_share_view_facebook","click",function(){$.track.event("LandingPage","shareFacebookButton",window.Prezi.data.oid)});$("body").delegate("#overlay #ln_share_view_twitter","click",function(){$.track.event("LandingPage","shareTwitterButton",window.Prezi.data.oid)});$("body").delegate("#overlay #ln_share_view_group","click",function(){$.track.event("LandingPage","shareGroupButton",window.Prezi.data.oid)});$("body").delegate("#overlay #ln_share_view_group","click",function(){$.track.event("LandingPage","shareEmbedButton",window.Prezi.data.oid)});$("body").delegate("#overlay #ln_copy_embedcode","click",function(){$.track.event("LandingPage","shareCopyEmbedButton",window.Prezi.data.oid)});$("body").delegate("#overlay #btn_copy_share_edit","click",function(){$.track.event("LandingPage","buttonEditLinkCopy",window.Prezi.data.oid)});$("body").delegate("#overlay #ln_share_edit_email","click",function(){$.track.event("LandingPage","shareEditEmailButton",window.Prezi.data.oid)});$("body").delegate("#overlay #ln_send_edit_email","click",function(){$.track.event("LandingPage","sendEditEmailButton",window.Prezi.data.oid)});$("body").delegate("#overlay #ln_share_edit_group","click",function(){$.track.event("LandingPage","shareEditGroupButton",window.Prezi.data.oid)});$("#btn_like").click(function(){$.track.event("LandingPage","buttonOpenGraphLike",window.Prezi.data.oid)});$(".ipad-friendly-badge").click(function(){$.track.event("LandingPage","ipadLink",window.Prezi.data.oid)});$(".load-more").click(function(){$.track.event("LandingPage","loadMoreComments",window.Prezi.data.oid)});$(".comment-submit").click(function(){$.track.event("LandingPage","submitCommentButton",window.Prezi.data.oid)});$("#btn_privacy_toggle").click(function(){$.track.event("LandingPageOwn","buttonPrivacyToggle",window.Prezi.data.oid)});$("#ln_edit").click(function(){$.track.syncEvent("LandingPageOwn","buttonEditPrezi",window.Prezi.data.oid)});$("#ln_edit_together").click(function(){$.track.event("LandingPageOwn","buttonEditTogether",window.Prezi.data.oid)});$("#ln_view_together").click(function(){$.track.event("LandingPageOwn","buttonViewTogether",window.Prezi.data.oid)});$("#ln_download").click(function(){$.track.event("LandingPageOwn","buttonDownload",window.Prezi.data.oid)});$("#ln_save").click(function(){$.track.syncEvent("LandingPageOwn","buttonSaveCopy",window.Prezi.data.oid)});$("#ln_delete").click(function(){$.track.event("LandingPageOwn","buttonDelete",window.Prezi.data.oid)})});

$(function(){var body=$(document.body),loggedin=false,url="/"+Prezi.data.oid+"/"+Prezi.data.slug+"/";var privateCopyDisabledButton=$("#btn_copy_disabled");if(privateCopyDisabledButton){privateCopyDisabledButton.tooltip()}function userNeedsLikePopup(){if(!loggedin||Prezi.data.can_publish_to_fb==1){return false}var likes_since_last_deny=parseInt(Prezi.data.likes_since_last_time_denied_publish_actions);return isNaN(likes_since_last_deny)||likes_since_last_deny>4}function handleLikeFBNoThanks(button){$.log({msg:["like_popup","landing_page","deny",Prezi.data.oid,Prezi.data.userid].join(" ")});toolTab.deactivate();$.ajax({url:"/api/opengraph/reset-denial-counter/",type:"POST",dataType:"json",success:function(data){Prezi.data.likes_since_last_time_denied_publish_actions=0}});return false}function handleLikeFBOK(button){$.log({msg:["like_popup","landing_page","allow",Prezi.data.oid,Prezi.data.userid].join(" "),log_callback:function(){var $target=$(button);var form=$target.parents("form:first");form.find('input[name="next"]').val("/"+Prezi.data.oid+"/og-like/");form.submit()}})}$(body).delegate("a","click",function(event){var currentTarget=$(event.currentTarget),target_id=currentTarget.attr("id");if(Prezi.data.viewerstate!="anon"){loggedin=true}if(target_id=="ln_edit_together"){event.preventDefault();handleShare(currentTarget,"edit");Prezi.share.manageEditors()}if(target_id=="btn_like"){event.preventDefault();if(!loggedin){return_after_login(url);return}else{handleLike(currentTarget);if(userNeedsLikePopup()&&(!window.toolTab||!window.toolTab.isRegistered($("#btn_like")))){createLikeOverlay()}}}if(target_id=="btn_liked"){event.preventDefault();if(!loggedin){return_after_login(url);return}else{window.toolTab.deactivate();handleLiked(currentTarget)}}if(target_id=="fb-connect-like-no-btn"){event.preventDefault();handleLikeFBNoThanks(currentTarget)}if(target_id=="fb-connect-like-ok-btn"){event.preventDefault();handleLikeFBOK(currentTarget)}if(target_id=="btn_copy"){event.preventDefault();if(!loggedin){return_after_login(url);return}$(this).addClass("disabled");handleCopy(currentTarget)}function return_after_login(url){window.location.href="/login/?next="+url}function get_optimizely_log(){var return_value="";if(window.optimizely&&window.optimizely.data.state&&window.optimizely.data.state.activeExperiments){var optimizely_state=window.optimizely.data.state;$.each(optimizely_state.activeExperiments,function(index,item){return_value+=(index===0?"":" ")+item+" "+optimizely_state.variationMap[item]})}else{return_value=""}return return_value}function handleCopy(button){if(Prezi.data.search_session_id){$.log(["search_funnel",Prezi.data.search_session_id,"landing.prezi.action.reuse",Prezi.data.oid,Prezi.data.owner_id].join(" "))}var optimizely_log=get_optimizely_log();$.ajax({url:"/api/presentations/reuse/",type:"POST",dataType:"json",data:{id:Prezi.data.oid,saveas:"Copy of "+Prezi.data.permissions.title,optimizely:optimizely_log},success:function(data){if(data.success){location.href="/dashboard/"}else{if(data.error==="NOTLOGGEDIN"){return_after_login(url)}else{createErrorOverlay({title:"Error",message:data.error,width:85})}}},error:function(a,b,c){createGeneralErrorOverlay()}})}function handleLike(button){if(Prezi.data.search_session_id){$.log(["search_funnel",Prezi.data.search_session_id,"landing.prezi.action.like",Prezi.data.oid,Prezi.data.owner_id].join(" "))}$.ajax({url:"/api/presentations/"+Prezi.data.oid+"/like/",type:"POST",dataType:"json",success:function(data){var profile_url="/user/"+Prezi.data.username+"/",profile_url_html_escaped=escapeHtml(profile_url),notificationText=interpolate(gettext('Review your liked prezis <a href="%s">here</a>.'),[profile_url_html_escaped+"#likes"]),$notification=$(".like-notification");if($notification.length){$notification.show().html(notificationText)}else{$("#block_share").append($("<label/>",{class:"like-notification",html:notificationText}))}button.hide();$("#btn_liked").show()}});if(loggedin&&!toolTab.isRegistered($("#btn_like"))){$.ajax({url:"/api/opengraph/increment-denial-counter/",type:"POST",dataType:"json",success:function(data){var likes_since_last_deny=parseInt(Prezi.data.likes_since_last_time_denied_publish_actions);if(isNaN(likes_since_last_deny)){Prezi.data.likes_since_last_time_denied_publish_actions=0}Prezi.data.likes_since_last_time_denied_publish_actions+=1}})}}function handleLiked(button){if(Prezi.data.search_session_id){$.log(["search_funnel",Prezi.data.search_session_id,"landing.prezi.action.unlike",Prezi.data.oid,Prezi.data.owner_id].join(" "))}$.ajax({url:"/api/presentations/"+Prezi.data.oid+"/unlike/",type:"POST",dataType:"json",success:function(data){var notificationText="",$notification=$(".like-notification");if(!$notification.length){$("#block_share .likes > span").hide()}else{$notification.hide().html(notificationText)}if(userNeedsLikePopup()){if(window.toolTab&&!window.toolTab.isRegistered($("#btn_like"))){toolTab.registerButton($("#btn_like"),"like")}}else{if(window.toolTab&&window.toolTab.isRegistered($("#btn_like"))){toolTab.unregisterButton($("#btn_like"))}}button.hide();$("#btn_like").show()}})}});$("#block_share").delegate(".like-notification strong","click",function(){$(this).parent("label").fadeOut()});$(body).delegate("div","click",function(event){var currentTarget=$(event.currentTarget),target_id=currentTarget.attr("id");if(target_id=="fb-connect-like-close-btn"){event.preventDefault();handleLikeFBNoThanks(currentTarget)}});function escapeHtml(stringToHtmlEscape){return $("<div/>").text(stringToHtmlEscape).html()}});

(function(){var __bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++){if(i in this&&this[i]===item)return i}return-1};window.ToolTab=function(){function ToolTab(id){this.id=id;this.placeTip=__bind(this.placeTip,this);this.deactivate=__bind(this.deactivate,this);this.unregisterButton=__bind(this.unregisterButton,this);this.registerButton=__bind(this.registerButton,this);this.activate=__bind(this.activate,this);this.buttons=[]}ToolTab.prototype.activate=function(name,activate){var _this=this;if(activate==null){activate=true}$("#"+this.id+" .tab.active").animate({opacity:0},50);setTimeout(function(){$("#"+_this.id+" .tab").removeClass("active");if(activate){return $("#"+_this.id+" #tab_"+name).addClass("active").css("opacity",0).animate({opacity:1},50)}},50);if(activate){return $("html, body").animate({scrollTop:$("#toolbar").offset().top-20},900)}};ToolTab.prototype.registerButton=function(button,name,tab){var _this=this;this.buttons.push(button[0]);return $(button).on("click.toolbarNamespace",function(event){var active,b,_i,_len,_ref;_ref=_this.buttons;for(_i=0,_len=_ref.length;_i<_len;_i++){b=_ref[_i];if(b!==button[0]){$(b).removeClass("active")}}$(button).toggleClass("active");active=$(button).hasClass("active");_this.activate(name,active);_this.placeTip($(button),active)})};ToolTab.prototype.unregisterButton=function(button){var index,_ref;if(_ref=button[0],__indexOf.call(this.buttons,_ref)>=0){index=this.buttons.indexOf(button[0]);this.buttons.splice(index,1);$(button).off("click.toolbarNamespace");this.deactivate()}};ToolTab.prototype.deactivate=function(){var b,_i,_len,_ref;_ref=this.buttons;for(_i=0,_len=_ref.length;_i<_len;_i++){b=_ref[_i];$(b).removeClass("active")}$("#"+this.id+" .tab").removeClass("active");return this.placeTip(null,false)};ToolTab.prototype.placeTip=function(button,active){var tip,x,y;tip=$("#"+this.id+" .prezi_tool_tab_tip");if(active){$("#prezi_tool_container").addClass("open");x=button.offset().left+button.width()/2;y=$("#"+this.id).offset().top-tip.height();if(!tip.is(":visible")){tip.fadeIn(100)}return tip.animate({top:y,left:x})}else{$("#prezi_tool_container").removeClass("open");tip.fadeOut(100);return $("html, body").animate({scrollTop:$(document.body).offset().top},300)}};ToolTab.prototype.isRegistered=function(button){var _ref;return _ref=button[0],__indexOf.call(this.buttons,_ref)>=0};return ToolTab}()}).call(this);

(function(){var __bind=function(fn,me){return function(){return fn.apply(me,arguments)}};window.InstantEdit=function(){function InstantEdit(edit_button){this.edit_button=edit_button;this.handlePopState=__bind(this.handlePopState,this);this.goToLanding=__bind(this.goToLanding,this);this.isEditURL=__bind(this.isEditURL,this);this.landingURL=__bind(this.landingURL,this);this.editURL=__bind(this.editURL,this);this.goToEdit=__bind(this.goToEdit,this);this.registerFlashPlayer=__bind(this.registerFlashPlayer,this);this.handleClick=__bind(this.handleClick,this);this.edit_button.click(this.handleClick);$(window).bind("popstate",this.handlePopState);this.inEdit=false;this.tweenTime=200;this.player=null}InstantEdit.prototype.container=function(){return $("#flashContainer")};InstantEdit.prototype.iframe=function(){return $("#flashContainer iframe")};InstantEdit.prototype.handleClick=function(event){event.preventDefault();return this.goToEdit()};InstantEdit.prototype.registerFlashPlayer=function(id){this.player=this.iframe()[0].contentWindow.document.getElementById(id);if(this.inEdit){return this.player.editModeChange(true,0,0)}};InstantEdit.prototype.goToEdit=function(){var _this=this;if(this.inEdit){return}this.inEdit=true;$("html, body").animate({scrollTop:0},100);this.topOrig=this.container().offset().top;this.leftOrig=this.container().offset().left;this.bottomOrig=$(window).height()-this.topOrig-this.container().height();this.rightOrig=$(window).width()-this.leftOrig-this.container().width();if($("body").hasClass("instantEdit")){$(".header,.container .container,.footer").hide()}else{$(".header,.container .container,.footer").fadeOut(this.tweenTime)}this.iframe().attr("width","100%").attr("height","100%");this.originalWidth=this.iframe().attr("width");this.originalHeight=this.iframe().attr("height");$("#pEmbed").css("height",480).css("background","none");$(".header").css("z-index",-1e3);this.container().css("position","absolute").css("top",this.topOrig).css("left",this.leftOrig).css("bottom",this.bottomOrig).css("right",this.rightOrig).animate({left:0,top:0,bottom:0,right:0},this.tweenTime,function(){$("body").removeClass("instantEdit");return _this.container().css("position","fixed")}).css("width","auto").css("height","auto");$("html").css("height","100%").css("overflow","hidden");if(this.supports_history_api()&&!this.isEditURL()){window.history.pushState({},document.title,this.editURL())}if(this.player){return this.player.editModeChange(true,this.leftOrig,this.topOrig)}};InstantEdit.prototype.editURL=function(){if(this.isEditURL()){return window.location.pathname}else{return window.location.pathname.replace(/\/[^\/]*\/$/g,"/edit/")}};InstantEdit.prototype.landingURL=function(){if(this.isEditURL()){return window.location.pathname.replace(/\/edit\/$/g,"/"+Prezi.data.slug+"/")}else{return window.location.pathname}};InstantEdit.prototype.isEditURL=function(){return/\/edit\/$/g.test(window.location.pathname)};InstantEdit.prototype.goToLanding=function(){var _this=this;if(!this.inEdit){return}this.inEdit=false;$("html, body").animate({scrollTop:0},100);$(".header,.container .container,.footer").fadeIn(this.tweenTime);this.container().css("position","absolute").animate({left:this.leftOrig,top:this.topOrig,bottom:this.bottomOrig,right:this.rightOrig},this.tweenTime,function(){_this.iframe().attr("height",_this.originalHeight).attr("width",_this.originalWidth);_this.container().css("height","").css("width","").css("position","").css("left","").css("top","").css("bottom","").css("right","");$("html").css("height","").css("overflow","");$(".header").css("z-index",1e3);return $("#pEmbed").css("height","").css("background","")});if(this.supports_history_api()&&this.isEditURL()){window.history.pushState({},document.title,this.landingURL())}if(this.player){return this.player.editModeChange(false,this.leftOrig,this.topOrig)}};InstantEdit.prototype.supports_history_api=function(){return!!(window.history&&history.pushState)};InstantEdit.prototype.handlePopState=function(event){if(this.isEditURL()){return this.goToEdit()}else{return this.goToLanding()}};return InstantEdit}()}).call(this);

Prezi.DownloadModal={};Prezi.DownloadModal.show_and_hide_the_others=function(id){Prezi.DownloadModal.divs.forEach(function(element){if(element.attr("id")==id){element.show()}else{element.hide()}})};Prezi.DownloadModal.url=function(url){return"url("+url+")"};window.paywallUpgradeSuccess=function(feature_set,license_type_oid){Prezi.data.show_download_paywall=false};Prezi.DownloadModal.DownloadModalView=Backbone.View.extend({el:"#ln_download",events:{click:"handleDownloadClick"},template:$("#download_modal")[0].innerHTML,handleDownloadClick:function(e){if(Prezi.data.show_download_paywall){openPaywallPanel("portable_prezi_export");return}window.link_logger("display","download_popup",{trigger:"machine"});if(!this.modal){this.modal=$(Mustache.render(this.template,Prezi.DownloadModal.imagePaths));this.modal.appendTo($("body"));$("#download_desktop_modal").click(function(){if(navigator.userAgent.match(/Mac/gi)){platform="macdmg"}else if(navigator.userAgent.match(/Win/gi)){platform="winexe"}$.post("/desktop/log_event/download_desktop/",{platform:platform,source:"modal_dialog"})});$("#download_link_modal").click(function(){var selected_option=$("#option-presenting").hasClass("selected-option")?"portable":"pez";window.link_logger("download","prezi",{download_type:selected_option});$.post("/desktop/log_event/download_prezi/",{format:format,source:"modal_dialog_clickondownloadurl",oid:Prezi.data.oid})});$("#btn_close_modal").click(function(){$("#modal-scroll-container").modal("hide")});$("#modal-scroll-container").on("hide",function(){var selected_option=$("#option-presenting").hasClass("selected-option")?"portable":"pez";window.link_logger("close","download_popup",{download_type:selected_option});if(onDownload)$.post("/desktop/log_event/download_prezi/",{format:format,source:"modal_dialog_aborteddownload",oid:Prezi.data.oid});window.clearInterval(window.periodicalTimer);onDownload=false;$(window).unbind("keydown",this.keydown_handler)});Prezi.DownloadModal.presenting_and_editing_selected=[Prezi.DownloadModal.url(Prezi.DownloadModal.imagePaths.editing_disabled),Prezi.DownloadModal.url(Prezi.DownloadModal.imagePaths.editing_selected)];Prezi.DownloadModal.presenting_selected=[Prezi.DownloadModal.url(Prezi.DownloadModal.imagePaths.presenting_disabled),Prezi.DownloadModal.url(Prezi.DownloadModal.imagePaths.presenting_selected)];Prezi.DownloadModal.presenting_and_sharing_selected=[Prezi.DownloadModal.url(Prezi.DownloadModal.imagePaths.pptx_disabled),Prezi.DownloadModal.url(Prezi.DownloadModal.imagePaths.pptx_selected)];this.selectedOptionA=0;this.selectedOptionB=0;this.selectedOptionC=0;$("div .option-container").click(function(){if(!$(this).hasClass("selected-option")){$("#option-presenting").removeClass("selected-option");$("#option-editing-and-presenting").removeClass("selected-option");$("#option-sharing-and-presenting").removeClass("selected-option");$(this).addClass("selected-option");var clickId=$(this).attr("id");var optionA=Prezi.DownloadModal.ln_download_modal.selectedOptionA=clickId==="option-presenting"?1:0;var optionB=Prezi.DownloadModal.ln_download_modal.selectedOptionB=clickId==="option-editing-and-presenting"?1:0;var optionC=Prezi.DownloadModal.ln_download_modal.selectedOptionC=clickId==="option-sharing-and-presenting"?1:0;$("#presenting_selected").css("background-image",Prezi.DownloadModal.presenting_selected[optionA]);$("#presenting_and_editing_selected").css("background-image",Prezi.DownloadModal.presenting_and_editing_selected[optionB]);$("#presenting_and_sharing_selected").css("background-image",Prezi.DownloadModal.presenting_and_sharing_selected[optionC])}var selected_option=$("#option-presenting").hasClass("selected-option")?"portable":"pez";window.link_logger("select","download_type",{download_type:selected_option})});$("div .option-container").dblclick(function(){$("#btn_download_modal").trigger("click")});Prezi.DownloadModal.divs=[$("#container-download-options"),$("#container-download-preparation"),$("#downloading-container"),$("#error-container"),$("#error_code")]}this.download_logic=new Prezi.DownloadModal.DownloadLogicView;this.download_logic.parent=this;this.init_modal();this.modal.modal({backdrop:"static",keyboard:true})},init_modal:function(){$(window).bind("keydown",this.keydown_handler);$("#btn_download_modal").removeClass("disabled");$(".image").hide();$("#download-modal-title").show();$("#download-modal-downloading-title").hide();var option_presenting=$("#option-presenting");var option_presenting_and_editing=$("#option-editing-and-presenting");option_presenting.addClass("selected-option");option_presenting_and_editing.removeClass("selected-option");this.selectedOptionA=1;this.selectedOptionB=0;this.selectedOptionC=0;$("#presenting_selected").css("background-image",Prezi.DownloadModal.presenting_selected[this.selectedOptionA]);$("#presenting_and_editing_selected").css("background-image",Prezi.DownloadModal.presenting_and_editing_selected[this.selectedOptionB]);$("#presenting_and_sharing_selected").css("background-image",Prezi.DownloadModal.presenting_and_sharing_selected[this.selectedOptionC]);$.post("/desktop/log_event/download_prezi/",{format:Prezi.data.desktop_full=="True"?"pro":"not_pro",source:"modal_dialog_openthedialog",oid:Prezi.data.oid});$("#btn_download_modal").addClass("btn-primary");$("#download_icon_modal").addClass("icon-white");var title=document.getElementById("prezi_title").innerHTML;document.getElementById("prezi_modal_title").innerHTML=title;Prezi.DownloadModal.show_and_hide_the_others("container-download-options");onDownload=false;$(window).scrollTop(0,0)},keydown_handler:function(e){var keycode=e.keyCode;var leftArrow=37;var rightArrow=39;var isLeft=keycode==leftArrow&&!$("#option-presenting").hasClass("selected-option");var isRight=keycode==rightArrow&&!$("#option-editing-and-presenting").hasClass("selected-option");if(isLeft){$("#option-presenting").trigger("click")}else if(isRight){$("#option-editing-and-presenting").trigger("click")}var enter=13;if(keycode==enter)$("#btn_download_modal").trigger("click")}});Prezi.DownloadModal.DownloadLogicView=Backbone.View.extend({el:"#btn_download_modal",events:{click:"handleDownloadClick"},handleDownloadClick:function(e){if(!$("#btn_download_modal").hasClass("disabled")){$("#btn_download_modal").removeClass("btn-primary");$("#download_icon_modal").removeClass("icon-white");$("#download-modal-title").hide();$("#download-modal-downloading-title").show();Prezi.DownloadModal.show_and_hide_the_others("container-download-preparation");format="zip";if($("#option-editing-and-presenting").hasClass("selected-option")){format="pez"}else if($("#option-sharing-and-presenting").hasClass("selected-option")){format="pptx"}var data={format:format};onDownload=true;this.log_clicks(data.format);this.handleDownload(data);$("#btn_download_modal").addClass("disabled")}},log_clicks:function(format){var result_pez_or_zip=$.post("/desktop/log_event/download_prezi/",{format:format,source:"modal_dialog_startdownload",oid:Prezi.data.oid});return result_pez_or_zip},handleDownload:function(data){var oid=Prezi.data.oid,format=data.format;var url="/backend/export/"+oid+"/"+format+"/";var current_view=this;window.link_logger("download","prezi",{download_type:format=="zip"?"portable":"pez",status:"started",trigger:"machine"});$.ajax({type:"POST",url:url,data:{},success:function(response){if(response.success){var start_token=response.conversion_token;$.ajax({type:start_token.method,url:start_token.url,beforeSend:function(xhr){xhr.setRequestHeader("Authorization",start_token.header)},success:function(start_response){current_view.handleDownloadFinal(start_response.conversion_status_token)},error:function(start_response){$.ajax({type:"POST",url:url+"proxy/",success:function(fallback_response){if(fallback_response.success){current_view.handleDownloadFinal(fallback_response.conversion_status_token,true,fallback_response.job_uuid)}else{current_view.errorDownload(response.error)}},error:function(fallback_response){current_view.generalErrorDownload()},dataType:"json"})},dataType:"json",xhrFields:{withCredentials:true}})}else{current_view.errorDownload(response.error)}},error:function(response){current_view.generalErrorDownload()},complete:function(){},dataType:"json"})},handleDownloadFinal:function(status_token,proxy,job_uuid){var current_view=this;var periodical_tried=0;var periodicalUpdate=function(){periodical_tried+=1;if(proxy===true){window._xhr=$.ajax({type:"POST",url:"/backend/export/status/"+job_uuid+"/",data:{token_url:status_token.url,token_method:status_token.method,token_header:status_token.header},success:function(response){if(response.success){if(response.status==5){if(response.url!==""){current_view.successfulConversion(response.url);window.clearInterval(periodicalTimer)}}else if(response.status==6){current_view.generalErrorDownload();window.clearInterval(periodicalTimer)}}else{current_view.errorDownload(response.error);window.clearInterval(periodicalTimer)}},error:function(response){current_view.generalErrorDownload();window.clearInterval(periodicalTimer)},dataType:"json"})}else{window._xhr=$.ajax({type:"POST",url:status_token.url,beforeSend:function(xhr){xhr.setRequestHeader("Authorization",status_token.header)},success:function(response){if(response.success){if(response.status==5){if(response.url!==""){current_view.successfulConversion(response.url);window.clearInterval(periodicalTimer)}}else if(response.status==6){current_view.generalErrorDownload();window.clearInterval(periodicalTimer)}}else{current_view.errorDownload(response.error);window.clearInterval(periodicalTimer)}},error:function(response){current_view.generalErrorDownload();window.clearInterval(periodicalTimer)},dataType:"json",xhrFields:{withCredentials:true}})}};if(window.periodicalTimer)window.clearInterval(periodicalTimer);if(onDownload)window.periodicalTimer=window.setInterval(periodicalUpdate,5e3)},errorDownload:function(error){this.generalErrorDownload();$("#error_code").show();$("#error_message").remove();var error_message=['<p id="error_message">',error,"</p>"].join("");$("#error-container").append(error_message)},generalErrorDownload:function(){window.link_logger("download","prezi",{download_type:format=="zip"?"portable":"pez",status:"failed",trigger:"machine"});Prezi.DownloadModal.show_and_hide_the_others("error-container");$.post("/desktop/log_event/download_prezi/",{format:format,source:"modal_dialog_unsuccessfulconversion",oid:Prezi.data.oid});onDownload=false},successfulConversion:function(url){window.link_logger("download","prezi",{download_type:format=="zip"?"portable":"pez",status:"success",trigger:"machine"});$("#download_link_modal").attr("href",url);Prezi.DownloadModal.show_and_hide_the_others("downloading-container");if($("#option-editing-and-presenting").hasClass("selected-option")){$("#only-desktop-warning").show()}else{$("#only-desktop-warning").hide()}$.post("/desktop/log_event/download_prezi/",{format:format,source:"modal_dialog_successfulconversion",oid:Prezi.data.oid});var auto_frame=['<iframe width="1" height="1" frameborder="0" src=','"',url,'"',"></iframe>"].join("");$("#downloading-container").append(auto_frame);onDownload=false}});

$(function(){Prezi.DownloadModal.ln_download_modal=new Prezi.DownloadModal.DownloadModalView;Mustache.tags=["<%=","%>"];$(window).load(function(){$.each(Prezi.DownloadModal.imagePaths,function(key,imagePath){$("<img/>")[0].src=imagePath})})});
